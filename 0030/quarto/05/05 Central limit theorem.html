<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.403">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>central-limit-theorem</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="05 Central limit theorem_files/libs/clipboard/clipboard.min.js"></script>
<script src="05 Central limit theorem_files/libs/quarto-html/quarto.js"></script>
<script src="05 Central limit theorem_files/libs/quarto-html/popper.min.js"></script>
<script src="05 Central limit theorem_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="05 Central limit theorem_files/libs/quarto-html/anchor.min.js"></script>
<link href="05 Central limit theorem_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="05 Central limit theorem_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="05 Central limit theorem_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="05 Central limit theorem_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="05 Central limit theorem_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="中心極限定理などについて" class="level1">
<h1>中心極限定理などについて</h1>
<ul>
<li>黒木玄</li>
<li>2022-04-11～2022-05-08 $
$</li>
</ul>
<p>このノートでは<a href="https://julialang.org/">Julia言語</a>を使用している:</p>
<ul>
<li><a href="https://nbviewer.org/github/genkuroki/msfd28/blob/master/install.ipynb">Julia言語のインストールの仕方の一例</a></li>
</ul>
<p>自明な誤りを見つけたら, 自分で訂正して読んで欲しい. 大文字と小文字の混同や書き直しが不完全な場合や符号のミスは非常によくある.</p>
<p>このノートに書いてある式を文字通りにそのまま読んで正しいと思ってしまうとひどい目に会う可能性が高い. しかし, 数が使われている文献には大抵の場合に文字通りに読むと間違っている式や主張が書いてあるので, 内容を理解した上で訂正しながら読んで利用しなければいけない. 実践的に数学を使う状況では他人が書いた式をそのまま信じていけない.</p>
<p>このノートの内容よりもさらに詳しいノートを自分で作ると勉強になるだろう. 膨大な時間を取られることになるが, このノートの内容に関係することで飯を食っていく可能性がある人にはそのためにかけた時間は無駄にならないと思われる.</p>
<h1>
目次<span class="tocSkip"></span>
</h1>
<div class="toc">
<ul class="toc-item">
<li>
<span><a href="#大数の法則" data-toc-modified-id="大数の法則-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>大数の法則</a></span>
<ul class="toc-item">
<li>
<span><a href="#Markovの不等式" data-toc-modified-id="Markovの不等式-1.1"><span class="toc-item-num">1.1&nbsp;&nbsp;</span>Markovの不等式</a></span>
</li>
<li>
<span><a href="#Chebyshevの不等式" data-toc-modified-id="Chebyshevの不等式-1.2"><span class="toc-item-num">1.2&nbsp;&nbsp;</span>Chebyshevの不等式</a></span>
</li>
<li>
<span><a href="#大数の弱法則" data-toc-modified-id="大数の弱法則-1.3"><span class="toc-item-num">1.3&nbsp;&nbsp;</span>大数の弱法則</a></span>
</li>
<li>
<span><a href="#不偏分散の-$n\to\infty$-での挙動" data-toc-modified-id="不偏分散の-$n\to\infty$-での挙動-1.4"><span class="toc-item-num">1.4&nbsp;&nbsp;</span>不偏分散の <span class="math inline">\(n\to\infty\)</span> での挙動</a></span>
</li>
<li>
<span><a href="#大数の強法則" data-toc-modified-id="大数の強法則-1.5"><span class="toc-item-num">1.5&nbsp;&nbsp;</span>大数の強法則</a></span>
<ul class="toc-item">
<li>
<span><a href="#Borel-Cantelliの補題" data-toc-modified-id="Borel-Cantelliの補題-1.5.1"><span class="toc-item-num">1.5.1&nbsp;&nbsp;</span>Borel-Cantelliの補題</a></span>
</li>
<li>
<span><a href="#4次以下のモーメントの存在を仮定した場合の大数の強法則" data-toc-modified-id="4次以下のモーメントの存在を仮定した場合の大数の強法則-1.5.2"><span class="toc-item-num">1.5.2&nbsp;&nbsp;</span>4次以下のモーメントの存在を仮定した場合の大数の強法則</a></span>
</li>
</ul>
</li>
<li>
<span><a href="#大数の強法則に関する文献" data-toc-modified-id="大数の強法則に関する文献-1.6"><span class="toc-item-num">1.6&nbsp;&nbsp;</span>大数の強法則に関する文献</a></span>
</li>
<li>
<span><a href="#問題:-大数の法則に関する誤解" data-toc-modified-id="問題:-大数の法則に関する誤解-1.7"><span class="toc-item-num">1.7&nbsp;&nbsp;</span>問題: 大数の法則に関する誤解</a></span>
</li>
<li>
<span><a href="#大数の法則のデモンストレーション" data-toc-modified-id="大数の法則のデモンストレーション-1.8"><span class="toc-item-num">1.8&nbsp;&nbsp;</span>大数の法則のデモンストレーション</a></span>
<ul class="toc-item">
<li>
<span><a href="#Bernoulli試行" data-toc-modified-id="Bernoulli試行-1.8.1"><span class="toc-item-num">1.8.1&nbsp;&nbsp;</span>Bernoulli試行</a></span>
</li>
<li>
<span><a href="#正規分布のサンプルの場合" data-toc-modified-id="正規分布のサンプルの場合-1.8.2"><span class="toc-item-num">1.8.2&nbsp;&nbsp;</span>正規分布のサンプルの場合</a></span>
</li>
<li>
<span><a href="#ガンマ分布の場合" data-toc-modified-id="ガンマ分布の場合-1.8.3"><span class="toc-item-num">1.8.3&nbsp;&nbsp;</span>ガンマ分布の場合</a></span>
</li>
<li>
<span><a href="#大数の法則が成立しない場合:-Cauchy分布" data-toc-modified-id="大数の法則が成立しない場合:-Cauchy分布-1.8.4"><span class="toc-item-num">1.8.4&nbsp;&nbsp;</span>大数の法則が成立しない場合: Cauchy分布</a></span>
</li>
<li>
<span><a href="#大数の法則が成立しない場合:-Pólyaの壺" data-toc-modified-id="大数の法則が成立しない場合:-Pólyaの壺-1.8.5"><span class="toc-item-num">1.8.5&nbsp;&nbsp;</span>大数の法則が成立しない場合: Pólyaの壺</a></span>
</li>
</ul>
</li>
</ul>
</li>
<li>
<span><a href="#二項分布の中心極限定理" data-toc-modified-id="二項分布の中心極限定理-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>二項分布の中心極限定理</a></span>
<ul class="toc-item">
<li>
<span><a href="#二項分布の中心極限定理の内容" data-toc-modified-id="二項分布の中心極限定理の内容-2.1"><span class="toc-item-num">2.1&nbsp;&nbsp;</span>二項分布の中心極限定理の内容</a></span>
</li>
<li>
<span><a href="#二項分布の中心極限定理のプロット" data-toc-modified-id="二項分布の中心極限定理のプロット-2.2"><span class="toc-item-num">2.2&nbsp;&nbsp;</span>二項分布の中心極限定理のプロット</a></span>
</li>
<li>
<span><a href="#必修重要問題:-二項分布の正規分布近似を使った確率の近似計算1" data-toc-modified-id="必修重要問題:-二項分布の正規分布近似を使った確率の近似計算1-2.3"><span class="toc-item-num">2.3&nbsp;&nbsp;</span>必修重要問題: 二項分布の正規分布近似を使った確率の近似計算1</a></span>
<ul class="toc-item">
<li>
<span><a href="#WolframAlphaによる計算1" data-toc-modified-id="WolframAlphaによる計算1-2.3.1"><span class="toc-item-num">2.3.1&nbsp;&nbsp;</span>WolframAlphaによる計算1</a></span>
</li>
<li>
<span><a href="#Julia言語による計算1" data-toc-modified-id="Julia言語による計算1-2.3.2"><span class="toc-item-num">2.3.2&nbsp;&nbsp;</span>Julia言語による計算1</a></span>
</li>
<li>
<span><a href="#Julia言語による視覚化1" data-toc-modified-id="Julia言語による視覚化1-2.3.3"><span class="toc-item-num">2.3.3&nbsp;&nbsp;</span>Julia言語による視覚化1</a></span>
</li>
</ul>
</li>
<li>
<span><a href="#必修重要問題:-二項分布の正規分布近似を使った確率の近似計算2" data-toc-modified-id="必修重要問題:-二項分布の正規分布近似を使った確率の近似計算2-2.4"><span class="toc-item-num">2.4&nbsp;&nbsp;</span>必修重要問題: 二項分布の正規分布近似を使った確率の近似計算2</a></span>
<ul class="toc-item">
<li>
<span><a href="#WolframAlphaによる計算" data-toc-modified-id="WolframAlphaによる計算-2.4.1"><span class="toc-item-num">2.4.1&nbsp;&nbsp;</span>WolframAlphaによる計算</a></span>
</li>
<li>
<span><a href="#Julia言語による計算2" data-toc-modified-id="Julia言語による計算2-2.4.2"><span class="toc-item-num">2.4.2&nbsp;&nbsp;</span>Julia言語による計算2</a></span>
</li>
<li>
<span><a href="#Julia言語による視覚化2" data-toc-modified-id="Julia言語による視覚化2-2.4.3"><span class="toc-item-num">2.4.3&nbsp;&nbsp;</span>Julia言語による視覚化2</a></span>
</li>
</ul>
</li>
<li>
<span><a href="#連続性補正とmid-P補正" data-toc-modified-id="連続性補正とmid-P補正-2.5"><span class="toc-item-num">2.5&nbsp;&nbsp;</span>連続性補正とmid-P補正</a></span>
</li>
<li>
<span><a href="#問題:-二項分布の中心極限定理を使った極限の計算問題" data-toc-modified-id="問題:-二項分布の中心極限定理を使った極限の計算問題-2.6"><span class="toc-item-num">2.6&nbsp;&nbsp;</span>問題: 二項分布の中心極限定理を使った極限の計算問題</a></span>
</li>
<li>
<span><a href="#二項分布の中心極限定理の証明の方針" data-toc-modified-id="二項分布の中心極限定理の証明の方針-2.7"><span class="toc-item-num">2.7&nbsp;&nbsp;</span>二項分布の中心極限定理の証明の方針</a></span>
</li>
<li>
<span><a href="#(1)-Stirlingの公式を使った二項分布の確率質量函数の近似" data-toc-modified-id="(1)-Stirlingの公式を使った二項分布の確率質量函数の近似-2.8"><span class="toc-item-num">2.8&nbsp;&nbsp;</span>(1) Stirlingの公式を使った二項分布の確率質量函数の近似</a></span>
</li>
<li>
<span><a href="#注意:-Kullback-Leibler情報量とSanovの定理との関係" data-toc-modified-id="注意:-Kullback-Leibler情報量とSanovの定理との関係-2.9"><span class="toc-item-num">2.9&nbsp;&nbsp;</span>注意: Kullback-Leibler情報量とSanovの定理との関係</a></span>
</li>
<li>
<span><a href="#(2)-二項分布の確率質量函数から正規分布の密度函数が出て来ること" data-toc-modified-id="(2)-二項分布の確率質量函数から正規分布の密度函数が出て来ること-2.10"><span class="toc-item-num">2.10&nbsp;&nbsp;</span>(2) 二項分布の確率質量函数から正規分布の密度函数が出て来ること</a></span>
</li>
</ul>
</li>
<li>
<span><a href="#中心極限定理" data-toc-modified-id="中心極限定理-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>中心極限定理</a></span>
<ul class="toc-item">
<li>
<span><a href="#中心極限定理のラフな説明" data-toc-modified-id="中心極限定理のラフな説明-3.1"><span class="toc-item-num">3.1&nbsp;&nbsp;</span>中心極限定理のラフな説明</a></span>
</li>
<li>
<span><a href="#中心極限定理の特性函数を使った証明" data-toc-modified-id="中心極限定理の特性函数を使った証明-3.2"><span class="toc-item-num">3.2&nbsp;&nbsp;</span>中心極限定理の特性函数を使った証明</a></span>
</li>
<li>
<span><a href="#中心極限定理の収束の速さと歪度" data-toc-modified-id="中心極限定理の収束の速さと歪度-3.3"><span class="toc-item-num">3.3&nbsp;&nbsp;</span>中心極限定理の収束の速さと歪度</a></span>
</li>
<li>
<span><a href="#中心極限定理のキュムラント母函数を使った証明" data-toc-modified-id="中心極限定理のキュムラント母函数を使った証明-3.4"><span class="toc-item-num">3.4&nbsp;&nbsp;</span>中心極限定理のキュムラント母函数を使った証明</a></span>
</li>
<li>
<span><a href="#中心極限定理の収束の速さと歪度と尖度" data-toc-modified-id="中心極限定理の収束の速さと歪度と尖度-3.5"><span class="toc-item-num">3.5&nbsp;&nbsp;</span>中心極限定理の収束の速さと歪度と尖度</a></span>
</li>
<li>
<span><a href="#中心極限定理のTaylorの定理のみを使う証明" data-toc-modified-id="中心極限定理のTaylorの定理のみを使う証明-3.6"><span class="toc-item-num">3.6&nbsp;&nbsp;</span>中心極限定理のTaylorの定理のみを使う証明</a></span>
<ul class="toc-item">
<li>
<span><a href="#多重積分の書き方" data-toc-modified-id="多重積分の書き方-3.6.1"><span class="toc-item-num">3.6.1&nbsp;&nbsp;</span>多重積分の書き方</a></span>
</li>
<li>
<span><a href="#積分剰余項型のTaylorの定理" data-toc-modified-id="積分剰余項型のTaylorの定理-3.6.2"><span class="toc-item-num">3.6.2&nbsp;&nbsp;</span>積分剰余項型のTaylorの定理</a></span>
</li>
<li>
<span><a href="#積分剰余項の別の表示" data-toc-modified-id="積分剰余項の別の表示-3.6.3"><span class="toc-item-num">3.6.3&nbsp;&nbsp;</span>積分剰余項の別の表示</a></span>
</li>
<li>
<span><a href="#微分剰余項型のTaylorの定理" data-toc-modified-id="微分剰余項型のTaylorの定理-3.6.4"><span class="toc-item-num">3.6.4&nbsp;&nbsp;</span>微分剰余項型のTaylorの定理</a></span>
</li>
<li>
<span><a href="#Taylorの定理を使った中心極限定理の証明" data-toc-modified-id="Taylorの定理を使った中心極限定理の証明-3.6.5"><span class="toc-item-num">3.6.5&nbsp;&nbsp;</span>Taylorの定理を使った中心極限定理の証明</a></span>
</li>
<li>
<span><a href="#中心極限定理の収束の速さと歪度と尖度(再)" data-toc-modified-id="中心極限定理の収束の速さと歪度と尖度(再)-3.6.6"><span class="toc-item-num">3.6.6&nbsp;&nbsp;</span>中心極限定理の収束の速さと歪度と尖度(再)</a></span>
</li>
</ul>
</li>
<li>
<span><a href="#問題:-中心極限定理の収束の様子のグラフ" data-toc-modified-id="問題:-中心極限定理の収束の様子のグラフ-3.7"><span class="toc-item-num">3.7&nbsp;&nbsp;</span>問題: 中心極限定理の収束の様子のグラフ</a></span>
</li>
</ul>
</li>
<li>
<span><a href="#デルタ法" data-toc-modified-id="デルタ法-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>デルタ法</a></span>
<ul class="toc-item">
<li>
<span><a href="#1次のデルタ法と2次のデルタ法" data-toc-modified-id="1次のデルタ法と2次のデルタ法-4.1"><span class="toc-item-num">4.1&nbsp;&nbsp;</span>1次のデルタ法と2次のデルタ法</a></span>
</li>
<li>
<span><a href="#おまけ:-2次のデルタ法使用時の近似分散と歪度と尖度に関する不等式" data-toc-modified-id="おまけ:-2次のデルタ法使用時の近似分散と歪度と尖度に関する不等式-4.2"><span class="toc-item-num">4.2&nbsp;&nbsp;</span>おまけ: 2次のデルタ法使用時の近似分散と歪度と尖度に関する不等式</a></span>
</li>
<li>
<span><a href="#問題:-2次のデルタ法の不偏分散の平方根の期待値の近似への応用" data-toc-modified-id="問題:-2次のデルタ法の不偏分散の平方根の期待値の近似への応用-4.3"><span class="toc-item-num">4.3&nbsp;&nbsp;</span>問題: 2次のデルタ法の不偏分散の平方根の期待値の近似への応用</a></span>
</li>
<li>
<span><a href="#問題:-1次のデルタ法の正規分布近似への応用" data-toc-modified-id="問題:-1次のデルタ法の正規分布近似への応用-4.4"><span class="toc-item-num">4.4&nbsp;&nbsp;</span>問題: 1次のデルタ法の正規分布近似への応用</a></span>
</li>
<li>
<span><a href="#問題:-1次のデルタ法による分布の逆数の近似" data-toc-modified-id="問題:-1次のデルタ法による分布の逆数の近似-4.5"><span class="toc-item-num">4.5&nbsp;&nbsp;</span>問題: 1次のデルタ法による分布の逆数の近似</a></span>
</li>
<li>
<span><a href="#例:-自由度が大きなχ²分布の逆数の近似" data-toc-modified-id="例:-自由度が大きなχ²分布の逆数の近似-4.6"><span class="toc-item-num">4.6&nbsp;&nbsp;</span>例: 自由度が大きなχ²分布の逆数の近似</a></span>
</li>
<li>
<span><a href="#問題:-デルタ法による分布の対数の近似" data-toc-modified-id="問題:-デルタ法による分布の対数の近似-4.7"><span class="toc-item-num">4.7&nbsp;&nbsp;</span>問題: デルタ法による分布の対数の近似</a></span>
</li>
<li>
<span><a href="#例:-自由度が大きなχ²分布の対数の近似" data-toc-modified-id="例:-自由度が大きなχ²分布の対数の近似-4.8"><span class="toc-item-num">4.8&nbsp;&nbsp;</span>例: 自由度が大きなχ²分布の対数の近似</a></span>
</li>
<li>
<span><a href="#問題:-ベータ分布の正規分布近似" data-toc-modified-id="問題:-ベータ分布の正規分布近似-4.9"><span class="toc-item-num">4.9&nbsp;&nbsp;</span>問題: ベータ分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#問題:-ベータ分布の正規分布近似の直接的証明" data-toc-modified-id="問題:-ベータ分布の正規分布近似の直接的証明-4.10"><span class="toc-item-num">4.10&nbsp;&nbsp;</span>問題: ベータ分布の正規分布近似の直接的証明</a></span>
</li>
</ul>
</li>
<li>
<span><a href="#各種の確率分布の正規分布近似" data-toc-modified-id="各種の確率分布の正規分布近似-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>各種の確率分布の正規分布近似</a></span>
<ul class="toc-item">
<li>
<span><a href="#二項分布の正規分布近似" data-toc-modified-id="二項分布の正規分布近似-5.1"><span class="toc-item-num">5.1&nbsp;&nbsp;</span>二項分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#負の二項分布の正規分布近似" data-toc-modified-id="負の二項分布の正規分布近似-5.2"><span class="toc-item-num">5.2&nbsp;&nbsp;</span>負の二項分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#Poisson分布の正規分布近似" data-toc-modified-id="Poisson分布の正規分布近似-5.3"><span class="toc-item-num">5.3&nbsp;&nbsp;</span>Poisson分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#ガンマ分布の正規分布近似" data-toc-modified-id="ガンマ分布の正規分布近似-5.4"><span class="toc-item-num">5.4&nbsp;&nbsp;</span>ガンマ分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#χ²分布の正規分布近似" data-toc-modified-id="χ²分布の正規分布近似-5.5"><span class="toc-item-num">5.5&nbsp;&nbsp;</span>χ²分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#逆ガンマ分布の正規分布近似" data-toc-modified-id="逆ガンマ分布の正規分布近似-5.6"><span class="toc-item-num">5.6&nbsp;&nbsp;</span>逆ガンマ分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#ベータ分布の正規分布近似" data-toc-modified-id="ベータ分布の正規分布近似-5.7"><span class="toc-item-num">5.7&nbsp;&nbsp;</span>ベータ分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#$t$-分布の正規分布近似" data-toc-modified-id="$t$-分布の正規分布近似-5.8"><span class="toc-item-num">5.8&nbsp;&nbsp;</span><span class="math inline">\(t\)</span> 分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#ベータプライム分布の正規分布近似" data-toc-modified-id="ベータプライム分布の正規分布近似-5.9"><span class="toc-item-num">5.9&nbsp;&nbsp;</span>ベータプライム分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#$F$-分布の正規分布近似" data-toc-modified-id="$F$-分布の正規分布近似-5.10"><span class="toc-item-num">5.10&nbsp;&nbsp;</span><span class="math inline">\(F\)</span> 分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#超幾何分布の正規分布近似" data-toc-modified-id="超幾何分布の正規分布近似-5.11"><span class="toc-item-num">5.11&nbsp;&nbsp;</span>超幾何分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#ベータ二項分布の正規分布近似" data-toc-modified-id="ベータ二項分布の正規分布近似-5.12"><span class="toc-item-num">5.12&nbsp;&nbsp;</span>ベータ二項分布の正規分布近似</a></span>
</li>
<li>
<span><a href="#ベータ負の二項分布の正規分布近似" data-toc-modified-id="ベータ負の二項分布の正規分布近似-5.13"><span class="toc-item-num">5.13&nbsp;&nbsp;</span>ベータ負の二項分布の正規分布近似</a></span>
</li>
</ul>
</li>
</ul>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/CLT.PNG" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">CLT.PNG</figcaption><p></p>
</figure>
</div>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cn">ENV</span>[<span class="st">"LINES"</span>], <span class="cn">ENV</span>[<span class="st">"COLUMNS"</span>] <span class="op">=</span> <span class="fl">100</span>, <span class="fl">100</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">BenchmarkTools</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Printf</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">QuadGK</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(<span class="fl">4649373</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Roots</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">SpecialFunctions</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StaticArrays</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsBase</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsFuns</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">default</span>(fmt <span class="op">=</span> <span class="op">:</span>png, titlefontsize <span class="op">=</span> <span class="fl">10</span>, size <span class="op">=</span> (<span class="fl">400</span>, <span class="fl">250</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">SymPy</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Override the Base.show definition of SymPy.jl:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/JuliaPy/SymPy.jl/blob/29c5bfd1d10ac53014fa7fef468bc8deccadc2fc/src/types.jl#L87-L105</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@eval</span> SymPy <span class="kw">function</span> <span class="bu">Base</span>.<span class="fu">show</span>(io<span class="op">::</span><span class="dt">IO</span>, <span class="op">::</span><span class="dt">MIME"text/latex"</span>, x<span class="op">::</span><span class="dt">SymbolicObject</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(io, <span class="fu">as_markdown</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">displaystyle "</span> <span class="op">*</span> sympy.<span class="fu">latex</span>(x, mode<span class="op">=</span><span class="st">"plain"</span>, fold_short_frac<span class="op">=</span><span class="cn">false</span>)))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="pp">@eval</span> SymPy <span class="kw">function</span> <span class="bu">Base</span>.<span class="fu">show</span>(io<span class="op">::</span><span class="dt">IO</span>, <span class="op">::</span><span class="dt">MIME"text/latex"</span>, x<span class="op">::</span><span class="dt">AbstractArray{Sym}</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">toeqnarray</span>(x<span class="op">::</span><span class="dt">Vector{Sym}</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> <span class="fu">join</span>([<span class="st">"</span><span class="sc">\\</span><span class="st">displaystyle "</span> <span class="op">*</span> sympy.<span class="fu">latex</span>(x[i]) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(x)], <span class="st">"</span><span class="sc">\\\\</span><span class="st">"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"""</span><span class="sc">\\</span><span class="st">left[ </span><span class="sc">\\</span><span class="st">begin{array}{r}</span><span class="sc">$</span>a<span class="sc">\\</span><span class="st">end{array} </span><span class="sc">\\</span><span class="st">right]"""</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">toeqnarray</span>(x<span class="op">::</span><span class="dt">AbstractArray{Sym,2}</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        sz <span class="op">=</span> <span class="fu">size</span>(x)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> <span class="fu">join</span>([<span class="fu">join</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">displaystyle "</span> <span class="op">.*</span> <span class="fu">map</span>(sympy.latex, x[i,<span class="op">:</span>]), <span class="st">"&amp;"</span>) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>sz[<span class="fl">1</span>]], <span class="st">"</span><span class="sc">\\\\</span><span class="st">"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">\\</span><span class="st">left[ </span><span class="sc">\\</span><span class="st">begin{array}{"</span> <span class="op">*</span> <span class="fu">repeat</span>(<span class="st">"r"</span>,sz[<span class="fl">2</span>]) <span class="op">*</span> <span class="st">"}"</span> <span class="op">*</span> a <span class="op">*</span> <span class="st">"</span><span class="sc">\\</span><span class="st">end{array}</span><span class="sc">\\</span><span class="st">right]"</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(io, <span class="fu">as_markdown</span>(<span class="fu">toeqnarray</span>(x)))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">⪅</span> y <span class="op">=</span> x <span class="op">&lt;</span> y <span class="op">||</span> x <span class="op">≈</span> y</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mypdf</span>(dist, x) <span class="op">=</span> <span class="fu">pdf</span>(dist, x)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mypdf</span>(dist<span class="op">::</span><span class="dt">DiscreteUnivariateDistribution</span>, x) <span class="op">=</span> <span class="fu">pdf</span>(dist, <span class="fu">round</span>(x))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">distname</span>(dist<span class="op">::</span><span class="dt">Distribution</span>) <span class="op">=</span> <span class="fu">replace</span>(<span class="fu">string</span>(dist), <span class="st">r"{</span><span class="sc">.*</span><span class="st">}"</span> <span class="op">=&gt;</span> <span class="st">""</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">myskewness</span>(dist) <span class="op">=</span> <span class="fu">skewness</span>(dist)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mykurtosis</span>(dist) <span class="op">=</span> <span class="fu">kurtosis</span>(dist)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">standardized_moment</span>(dist<span class="op">::</span><span class="dt">ContinuousUnivariateDistribution</span>, m)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    μ, σ <span class="op">=</span> <span class="fu">mean</span>(dist), <span class="fu">std</span>(dist)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">quadgk</span>(x <span class="op">-&gt;</span> (x <span class="op">-</span> μ)<span class="op">^</span>m <span class="op">*</span> <span class="fu">pdf</span>(dist, x), <span class="fu">extrema</span>(dist)<span class="op">...</span>)[<span class="fl">1</span>] <span class="op">/</span> σ<span class="op">^</span>m</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">myskewness</span>(dist<span class="op">::</span><span class="dt">MixtureModel{Univariate, Continuous}</span>) <span class="op">=</span> <span class="fu">standardized_moment</span>(dist, <span class="fl">3</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mykurtosis</span>(dist<span class="op">::</span><span class="dt">MixtureModel{Univariate, Continuous}</span>) <span class="op">=</span> <span class="fu">standardized_moment</span>(dist, <span class="fl">4</span>) <span class="op">-</span> <span class="fl">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>mykurtosis (generic function with 2 methods)</code></pre>
</div>
</div>
<section id="大数の法則" class="level2">
<h2 class="anchored" data-anchor-id="大数の法則">大数の法則</h2>
<p><strong>大数の法則</strong> (law of large numbers, LLN)とは, 大雑把に言えば, 独立同分布確率変数列 <span class="math inline">\(X_1,X_2,\ldots\)</span> の最初の <span class="math inline">\(n\)</span> 個の標本平均を <span class="math inline">\(\bar{X}_n = (1/n)\sum_{i=1}^n X_i\)</span> と書くと, <span class="math inline">\(\bar{X}_n\)</span> が <span class="math inline">\(X_i\)</span> 達の共通の期待値に収束するという結果のことである. (より正確に言うと, その「収束」の仕方に強弱があって, それぞれについて「大数の強法則」と呼んだり, 「大数の弱法則」と呼んだりする. しかし, 応用上, 多くの場合にその違いに神経質になる必要はない.)</p>
<p>以下では大数の法則について解説する.</p>
<section id="markovの不等式" class="level3">
<h3 class="anchored" data-anchor-id="markovの不等式">Markovの不等式</h3>
<p>確率変数 <span class="math inline">\(X\)</span> と任意の <span class="math inline">\(a&gt;0\)</span> について</p>
<p><span class="math display">\[
P(|X|\ge a) \le \frac{1}{a}E[|X|].
\]</span></p>
<p><strong>証明:</strong> 函数 <span class="math inline">\(1_{|x|\ge a}(x)\)</span> を</p>
<p><span class="math display">\[
1_{|x|\ge a}(x) = \begin{cases}
1 &amp; (|x|\ge a) \\
0 &amp; (|x| &lt;  a) \\
\end{cases}
\]</span></p>
<p>とおくと, <span class="math inline">\(|x|\ge a\)</span> と <span class="math inline">\(1\le |x|/a\)</span> は同値なので常に <span class="math inline">\(1_{|x|\ge a}(x) \le |x|/a\)</span> となる. ゆえに期待値を取る操作の単調性と線形性より,</p>
<p><span class="math display">\[
P(|X|\ge a) = E[1_{|x|\ge a}(x)] \le E\left[\frac{|X|}{a}\right] = \frac{1}{a}E[|X|].
\]</span></p>
<p><strong>証明終</strong></p>
<p><strong>注意:</strong> Markovの不等式, Chebyshevの不等式, Jensenの不等式, Gibbsの情報不等式などについては「Bernoulli試行と関連確率分布」のノートですでに説明していたのであった.</p>
</section>
<section id="chebyshevの不等式" class="level3">
<h3 class="anchored" data-anchor-id="chebyshevの不等式">Chebyshevの不等式</h3>
<p>Markovの不等式で <span class="math inline">\(X\)</span> を <span class="math inline">\((X-\mu)^2\)</span> (<span class="math inline">\(\mu=E[X]\)</span>) で置き換えた場合をChebyshevの不等式と呼ぶ.</p>
<p>確率変数 <span class="math inline">\(X\)</span> について <span class="math inline">\(E[|X|]&lt;\infty\)</span> が成立しているならば, <span class="math inline">\(X\)</span> の期待値 <span class="math inline">\(\mu = E[X]\)</span> がうまく定義されている. そのとき, <span class="math inline">\(X\)</span> の分散を <span class="math inline">\(\sigma^2 = E[(X-\mu)^2]\)</span> と書くと, 任意の <span class="math inline">\(\varepsilon&gt;0\)</span> について</p>
<p><span class="math display">\[
P(|X-\mu|\ge \varepsilon) \le \frac{\sigma^2}{\varepsilon^2}.
\]</span></p>
<p><strong>証明:</strong> 前節のMarkovの不等式を <span class="math inline">\(X\)</span>, <span class="math inline">\(a\)</span> がそれぞれ <span class="math inline">\((X-\mu)^2\)</span>, <span class="math inline">\(\varepsilon^2\)</span> の場合に適用すると,</p>
<p><span class="math display">\[
P(|X-\mu|\ge \varepsilon) = P((X-\mu)^2 \ge \varepsilon^2) \le \frac{1}{\varepsilon^2}E[(X-\mu)^2] = \frac{\sigma^2}{\varepsilon^2}.
\]</span></p>
<p><strong>証明終</strong></p>
</section>
<section id="大数の弱法則" class="level3">
<h3 class="anchored" data-anchor-id="大数の弱法則">大数の弱法則</h3>
<p><span class="math inline">\(X_1,X_2,X_3,\ldots\)</span> は独立同分布確率変数の列であるとし, 共通の期待値 <span class="math inline">\(\mu=E[X_i]\)</span> が定義されており, 共通の分散 <span class="math inline">\(\sigma^2 = E[(X_i-\mu)^2]\)</span> は有限の値であると仮定する. このとき, 最初の <span class="math inline">\(n\)</span> 個の標本平均を</p>
<p><span class="math display">\[
\bar{X}_n = \frac{1}{n}\sum_{i=1}^n X_i
\]</span></p>
<p>と書くと, 任意の <span class="math inline">\(\varepsilon&gt; 0\)</span> について,</p>
<p><span class="math display">\[
\lim_{n\to\infty} P(|\bar{X}_n - \mu|\ge\varepsilon) = 0.
\]</span></p>
<p><strong>注意:</strong> この結論は</p>
<p><span class="math display">\[
\lim_{n\to\infty} P(|\bar{X}_n - \mu| &lt; \varepsilon) = 1
\]</span></p>
<p>と同値なので標本平均 <span class="math inline">\(\bar{X}_n\)</span> の分布が <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(\mu\)</span> の近く(任意に小さな <span class="math inline">\(\varepsilon&gt;0\)</span> に関する <span class="math inline">\(\mu\)</span> から距離 <span class="math inline">\(\varepsilon\)</span> 未満の範囲)に集中して行くことを意味している. このとき <span class="math inline">\(\bar{X}_n\)</span> は <span class="math inline">\(\mu\)</span> に <strong>確率収束</strong> するというが, 標本平均 <span class="math inline">\(\bar{X}_n\)</span> の分布が <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(\mu\)</span> の近くに集中して行くことを理解していれば, 確率変数の収束に関する細かいことは応用上あまり神経質になる必要はない. だから, このノートでは「大数の弱法則」と「大数の強法則」の区別に神経質にならずに単に「大数の法則」ということが多い.</p>
<p><strong>証明:</strong> 標本平均 <span class="math inline">\(\bar{X}_n\)</span> の期待値と分散は以下のようになるのであった:</p>
<p><span class="math display">\[
\begin{aligned}
E[\bar{X}_n] &amp;= \frac{1}{n}\sum_{i=1}^n E[X_i]
= \frac{1}{n}\sum_{i=1}^n \mu = \mu,
\\
(\bar{X}_n - \mu)^2 &amp;=
\left(\frac{1}{n}\sum_{i=1}^n(X_i-\mu)\right)^2 =
\frac{1}{n^2}\sum_{i,j=1}^n (X_i-\mu)(X_j-\mu),
\\
\operatorname{var}(\bar{X}_n) &amp;=
E[(\bar{X}_n - \mu)^2] =
\frac{1}{n^2}\sum_{i,j=1}^n E[(X_i-\mu)(X_j-\mu)] =
\frac{1}{n^2}\sum_{i,j=1}^n \delta_{ij}\sigma^2 =
\frac{\sigma^2}{n}.
\end{aligned}
\]</span></p>
<p>最後から2つめの等号で <span class="math inline">\(X_i\)</span> 達が独立(特に無相関)であることを使った. ゆえに, Chebyshevの不等式を <span class="math inline">\(X\)</span>, <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\sigma^2\)</span> がそれぞれ <span class="math inline">\(\bar{X}_n\)</span>, <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\operatorname{var}(\bar{X}_n)=\sigma^2/n\)</span> の場合に適用すると, 任意の <span class="math inline">\(\varepsilon&gt;0\)</span> について,</p>
<p><span class="math display">\[
P(|\bar{X}_n - \mu|\ge\varepsilon) \le \frac{\sigma^2/n}{\varepsilon^2} \to 0 \quad \text{as $n\to\infty$}.
\]</span></p>
<p><strong>証明終</strong></p>
</section>
<section id="不偏分散の-ntoinfty-での挙動" class="level3">
<h3 class="anchored" data-anchor-id="不偏分散の-ntoinfty-での挙動">不偏分散の <span class="math inline">\(n\to\infty\)</span> での挙動</h3>
<p><span class="math inline">\(X_1,X_2,X_3,\ldots\)</span> は独立同分布確率変数の列であるとし, その最初の <span class="math inline">\(n\)</span> 個の標本平均と不偏分散をそれぞれ次のように書くことにする:</p>
<p><span class="math display">\[
\bar{X}_n = \frac{1}{n}\sum_{i=1}^n X_i, \quad
S_n^2 = \frac{1}{n-1}\sum_{i=1}^n (X_i - \bar{X}_n)^2.
\]</span></p>
<p>以下では <span class="math inline">\(\mu=E[X_i]\)</span> がうまく定義されており, <span class="math inline">\(\sigma^2=E[(X_i-\mu)^2]&lt;\infty\)</span>, <span class="math inline">\(E[|X_i-\mu|^3]&lt;\infty\)</span>, <span class="math inline">\(E[(X_i-\mu)^4]&lt;\infty\)</span> となっていると仮定する.</p>
<p>「標本分布について」のノートで以下を示していたのであった. <span class="math inline">\(X_i\)</span> 達が共通に従う分布の歪度(わいど, skewness)と尖度(せんど, kurtosis)をそれぞれ</p>
<p><span class="math display">\[
\bar\kappa_3 = E\left[\left(\frac{X_i-\mu}{\sigma}\right)^3\right], \quad
\bar\kappa_4 = E\left[\left(\frac{X_i-\mu}{\sigma}\right)^4\right] - 3
\]</span></p>
<p>と書くと,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
E[\bar{X}_n] = \mu, \quad
E[S_n^2] = \sigma^2,
\\ &amp;
\operatorname{var}(\bar{X}_n) = \frac{\sigma^2}{n}, \quad
\operatorname{cov}(\bar{X}_n, S_n^2) = \sigma^3\frac{\bar\kappa_3}{n}, \quad
\operatorname{var}(S_n^2) = \sigma^4\left(\frac{\bar\kappa_4}{n} + \frac{2}{n-1}\right).
\end{aligned}
\]</span></p>
<p>ゆえに, Chebyshevの不等式を <span class="math inline">\(X\)</span>, <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\sigma^2\)</span> がそれぞれ <span class="math inline">\(S_n^2\)</span>, <span class="math inline">\(E[S_n^2] = \sigma^2\)</span>, <span class="math inline">\(\operatorname{var}(S_n^2) = \sigma^4(\bar\kappa_4/n+2/(n-1))\)</span> の場合に適用すると, 任意の <span class="math inline">\(\varepsilon&gt;0\)</span> について,</p>
<p><span class="math display">\[
P(|S_n^2 - \sigma^2| \ge \varepsilon) \le
\frac{\sigma^4}{\varepsilon^2}\left(\frac{\bar\kappa_4}{n} + \frac{2}{n-1}\right) \to 0
\quad\text{as $n\to\infty$}.
\]</span></p>
<p>このように, 不偏分散 <span class="math inline">\(S_n^2\)</span> についても大数の弱法則が成立しており, <span class="math inline">\(S_n^2\)</span> の分布は <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(\sigma^2\)</span> の近くに集中して行く.</p>
</section>
<section id="大数の強法則" class="level3">
<h3 class="anchored" data-anchor-id="大数の強法則">大数の強法則</h3>
<p>この節の内容は無理して読まなくてもよい. 定義していない用語や記号法が登場する. 大数の強法則の取り扱いには測度論的確率論が必要になるが, この一連のノート群では測度論を避ける方針なので, 大数の強法則について詳しく説明することはできない. 以下で紹介する議論は「よく見る議論」のコピー＆ペーストに過ぎない. 必要な用語の定義もされていないし, 内容的にも雑である. しかし, 大数の強法則の証明の雰囲気を伝えたいと思ったので, このような説明をしてみることにした.</p>
<p>確率空間とは <span class="math inline">\(\sigma\)</span>-algebra (= <span class="math inline">\(\sigma\)</span>-field) <span class="math inline">\(\mathscr{F}\)</span> と確率測度 <span class="math inline">\(\mathscr{F}\ni A\mapsto P(A)\in{\mathbb R}_{\ge 0}\)</span> が与えられた集合 <span class="math inline">\(\Omega\)</span> のことである. 以下では確率空間 <span class="math inline">\(\Omega\)</span> 上の点を <span class="math inline">\(\omega\)</span> と表す. <span class="math inline">\(\Omega\)</span> 上の実数値可測函数を確率変数と呼ぶ.</p>
<section id="borel-cantelliの補題" class="level4">
<h4 class="anchored" data-anchor-id="borel-cantelliの補題">Borel-Cantelliの補題</h4>
<p>確率空間 <span class="math inline">\(\Omega\)</span> において次が成立する:</p>
<p><span class="math display">\[
\sum_{k=1}^\infty P(A_k) &lt; \infty \implies
P\left(\bigcap_{n=1}^\infty \bigcup_{k\ge n} A_k\right) = 0.
\]</span></p>
<p><strong>証明:</strong> <span class="math inline">\(\sum_{k=1}^\infty P(A_k) &lt; \infty\)</span> と仮定し, <span class="math inline">\(B_n = \bigcup_{k\ge n} A_k\)</span> とおく. <span class="math inline">\(P\left(\bigcap_{n=1}^\infty B_n\right) = 0\)</span> を示せばよい. <span class="math inline">\(\sum_{k=1}^\infty P(A_k) &lt; \infty\)</span> より,</p>
<p><span class="math display">\[
P(B_b) \le \sum_{k\ge n} P(A_k) =
\sum_{k=1}^\infty P(A_k) - \sum_{k=1}^{n-1} P(A_k) \to 0
\text{as $n\to\infty$}.
\]</span></p>
<p><span class="math inline">\(B_1\supset B_2\supset B_3\supset\cdots\)</span> なので</p>
<p><span class="math display">\[
P\left(\bigcap_{n=1}^\infty B_n\right) = \lim_{n\to\infty} P(B_n) = 0.
\]</span></p>
<p><strong>証明終</strong></p>
</section>
<section id="次以下のモーメントの存在を仮定した場合の大数の強法則" class="level4">
<h4 class="anchored" data-anchor-id="次以下のモーメントの存在を仮定した場合の大数の強法則">4次以下のモーメントの存在を仮定した場合の大数の強法則</h4>
<p><span class="math inline">\(X_1,X_2,X_3,\ldots\)</span> は独立同分布確率変数の列であるとし, その最初の <span class="math inline">\(n\)</span> 個の標本平均を <span class="math inline">\(\bar{X}_n = (1/n)\sum_{i=1}^n X_i\)</span> と書くことにする. さらに, <span class="math inline">\(\mu=E[X_i]\)</span> がうまく定義されており, <span class="math inline">\(\sigma^2=E[(X_i-\mu)^2]&lt;\infty\)</span>, <span class="math inline">\(\mu_4 = E[(X_i-\mu)^4]&lt;\infty\)</span> となっていると仮定する. このとき,</p>
<p><span class="math display">\[
P\left(\lim_{n\to\infty}\bar{X}_n = \mu\right) = 1.
\]</span></p>
<p><strong>注意:</strong> これは標本平均が <span class="math inline">\(\mu\)</span> に確率 <span class="math inline">\(1\)</span> で収束することを意味している.</p>
<p><strong>証明:</strong> 大数の弱法則の場合と同様に補事象の側の同値な主張を示す. すなわち, 確率変数(可測函数)としての標本平均 <span class="math inline">\(\bar{X}_n\)</span> が <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(\mu\)</span> に収束しない確率が <span class="math inline">\(0\)</span> であることを示そう.</p>
<p>確率変数(可測函数)としての最初の <span class="math inline">\(n\)</span> 個の標本平均 <span class="math inline">\(\bar{X}_n\)</span> の <span class="math inline">\(\omega\)</span> における値 <span class="math inline">\(\bar{X}_n(\omega)\)</span> が <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(\mu\)</span> に収束しないという条件は以下のように書き換えられる. すなわち,</p>
<p><span class="math display">\[
A_k(\varepsilon) = \{\,\omega\mid |\bar{X}_k(\omega)-\mu|\ge\varepsilon\,\}
\]</span></p>
<p>とおくと, 以下が成立している:</p>
<p><span class="math inline">\(\bar{X}_n(\omega)\)</span> は <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(\mu\)</span> に収束しない.<br> <span class="math inline">\(\iff\)</span> ある <span class="math inline">\(\varepsilon&gt;0\)</span> が存在して, 任意の <span class="math inline">\(n\)</span> について, ある <span class="math inline">\(k\ge n\)</span> で <span class="math inline">\(|\bar{X}_k(\omega)-\mu|\ge\varepsilon\)</span> を満たすものが存在する.<br> <span class="math inline">\(\iff\)</span> ある <span class="math inline">\(\varepsilon&gt;0\)</span> が存在して, $ <em>{n=1}<sup><em>{kn} A_k() $.<br> <span class="math inline">\(\iff\)</span> $ </em>{L=1}</sup></em>{n=1}^_{kn} A_k(1/L) $.</p>
<p>この条件の書き換えによって, 任意の <span class="math inline">\(\varepsilon&gt;0\)</span> について,</p>
<p><span class="math display">\[
\sum_{k=1}^\infty P(A_k(\varepsilon)) = \sum_{k=1}^\infty P(|\bar{X}_k-\mu|\ge\varepsilon) &lt; \infty
\]</span></p>
<p>を示せれば, Borel-Cantelliの補題より <span class="math inline">\(P\left(\bigcap_{n=1}^\infty \bigcup_{k\ge n} A_k(\varepsilon)\right) = 0\)</span> が得られ, それより</p>
<p><span class="math display">\[
P\left(\bigcup_{L=1}^\infty \bigcap_{n=1}^\infty \bigcup_{k\ge n} A_k(1/L)\right)
\le \sum_{L=1}^\infty P\left(\bigcap_{n=1}^\infty \bigcup_{k\ge n} A_k(1/L)\right)
=0
\]</span></p>
<p>が導かれ, <span class="math inline">\(\bar{X}_n\)</span> が <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(\mu\)</span> に収束しない確率が <span class="math inline">\(0\)</span> であることが示されることがわかる.</p>
<p>必要ならば <span class="math inline">\(X_i\)</span> を <span class="math inline">\(X_i-\mu\)</span> で置き換えることによって, <span class="math inline">\(\mu=0\)</span> と仮定しても一般性が失われないので, <span class="math inline">\(\mu=0\)</span> と仮定する.</p>
<p><span class="math inline">\(\varepsilon&gt;0\)</span> を任意に取る. このとき,</p>
<p><span class="math display">\[
P(|\bar{X}_n|\ge\varepsilon) =
P\left(\frac{\bar{X}_n^4}{\varepsilon^4}\ge 1\right) =
E\left[1_{\bar{X}_n^4/\varepsilon^4\ge 1}(\bar{X}_n)\right] \le
E\left[\frac{\bar{X}_n^4}{\varepsilon^4}\right] =
\frac{1}{\varepsilon^4}E\left[\bar{X}_n^4\right],
\]</span></p>
<p>でかつ</p>
<p><span class="math display">\[
\begin{aligned}
E\left[\bar{X}_n^4\right] &amp;=
\frac{1}{n^4}\sum_{i,j,k,l=1}^n E[X_i X_j X_k X_l] =
\frac{1}{n^4}\biggl(
n E[X_1^4] + \underbrace{\binom{4}{2}\binom{n}{2}}_{=3n(n-1)} E[X_1^2]^2
\biggr)
\\ &amp;=
\frac{\mu_4}{n^3} + \frac{3(n-1)\sigma^4}{n^3} \le
\frac{\mu_4 + 3\sigma^4}{n^2}
\end{aligned}
\]</span></p>
<p>なので,</p>
<p><span class="math display">\[
\sum_{k=1}^\infty P(A_k) =
\sum_{n=1}^\infty P(|\bar{X}_n|\ge\varepsilon) \le
\frac{\mu_4 + 3\sigma^4}{\varepsilon^4}\sum_{n=1}^\infty \frac{1}{n^2} &lt; \infty.
\]</span></p>
<p>これで示すべきことが示された.</p>
<p><strong>証明終</strong></p>
<p><strong>注意:</strong> 要するに, Borel-Cantelliの補題から, 任意の <span class="math inline">\(\varepsilon&gt; 0\)</span> について,</p>
<p><span class="math display">\[
\sum_{n=1}^\infty P(|\bar{X}_n-\mu|\ge\varepsilon) &lt; \infty
\]</span></p>
<p>を示せれば, 大数の強法則が証明される. 大数の弱法則の証明で示したことは</p>
<p><span class="math display">\[
P(|\bar{X}_n-\mu|\ge\varepsilon) \le \frac{\sigma^2}{\varepsilon^2}\frac{1}{n}
\]</span></p>
<p>に過ぎず, <span class="math inline">\(\sum_{n=1}1/n = \infty\)</span> と調和級数の和は無限大になるので, 大数の弱法則の証明の議論だけで大数の強法則を示すことはできない.</p>
<p><strong>注意:</strong> <span class="math inline">\(\zeta(s) = \sum_{n=1}^\infty 1/n^s\)</span> はRiemannのゼータ函数と呼ばれ, <span class="math inline">\(s=1\)</span> では調和級数になって無限大に発散するが, <span class="math inline">\(s &gt; 1\)</span> ならば有限の値に収束する. <span class="math inline">\(\zeta(2) = \sum_{n=1}^\infty 1/n^2\)</span> を求めよという問題は <strong>Basel問題</strong> (バーゼル問題)と呼ばれ, 18世紀の超大数学者のEulerが解いた. 答えは <span class="math inline">\(\pi^2/6\)</span> になる. その逆数の <span class="math inline">\(6/\pi^2 = 0.6079271{\cdots}\)</span> は2つの整数の互いに素になる(最大公約数が <span class="math inline">\(1\)</span> になる)「確率」に等しい.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fl">6</span><span class="op">/</span><span class="cn">π</span><span class="op">^</span><span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>0.6079271018540267</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="st">エラトステネスの篩(sieve of Eratosthenes)によって,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">以下の条件を満たす長さ `N` のビットベクトル `IsPrime` を作成する:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">&gt;`IsPrime = make_isprime(N)` のとき `IsPrime[p]` は `p` が素数なら真になり, 素数でないなら偽になる.</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">make_isprime</span>(N)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    IsPrime <span class="op">=</span> <span class="fu">trues</span>(N)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1は素数ではない</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    IsPrime[<span class="fl">1</span>] <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@inbounds</span> <span class="cf">for</span> p <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu">isqrt</span>(N)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> IsPrime[p]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">2</span>p<span class="op">:</span>p<span class="op">:</span>N</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 素数の非自明な倍数は素数ではない</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                IsPrime[i] <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    IsPrime</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="st">N以下の2つの正の整数が互いに素になる確率を篩法で求める.</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">prob_mutually_prime</span>(N)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    IsPrime <span class="op">=</span> <span class="fu">make_isprime</span>(N)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    C <span class="op">=</span> <span class="fu">trues</span>(N, N)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@inbounds</span> <span class="cf">for</span> p <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span>N</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> IsPrime[p]</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> p<span class="op">:</span>p<span class="op">:</span>N</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> j <span class="kw">in</span> i<span class="op">:</span>p<span class="op">:</span>N</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># 共通の素因数 p を持つ i, j を除外する</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>                    C[i, j] <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>                    C[j, i] <span class="op">=</span> <span class="cn">false</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> <span class="fu">count</span>(C)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    c<span class="op">/</span>N<span class="op">^</span><span class="fl">2</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>prob_mutually_prime</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@doc</span> make_isprime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<p>エラトステネスの篩(sieve of Eratosthenes)によって, 以下の条件を満たす長さ <code>N</code> のビットベクトル <code>IsPrime</code> を作成する:</p>
<blockquote class="blockquote">
<p><code>IsPrime = make_isprime(N)</code> のとき <code>IsPrime[p]</code> は <code>p</code> が素数なら真になり, 素数でないなら偽になる.</p>
</blockquote>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>IsPrime <span class="op">=</span> <span class="fu">make_isprime</span>(<span class="fl">100</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>primes <span class="op">=</span> <span class="fu">findall</span>(IsPrime) </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@show</span> primes;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1億以下の素数のリストの作成も一瞬で終わる.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@time</span> <span class="fu">make_isprime</span>(<span class="fl">10</span><span class="op">^</span><span class="fl">8</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  0.567799 seconds (3 allocations: 11.921 MiB, 3.45% gc time)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@time</span> <span class="fu">prob_mutually_prime</span>(<span class="fl">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  0.070674 seconds (5 allocations: 11.922 MiB)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0.60794971</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@time</span> <span class="fu">prob_mutually_prime</span>(<span class="fl">100000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 12.958103 seconds (5 allocations: 1.164 GiB, 0.12% gc time)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>0.6079301507</code></pre>
</div>
</div>
<p>10万以下の2つの正の整数が互いに素な確率を求めてみたが, 確かに理論値の <span class="math inline">\(1/\zeta(2) = 0.6079271{\cdots}\)</span> に近い値になっている.</p>
</section>
</section>
<section id="大数の強法則に関する文献" class="level3">
<h3 class="anchored" data-anchor-id="大数の強法則に関する文献">大数の強法則に関する文献</h3>
<p>大数の強法則は前節で採用した条件よりもずっと弱い条件のもとで成立している. そのようなことに興味がある人達は以下の文献を参照せよ.</p>
<ul>
<li><p>N. Etemadi, An elementary proof of the strong law of large numbers, Zeitschrift für Wahrscheinlichkeitstheorie und Verwandte Gebiete volume 55, pages 119–122 (1981) [<a href="https://link.springer.com/article/10.1007/BF01013465#citeas">Springer</a>] [<a href="https://people.math.umass.edu/~yaoli/ptrl.pdf">pdf</a>]</p></li>
<li><p>N. Lizia, A simple proof of the strong law of large numbers with rates, Bulletin of the Australian Mathematical Society, Volume 97, Issue 3, June 2018, pp.&nbsp;513 - 517. [<a href="https://doi.org/10.1017/S0004972718000059">doi</a>] [<a href="http://www.im.ufrj.br/nuno/SLLN.pdf">pdf</a>]</p></li>
</ul>
<p><span class="math inline">\(X_1,X_2,X_3,\ldots\)</span> が同分布な確率変数の列であるとし, 共通の期待値 <span class="math inline">\(\mu=E[X_i]\)</span> のwell-definedness (<span class="math inline">\(E[|X_i|]&lt;\infty\)</span>)を仮定する.</p>
<p>前者の文献では, <span class="math inline">\(X_1,X_2,X_3,\ldots\)</span> に関する(独立性よりもずっと弱い)対ごとの独立性の仮定のもとで大数の強法則を証明している(分散の有限性も仮定していない).</p>
<p>後者の文献では, <span class="math inline">\(X_1,X_2,X_3,\ldots\)</span> の独立性と分散の有限性(<span class="math inline">\(\sigma^2 = \operatorname{var}(X_i)&lt;\infty\)</span>)のもとで, 収束の速さが分かるような大数の強法則の証明を与えている.</p>
</section>
<section id="問題-大数の法則に関する誤解" class="level3">
<h3 class="anchored" data-anchor-id="問題-大数の法則に関する誤解">問題: 大数の法則に関する誤解</h3>
<p>当たりとはずれが毎回独立ににどちらも <span class="math inline">\(50\%\)</span> の確率で出るルーレットを回し続ける状況を考える. 当たりが出たら, 胴元から1万円もらい, はずれが出たら1万円支払うというルールになっているとする. この賭け事に参加しているある人がこう言った:</p>
<blockquote class="blockquote">
<p>はずれの方が沢山出続けてたくさん負けてしまった! でも, 確率論の大数の法則によって, これからは当たりの方が出易くなって, 負けは帳消しになるだろう.</p>
</blockquote>
<p>この発言が間違っていることについて説明せよ.</p>
<p><strong>解答例:</strong> 大数の法則は, はずれが沢山出た後に当たりの方が出易くなったり, 当たりが沢山出たあとにはずれが出易くなることによって成立するのではない.</p>
<p>例えば, いきなり <span class="math inline">\(10\)</span> 回続けてはずれが出てしまったとする.</p>
<p>その後の90回分では, 当たりとはずれが両方とも45回出たとする. そのとき, トータルでの当たりが出たの割合は <span class="math inline">\(55/100=55\%\)</span> で <span class="math inline">\(50\%\)</span> に近付く.</p>
<p>はずれ10回後の990回分でも, 当たりとはずれがどちらも同じ回数の495回出たとする. そのとき, トータルでの当たりが出た割合は　<span class="math inline">\(505/1000 = 50.5\%\)</span> でさらに <span class="math inline">\(50\%\)</span> に近付く.</p>
<p>そのとき, 最初に10回外れを引いて10万円負けていたその人は, 大数の法則が予想する結果に近付いているにもかかわらず, 1000回の勝負で最初に負けた10万円を取り戻せていない.</p>
<p>大数の法則は単に公平なギャンブルを続けると勝ちの回数の割合と負けの回数の割合が <span class="math inline">\(50\%\)</span> に近付くことを主張しているだけで, 沢山負けた後に勝ち易くなったり, その逆が起こることを何も主張していない.</p>
<p><strong>解答終</strong></p>
<p>他にも沢山の正しい解答例を作れると思います.</p>
</section>
<section id="大数の法則のデモンストレーション" class="level3">
<h3 class="anchored" data-anchor-id="大数の法則のデモンストレーション">大数の法則のデモンストレーション</h3>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_law_of_large_numbers</span>(dist, N;</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>        randfunc <span class="op">=</span> rand, μ <span class="op">=</span> <span class="fu">mean</span>(dist), kwargs<span class="op">...</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> <span class="fu">randfunc</span>(dist, N)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    X̄ <span class="op">=</span> <span class="fu">cumsum</span>(X) <span class="op">./</span> (<span class="fl">1</span><span class="op">:</span>N)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(<span class="fl">1</span><span class="op">:</span>N, X̄; label<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hline!</span>([μ]; label<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(; kwargs<span class="op">...</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_law_of_large_numbers_6x3</span>(dist, N;</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        randfunc <span class="op">=</span> rand, μ <span class="op">=</span> <span class="fu">mean</span>(dist), seed <span class="op">=</span> <span class="fl">4649363</span>, title <span class="op">=</span> <span class="st">""</span>, kwargs<span class="op">...</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Random</span>.<span class="fu">seed!</span>(seed)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    PP <span class="op">=</span> []</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">18</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        P <span class="op">=</span> <span class="fu">plot_law_of_large_numbers</span>(dist, N; randfunc, μ, kwargs<span class="op">...</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">push!</span>(PP, P)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    P0 <span class="op">=</span> <span class="fu">plot</span>(; title,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        framestyle<span class="op">=</span><span class="cn">nothing</span>, showaxis<span class="op">=</span><span class="cn">false</span>, ticks<span class="op">=</span><span class="cn">false</span>, margin<span class="op">=</span><span class="fl">0</span>Plots.mm)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">=</span> <span class="pp">@layout</span> [a{<span class="fl">0.005</span>h}; <span class="fu">grid</span>(<span class="fl">6</span>, <span class="fl">3</span>)]</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(P0, PP<span class="op">...</span>; size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">800</span>), layout,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        titlefontsize<span class="op">=</span><span class="fl">12</span>, guidefontsize<span class="op">=</span><span class="fl">8</span>, tickfontsize<span class="op">=</span><span class="fl">6</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>plot_law_of_large_numbers_6x3 (generic function with 1 method)</code></pre>
</div>
</div>
<section id="bernoulli試行" class="level4">
<h4 class="anchored" data-anchor-id="bernoulli試行">Bernoulli試行</h4>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_law_of_large_numbers_6x3</span>(<span class="fu">Bernoulli</span>(<span class="fl">0.3</span>), <span class="fl">2</span><span class="op">^</span><span class="fl">12</span>;</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Law of large numbers for Bernoulli(0.3)"</span>, ylim<span class="op">=</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="正規分布のサンプルの場合" class="level4">
<h4 class="anchored" data-anchor-id="正規分布のサンプルの場合">正規分布のサンプルの場合</h4>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_law_of_large_numbers_6x3</span>(<span class="fu">Normal</span>(<span class="fl">2</span>, <span class="fl">3</span>), <span class="fl">2</span><span class="op">^</span><span class="fl">12</span>;</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Law of large numbers for Normal(2, 3)"</span>, ylim<span class="op">=</span>(<span class="fl">1</span>, <span class="fl">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="ガンマ分布の場合" class="level4">
<h4 class="anchored" data-anchor-id="ガンマ分布の場合">ガンマ分布の場合</h4>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_law_of_large_numbers_6x3</span>(<span class="fu">Gamma</span>(<span class="fl">2</span>, <span class="fl">3</span>), <span class="fl">2</span><span class="op">^</span><span class="fl">12</span>;</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Law of large numbers for Gamma(2, 3)"</span>, ylim<span class="op">=</span>(<span class="fl">5</span>, <span class="fl">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="大数の法則が成立しない場合-cauchy分布" class="level4">
<h4 class="anchored" data-anchor-id="大数の法則が成立しない場合-cauchy分布">大数の法則が成立しない場合: Cauchy分布</h4>
<p>確率密度函数が</p>
<p><span class="math display">\[
p(x) = \frac{1}{\pi}\frac{1}{1 + x^2}
\]</span></p>
<p>のCauchy分布 <span class="math inline">\(\operatorname{Cauchy}()\)</span> に従う確率変数 <span class="math inline">\(X\)</span> については</p>
<p><span class="math display">\[
E[|X|] = \frac{2}{\pi}\int_0^\infty \frac{x}{1+x^2}\,dx = \infty
\]</span></p>
<p>なので, 期待値 <span class="math inline">\(E[X]\)</span> が定義されない. Cauchy分布の場合には大数の法則は成立しない.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_law_of_large_numbers_6x3</span>(<span class="fu">Cauchy</span>(), <span class="fl">2</span><span class="op">^</span><span class="fl">12</span>; μ <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"Law of large numbers for Cauchy() does not hold"</span>, ylim<span class="op">=</span>(<span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>注意:</strong> <span class="math inline">\(X_1,X_2,\ldots,X_n\)</span> がCauchy分布のサイズ <span class="math inline">\(n\)</span> の標本であるとき, その標本平均 <span class="math inline">\(\bar{X}\)</span> もCauchy分布に従うことを示せる. そのことはCauchy分布の特性函数が</p>
<p><span class="math display">\[
\varphi(t) = E[e^{itX}] = e^{-|t|} \quad (X\sim\operatorname{Cauchy}())
\]</span></p>
<p>となることを認めれば容易に確認できる(この公式のよくある証明では複素解析を使う). 実際, これを認めると,</p>
<p><span class="math display">\[
E[e^{it\bar{X}}] = \phi\left(\frac{t}{n}\right)^n =
(e^{-|t/n|})^n = e^{-|t|} = \varphi(t) = E[e^{itX}].
\]</span></p>
<p><span class="math inline">\(\bar{X}\)</span> と <span class="math inline">\(X\sim\operatorname{Cauchy}()\)</span> の特性函数が等しいので <span class="math inline">\(\bar{X}\sim\operatorname{Cauchy}()\)</span>.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_cauchy</span>(n; dist<span class="op">=</span><span class="fu">Cauchy</span>(), L<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span>, xlim<span class="op">=</span>(<span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>), kwargs<span class="op">...</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    X̄ <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, L)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> [<span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, n) for _ <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="bu">Threads</span>.<span class="fu">nthreads</span>()]</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Threads</span>.<span class="pp">@threads</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>L</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="fu">rand!</span>(dist, tmp[<span class="bu">Threads</span>.<span class="fu">threadid</span>()])</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        X̄[i] <span class="op">=</span> <span class="fu">mean</span>(X)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    a, b <span class="op">=</span> <span class="fu">quantile</span>.(<span class="fu">Ref</span>(X̄), (<span class="fl">0.001</span>, <span class="fl">0.999</span>))</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stephist</span>(X̄; bin<span class="op">=</span>a<span class="op">:</span><span class="fl">0.1</span><span class="op">:</span>b, norm<span class="op">=</span><span class="cn">true</span>, label<span class="op">=</span><span class="st">"X̄"</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(<span class="fu">Cauchy</span>(), xlim<span class="op">...</span>; label<span class="op">=</span><span class="st">"Cauchy()"</span>, ls<span class="op">=:</span>dash)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title!</span>(<span class="st">"Sample means of n = </span><span class="sc">$</span>n<span class="st"> size samples of Cauchy()"</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(; xlim, kwargs<span class="op">...</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>plot_cauchy (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_cauchy</span>(<span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="大数の法則が成立しない場合-pólyaの壺" class="level4">
<h4 class="anchored" data-anchor-id="大数の法則が成立しない場合-pólyaの壺">大数の法則が成立しない場合: Pólyaの壺</h4>
<p><span class="math inline">\(\alpha, \beta &gt; 0\)</span> であると仮定する. パラメータ <span class="math inline">\((\alpha,\beta)\)</span> から <span class="math inline">\(1\)</span> の出る確率が <span class="math inline">\(\alpha/(\alpha+\beta)\)</span> と, <span class="math inline">\(0\)</span> が出る確率が <span class="math inline">\(\beta/(\alpha+\beta)\)</span> と決まっているとする. そして, <span class="math inline">\(1\)</span> が出たら, パラメータが <span class="math inline">\((\alpha,\beta)\mapsto(\alpha+1,\beta)\)</span> と更新され, <span class="math inline">\(0\)</span> が出たら, パラメータが　<span class="math inline">\((\alpha,\beta)\mapsto(\alpha,\beta+1)\)</span> と更新されると仮定する. このようにして <span class="math inline">\(1,0\)</span> の列 <span class="math inline">\(X_1,X_2,X_3,\ldots\)</span> がランダムに得られる試行を <strong>Pólyaの壺</strong> の試行と呼ぶことにする.</p>
<p>Pólyaの壺では <span class="math inline">\(1\)</span> が出るとその次に <span class="math inline">\(1\)</span> が出る確率は上昇し, <span class="math inline">\(0\)</span> が出るとその次に <span class="math inline">\(0\)</span> が出る確率は上昇する. <strong>Pólyaの壺</strong> の試行では独立性の仮定が満たされていない. 実際, <strong>Pólyaの壺</strong> の試行の <span class="math inline">\(n\)</span> 回分の出目が <span class="math inline">\((x_1,\ldots,x_n)\in\{1,0\}^n\)</span> になる確率は, <span class="math inline">\(x_1,\ldots,x_n\)</span> の中に <span class="math inline">\(1\)</span> がちょうど <span class="math inline">\(k\)</span> 個含まれているとき,</p>
<p><span class="math display">\[
P(x_1,\ldots,x_n|\alpha,\beta) =
\binom{n}{k}
\frac
{\alpha(\alpha+1)\cdots(\alpha+k-1)\;
\beta(\beta+1)\cdots(\beta+n-k-1)}
{(\alpha+\beta)(\alpha+\beta+1)\cdots(\alpha+\beta+n-1)}
\]</span></p>
<p>と書ける. (「確率分布達の解釈」のノートに詳しい説明がある.)</p>
<p>しかし, <span class="math inline">\(n-1\)</span> 回目までの出目に条件を付けないとき, <span class="math inline">\(n\)</span> 番目に <span class="math inline">\(1\)</span> が出る確率は <span class="math inline">\(n\)</span> によらず <span class="math inline">\(\alpha/(\alpha+\beta)\)</span> のまま一定であることを示せる. すなわち, 各 <span class="math inline">\(X_n\)</span> が従う確率分布は <span class="math inline">\(n\)</span> によらずにどれも成功確率 <span class="math inline">\(\alpha/(\alpha+\beta)\)</span> のBernoulli分布になる. <strong>Pólyaの壺</strong> の試行では同分布の仮定は満たされている.</p>
<p><strong>Pólyaの壺</strong> の試行で得られる <span class="math inline">\(1,0\)</span> の列 <span class="math inline">\(X_1,X_2,X_3,\ldots\)</span> については大数の法則は成立しない. その <span class="math inline">\(n\)</span> 番目までの標本平均 <span class="math inline">\(\bar{X}_n\)</span> はベータ二項分布 <span class="math inline">\(\operatorname{BetaBinomial}(n,\alpha,\beta)\)</span> に従い, <span class="math inline">\(n\)</span> が大きなときに <span class="math inline">\(\bar{X}_n\)</span> はベータ分布 <span class="math inline">\(\operatorname{Beta}(\alpha,\beta)\)</span> に近似的に従う. そうなることは,</p>
<p><span class="math display">\[
P(x_1,\ldots,x_n|\alpha,\beta) =
\int_0^1 \prod_{i=1}^n\left(p^{x_i}(1-p)^{1-x_i}\right)
\frac{p^{\alpha-1}(1-p)^{\beta-1}}{B(\alpha,\beta)}\,dp
\]</span></p>
<p>なので, <strong>Pólyaの壺</strong> の試行が成功確率 <span class="math inline">\(p\)</span> がベータ分布 <span class="math inline">\(\operatorname{Beta}(\alpha,\beta)\)</span> に従ってランダムに決まっているようなBernoulli試行であることから分かる.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_law_of_large_numbers_6x3</span>(<span class="fu">Beta</span>(<span class="fl">4</span>, <span class="fl">6</span>), <span class="fl">2</span><span class="op">^</span><span class="fl">10</span>;</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    randfunc <span class="op">=</span> (dist, n) <span class="op">-&gt;</span> (p <span class="op">=</span> <span class="fu">rand</span>(dist); <span class="fu">rand</span>(<span class="fu">Bernoulli</span>(p), n)), ylim<span class="op">=</span>(<span class="op">-</span><span class="fl">0.02</span>, <span class="fl">1.02</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">rand_polyaurn</span>(beta<span class="op">::</span><span class="dt">Beta</span>, n)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    α, β <span class="op">=</span> Distributions.<span class="fu">params</span>(beta)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{Int8}</span>(<span class="cn">undef</span>, n)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="fu">rand</span>(<span class="fu">Bernoulli</span>(α<span class="op">/</span>(α<span class="op">+</span>β)))</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>        X[i] <span class="op">=</span> x</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x <span class="op">==</span> <span class="fl">1</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>            α <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>            β <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    X</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_law_of_large_numbers_6x3</span>(<span class="fu">Beta</span>(<span class="fl">4</span>, <span class="fl">6</span>), <span class="fl">2</span><span class="op">^</span><span class="fl">10</span>;</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    randfunc <span class="op">=</span> rand_polyaurn, ylim<span class="op">=</span>(<span class="op">-</span><span class="fl">0.02</span>, <span class="fl">1.02</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_polyaurn</span>(n, α, β, bin<span class="op">=:</span>auto; L<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span>, kwargs<span class="op">...</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    X̄ <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, L)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> [<span class="fu">Vector</span><span class="dt">{Int}</span>(<span class="cn">undef</span>, n) for _ <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="bu">Threads</span>.<span class="fu">nthreads</span>()]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Threads</span>.<span class="pp">@threads</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>L</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="fu">rand</span>(<span class="fu">Beta</span>(α, β))</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="fu">rand!</span>(<span class="fu">Bernoulli</span>(p), tmp[<span class="bu">Threads</span>.<span class="fu">threadid</span>()])</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        X̄[i] <span class="op">=</span> <span class="fu">mean</span>(X)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stephist</span>(X̄; norm<span class="op">=</span><span class="cn">true</span>, bin, label<span class="op">=</span><span class="st">"X̄"</span>)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(<span class="fu">Beta</span>(α, β), <span class="fl">0</span>, <span class="fl">1</span>; label<span class="op">=</span><span class="st">"Beta(α, β)"</span>, ls<span class="op">=:</span>dash)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title!</span>(<span class="st">"Pólya's urn for n=</span><span class="sc">$</span>n<span class="st">, α=</span><span class="sc">$</span><span class="st">α, β=</span><span class="sc">$</span><span class="st">β")</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="st">    </span>plot<span class="st">!(; xtick=0:0.1:1, kwargs...)</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>plot_polyaurn (generic function with 2 methods)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">plot_polyaurn</span>.((<span class="fl">10</span>, <span class="fl">30</span>), <span class="fl">4</span>, <span class="fl">6</span>, (<span class="fl">0</span><span class="op">:</span><span class="fl">0.1</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">0.1</span><span class="op">:</span><span class="fl">1</span>))<span class="op">...</span>; size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">plot_polyaurn</span>.((<span class="fl">100</span>, <span class="fl">300</span>), <span class="fl">4</span>, <span class="fl">6</span>, (<span class="fl">0</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">1</span>))<span class="op">...</span>; size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
<section id="二項分布の中心極限定理" class="level2">
<h2 class="anchored" data-anchor-id="二項分布の中心極限定理">二項分布の中心極限定理</h2>
<section id="二項分布の中心極限定理の内容" class="level3">
<h3 class="anchored" data-anchor-id="二項分布の中心極限定理の内容">二項分布の中心極限定理の内容</h3>
<p>二項分布 <span class="math inline">\(\operatorname{Binomial}(n, p)\)</span> が正規分布 <span class="math inline">\(\operatorname{Normal}\left(np, \sqrt{np(1-p)}\right)\)</span> で近似されることを <strong>二項分布の中心極限定理</strong> と呼ぶことにしよう. (ただしその近似の精度をよくするためには <span class="math inline">\(np\)</span> と <span class="math inline">\(n(1-p)\)</span> をある程度以上に大きくする必要がある. 「大きくする」と言っても粗い近似でよければ3から5程度でも十分な場合がある.)</p>
<p>二項分布の中心極限定理には以下のような様々な言い換えがある. <span class="math inline">\(0&lt;p&lt;1\)</span> と仮定し, <span class="math inline">\(n\)</span> は十分に大きいと仮定する. そのとき,</p>
<ol type="1">
<li><p><span class="math inline">\(K\sim\operatorname{Binomial}(n, p)\)</span> ならば <span class="math inline">\(K\)</span> の分布は平均 <span class="math inline">\(np\)</span>, 分散 <span class="math inline">\(np(1-p)\)</span> の正規分布で近似される.</p></li>
<li><p><span class="math inline">\(K\sim\operatorname{Binomial}(n, p)\)</span> ならば <span class="math inline">\(\dfrac{K}{n}\)</span> の分布は平均 <span class="math inline">\(p\)</span>, 分散 <span class="math inline">\(p(1-p)/n\)</span> の正規分布で近似される.</p></li>
<li><p><span class="math inline">\(K\sim\operatorname{Binomial}(n, p)\)</span> ならば <span class="math inline">\(\dfrac{K-np}{\sqrt{n}}\)</span> の分布は平均 <span class="math inline">\(0\)</span>, 分散 <span class="math inline">\(p(1-p)\)</span> の正規分布で近似される.</p></li>
<li><p><span class="math inline">\(K\sim\operatorname{Binomial}(n, p)\)</span> ならば <span class="math inline">\(\dfrac{K-np}{\sqrt{np(1-p)}}\)</span> の分布は標準正規分布で近似される.</p></li>
</ol>
<p>例えば, (1)の結果は, <span class="math inline">\(K\sim\operatorname{Binomial}(n, p)\)</span>, <span class="math inline">\(X\sim \operatorname{Normal}\left(np, \sqrt{np(1-p)}\right)\)</span> のとき,</p>
<p><span class="math display">\[
P(K \le a) \approx P(X \le a)
\]</span></p>
<p>という近似を使えることを意味する. (2),(3),(4)についても同様のことが言える. これを使うと, 二項分布における確率を対応する正規分布の確率で置き換えて近似計算できる. 二項分布に限らず, 正規分布で近似できる確率分布であれば, どのような分布であっても確率の計算を正規分布という一種類の分布における確率で近似的に計算できる.</p>
<p>例えば, (4)の結果は, <span class="math inline">\(K\sim\operatorname{Binomial}(n, p)\)</span> のとき,</p>
<p><span class="math display">\[
E\left[f\left(\dfrac{K-np}{\sqrt{np(1-p)}}\right)\right] =
\sum_{k=0}^n f\left(\dfrac{k-np}{\sqrt{np(1-p)}}\right)
\binom{n}{k}p^k(1-p)^{n-k}
\]</span></p>
<p>が, <span class="math inline">\(n\to\infty\)</span> で, <span class="math inline">\(Z\sim\operatorname{Normal}(0,1)\)</span> に関する</p>
<p><span class="math display">\[
E[f(Z)] = \int_{-\infty}^\infty f(z)\frac{e^{-z^2/2}}{\sqrt{2\pi}}\,dz.
\]</span></p>
<p>に収束することと同じことだと考えてよい. (3)についても同様のことが言える.</p>
</section>
<section id="二項分布の中心極限定理のプロット" class="level3">
<h3 class="anchored" data-anchor-id="二項分布の中心極限定理のプロット">二項分布の中心極限定理のプロット</h3>
<p>以下は, 試行回数 <span class="math inline">\(n\)</span>, 成功確率 <span class="math inline">\(p\)</span> の二項分布(期待値と分散はそれぞれ <span class="math inline">\(np\)</span>, <span class="math inline">\(np(1-p)\)</span> になる)の確率質量函数と平均 <span class="math inline">\(np\)</span>, 分散 <span class="math inline">\(np(1-p)\)</span> を持つ正規分布の確率密度函数の同時プロットである. それらを見れば, 証明しなくても, 二項分布の中心極限定理が成立していることは明らかだろう. (証明する前にコンピュータでグラフを確認するべき!)</p>
<p><strong>注意:</strong> 以下のグラフを見れば, 二項分布の正規分布近似の精度を高めるためには, <span class="math inline">\(p\)</span> が小さいほど <span class="math inline">\(n\)</span> を大きくする必要があることがわかる. (<span class="math inline">\(p\)</span> が <span class="math inline">\(1\)</span> に近い場合にも <span class="math inline">\(n\)</span> を大きくする必要がある.)</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_binomial_clt</span>(n, p, s <span class="op">=</span> <span class="fl">1</span>; c <span class="op">=</span> <span class="fl">4.5</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    μ, σ <span class="op">=</span> n<span class="op">*</span>p, <span class="fu">√</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> (μ<span class="op">-</span>c<span class="op">*</span>σ, μ<span class="op">+</span>c<span class="op">*</span>σ)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p), x), xlim<span class="op">...</span>; label<span class="op">=</span><span class="st">"Binomial(n,p)"</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(<span class="fu">Normal</span>(μ, σ), xlim<span class="op">...</span>; label<span class="op">=</span><span class="st">"Normal(μ,σ)"</span>, lw<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot!(x -&gt; mypdf(Poisson(μ), x), xlim...; label="Poisson(μ)", ls=:dash)</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title!</span>(<span class="st">"n = </span><span class="sc">$</span>n<span class="st">, p = </span><span class="sc">$</span>p<span class="st">, μ=np, σ²=np(1-p)"</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(; xtick<span class="op">=</span><span class="fl">0</span><span class="op">:</span>s<span class="op">:</span>n)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>plot_binomial_clt (generic function with 2 methods)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">plot_binomial_clt</span>(<span class="fl">10</span>, <span class="fl">0.3</span>), <span class="fu">plot_binomial_clt</span>(<span class="fl">10</span>, <span class="fl">0.1</span>); size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">plot_binomial_clt</span>(<span class="fl">40</span>, <span class="fl">0.3</span>, <span class="fl">2</span>), <span class="fu">plot_binomial_clt</span>(<span class="fl">40</span>, <span class="fl">0.1</span>); size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">plot_binomial_clt</span>(<span class="fl">160</span>, <span class="fl">0.3</span>, <span class="fl">5</span>), <span class="fu">plot_binomial_clt</span>(<span class="fl">160</span>, <span class="fl">0.1</span>, <span class="fl">2</span>); size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="必修重要問題-二項分布の正規分布近似を使った確率の近似計算1" class="level3">
<h3 class="anchored" data-anchor-id="必修重要問題-二項分布の正規分布近似を使った確率の近似計算1">必修重要問題: 二項分布の正規分布近似を使った確率の近似計算1</h3>
<p>確率変数 <span class="math inline">\(K\)</span> は二項分布 <span class="math inline">\(\operatorname{Binomial}(100, 1/2)\)</span> に従っていると仮定する.</p>
<ol type="1">
<li><p>確率 <span class="math inline">\(P(K \le 40)\)</span> を小数点以下第5桁まで求めよ.</p></li>
<li><p>二項分布 <span class="math inline">\(\operatorname{Binomial}(100, 1/2)\)</span> と同じ期待値と分散を持つ正規分布に従う確率変数 <span class="math inline">\(X\)</span> について確率 <span class="math inline">\(P(X \le 40)\)</span> を小数点以下第5桁まで求めよ.</p></li>
</ol>
<p><strong>解答例:</strong></p>
<ol type="1">
<li><span class="math inline">\(K\sim \operatorname{Binomial}(100, 1/2)\)</span> のとき,</li>
</ol>
<p><span class="math display">\[
P(K \le 40) \approx 0.02844
\]</span></p>
<ol start="2" type="1">
<li>一般に <span class="math inline">\(\operatorname{Binomial}(n, p)\)</span> の平均と分散はそれぞれ <span class="math inline">\(\mu=np\)</span>, <span class="math inline">\(\sigma^2=np(1-p)\)</span> なので, <span class="math inline">\(n=100\)</span>, <span class="math inline">\(p=1/2\)</span> の場合は <span class="math inline">\(\mu=50\)</span>, <span class="math inline">\(\sigma^2=25\)</span>, <span class="math inline">\(\sigma=5\)</span> なので, <span class="math inline">\(X\sim \operatorname{Normal}(50, 5)\)</span> で</li>
</ol>
<p><span class="math display">\[
P(X \le 40) \approx 0.02275
\]</span></p>
<p><strong>解答終</strong></p>
<section id="wolframalphaによる計算1" class="level4">
<h4 class="anchored" data-anchor-id="wolframalphaによる計算1">WolframAlphaによる計算1</h4>
<ol type="1">
<li><p><a href="https://www.wolframalpha.com/input?i=cdf%28BinomialDistribution%28n%2C+p%29%2C+40%29+where+n%3D100%2C+p%3D0.5">cdf(BinomialDistribution(n, p), 40) where n=100, p=0.5</a></p></li>
<li><p><a href="https://www.wolframalpha.com/input?i=cdf%28NormalDistribution%2850%2C+5%29%2C+40%29">cdf(NormalDistribution(50, 5), 40)</a></p></li>
</ol>
</section>
<section id="julia言語による計算1" class="level4">
<h4 class="anchored" data-anchor-id="julia言語による計算1">Julia言語による計算1</h4>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>n, p <span class="op">=</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>(100, 0.5)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1)</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>p_B <span class="op">=</span> <span class="fu">cdf</span>(<span class="fu">Binomial</span>(n, p), <span class="fl">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>0.028443966820490434</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (2)</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>q_N <span class="op">=</span> <span class="fu">cdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>p, <span class="fu">√</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p))), <span class="fl">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>0.022750131948179205</code></pre>
</div>
</div>
</section>
<section id="julia言語による視覚化1" class="level4">
<h4 class="anchored" data-anchor-id="julia言語による視覚化1">Julia言語による視覚化1</h4>
<div class="cell" data-scrolled="true" data-execution_count="30">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>n, p <span class="op">=</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>(100, 0.5)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p), x), <span class="fl">30</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>p]; label<span class="op">=</span><span class="st">"np"</span>, c<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p), x), <span class="fl">30</span>, <span class="fl">40.5</span>;</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=</span><span class="fl">1</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>prob <span class="op">=</span> <span class="fu">cdf</span>(<span class="fu">Binomial</span>(n, p), <span class="fl">40</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(<span class="fl">35</span>, <span class="fl">0.01</span>, <span class="fu">text</span>(<span class="pp">@sprintf</span>(<span class="st">"%0.5f"</span>, prob), <span class="fl">10</span>, <span class="op">:</span>blue))</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([<span class="fl">40</span>]; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>gray)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"Binomial(n = </span><span class="sc">$</span>n<span class="st">, p = </span><span class="sc">$</span>p<span class="st">)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (2)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>p, <span class="fu">√</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p))), x), <span class="fl">30</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>blue, ls<span class="op">=:</span>dash)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>p]; label<span class="op">=</span><span class="st">"np"</span>, ls<span class="op">=:</span>dashdot, c<span class="op">=:</span>blue)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>p, <span class="fu">√</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p))), x), <span class="fl">30</span>, <span class="fl">40</span>;</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=:</span>blue, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>prob <span class="op">=</span> <span class="fu">cdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>p, <span class="fu">√</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p))), <span class="fl">40</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(<span class="fl">35</span>, <span class="fl">0.01</span>, <span class="fu">text</span>(<span class="pp">@sprintf</span>(<span class="st">"%0.5f"</span>, prob), <span class="fl">10</span>, <span class="op">:</span>blue))</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([<span class="fl">40</span>]; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>gray)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"Normal(μ = </span><span class="sc">$</span>n<span class="st">×</span><span class="sc">$</span>p<span class="st">, σ = √</span><span class="sc">$</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p))<span class="st">)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) and (2)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p), x), <span class="fl">30</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>p]; label<span class="op">=</span><span class="st">"np"</span>, c<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>p, <span class="fu">√</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p))), x), <span class="fl">30</span>, <span class="fl">70</span>;</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>blue, ls<span class="op">=:</span>dash)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">#vline!([n*p]; label="np", ls=:dashdot, c=:blue)</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([<span class="fl">40</span>]; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>gray)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"Binomial(n = </span><span class="sc">$</span>n<span class="st">, p = </span><span class="sc">$</span>p<span class="st">) and normal approx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="必修重要問題-二項分布の正規分布近似を使った確率の近似計算2" class="level3">
<h3 class="anchored" data-anchor-id="必修重要問題-二項分布の正規分布近似を使った確率の近似計算2">必修重要問題: 二項分布の正規分布近似を使った確率の近似計算2</h3>
<p><span class="math inline">\(0 &lt; p &lt; 1\)</span> であると仮定し, <span class="math inline">\(K\)</span> は二項分布 <span class="math inline">\(\operatorname{Binomial}(100, p)\)</span> に従う確率変数であるとする.</p>
<ol type="1">
<li><p><span class="math inline">\(P(K \le 40) = 0.025\)</span> を満たす <span class="math inline">\(p\)</span> の値 <span class="math inline">\(p_U\)</span> を小数点以下第4桁まで求めよ.</p></li>
<li><p><span class="math inline">\(P(K \ge 40) = 0.025\)</span> を満たす <span class="math inline">\(p\)</span> の値 <span class="math inline">\(p_L\)</span> を小数点以下第4桁まで求めよ.</p></li>
</ol>
<p><span class="math inline">\(\hat{p}=40/100=0.4\)</span> とおく. <span class="math inline">\(X\)</span> は <span class="math inline">\(K\)</span> と同じ平均 <span class="math inline">\(np\)</span> と推定された分散 <span class="math inline">\(n\hat{p}(1-\hat{p})\)</span> を持つ正規分布に従う確率変数であるとする.</p>
<ol start="3" type="1">
<li><p><span class="math inline">\(P(X \le 40) = 0.025\)</span> を満たす <span class="math inline">\(p\)</span> の値 <span class="math inline">\(q_U\)</span> を小数点以下第4桁まで求めよ.</p></li>
<li><p><span class="math inline">\(P(X \ge 40) = 0.025\)</span> を満たす <span class="math inline">\(p\)</span> の値 <span class="math inline">\(q_L\)</span> を小数点以下第4桁まで求めよ.</p></li>
</ol>
<p><strong>注意:</strong> これらによって計算される区間 <span class="math inline">\([p_L, p_U]\)</span> と <span class="math inline">\([q_L, q_U]\)</span> はデータ「<span class="math inline">\(100\)</span> 回中 <span class="math inline">\(40\)</span> 回当たり」というデータから得られる <span class="math inline">\(p\)</span> の <span class="math inline">\(95\%\)</span> 信頼区間と呼ばれる. 前者は <strong>Clopper-Pearsonの信頼区間</strong> と, 後者は <strong>Waldの信頼区間</strong> と呼ばれる.</p>
<p><strong>解答例:</strong> <span class="math inline">\(n=100\)</span>, <span class="math inline">\(k=40\)</span> とおく.</p>
<p>累積分布函数を <span class="math inline">\(\operatorname{cdf}\)</span> と書き, その逆函数の分位点函数を <span class="math inline">\(\operatorname{quantile}\)</span> と書くことにする: <span class="math inline">\(X\)</span> が分布 <span class="math inline">\(D\)</span> に従う確率変数であるとき,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
\operatorname{cdf}(D, x) = P(X \le x),
\\ &amp;
\operatorname{quantile}(D, a) = (\text{the value $x$ satisfying $P(X \le x) = a$}).
\end{aligned}
\]</span></p>
<p>以上の記号法のもとで,</p>
<p><span class="math display">\[
\begin{aligned}
F_K(p) &amp;= P(K\le k) = \operatorname{cdf}(\operatorname{Binomial}(n,p), k)
\\ &amp;=
1 - \operatorname{cdf}(\operatorname{Beta}(k+1, n-k), p),
\\
G_K(p) &amp;= P(K\ge k) = 1 - \operatorname{cdf}(\operatorname{Binomial}(n,p), k-1)
\\ &amp;= \operatorname{cdf}(\operatorname{Beta}(k, n-k+1), p)
\end{aligned}
\]</span></p>
<p>について,</p>
<p><span class="math display">\[
\begin{aligned}
F_K^{-1}(\alpha/2) &amp;= \operatorname{quantile}(\operatorname{Beta}(k+1, n-k), 1 - \alpha/2),
\\
G_K^{-1}(\alpha/2) &amp;= \operatorname{quantile}(\operatorname{Beta}(k, n-k+1), \alpha/2).
\end{aligned}
\]</span></p>
<p>これらを <span class="math inline">\(n=100\)</span>, <span class="math inline">\(k=40\)</span>, <span class="math inline">\(\alpha=0.05\)</span> に適用すると,</p>
<ol type="1">
<li><p><span class="math inline">\(p_U \approx 0.5028\)</span></p></li>
<li><p><span class="math inline">\(p_L \approx 0.3033\)</span></p></li>
</ol>
<p><span class="math inline">\(X\sim\operatorname{Normal}(np, \sigma)\)</span> のとき,</p>
<p><span class="math display">\[
\begin{aligned}
F_X(p) &amp;= P(X\le k) = \operatorname{cdf}(\operatorname{Normal}(np, \sigma), k)
\\ &amp;=
\operatorname{cdf}(\operatorname{Normal}(0,1), (k-np)/\sigma),
\\
G_X(p) &amp;= P(X\ge k) = 1 - \operatorname{cdf}(\operatorname{Normal}(np, \sigma), k)
\\ &amp;=
1 - \operatorname{cdf}(\operatorname{Normal}(0,1), (k-np)/\sigma)
\end{aligned}
\]</span></p>
<p>について</p>
<p><span class="math display">\[
z_{\alpha/2} = \operatorname{quantile}(\operatorname{Normal}(0,1), 1 - \alpha/2)
\]</span></p>
<p>とおくと, <span class="math inline">\(\operatorname{quantile}(\operatorname{Normal}(0,1), \alpha/2) = -z_{\alpha/2}\)</span> なので,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
F_X^{-1}(\alpha/2) =
\frac{k - \sigma\operatorname{quantile}(\operatorname{Normal}(0,1), \alpha/2)}{n} =
\frac{k + z_{\alpha/2}\sigma}{n}
\\ &amp;
G_X^{-1}(1-\alpha/2) =
\frac{k - \sigma\operatorname{quantile}(\operatorname{Normal}(0,1), 1-\alpha/2)}{n} =
\frac{k - z_{\alpha/2}\sigma}{n}
\end{aligned}
\]</span></p>
<p><span class="math inline">\(n=100\)</span>, <span class="math inline">\(\hat{p}=0.4\)</span> のとき,</p>
<p><span class="math display">\[
\hat{\sigma}^2 = n\hat{p}(1-\hat{p}) = 24.
\]</span></p>
<p>であり, 上の公式を <span class="math inline">\(n=100\)</span>, <span class="math inline">\(k=40\)</span>, <span class="math inline">\(\sigma=\hat\sigma\)</span> の場合に使うと,</p>
<ol start="3" type="1">
<li><p><span class="math inline">\(q_U \approx 0.4960\)</span></p></li>
<li><p><span class="math inline">\(q_L \approx 0.3040\)</span></p></li>
</ol>
<p><strong>解答終</strong></p>
<section id="wolframalphaによる計算" class="level4">
<h4 class="anchored" data-anchor-id="wolframalphaによる計算">WolframAlphaによる計算</h4>
<ol type="1">
<li><a href="https://www.wolframalpha.com/input?i=quantile%28BetaDistribution%2841%2C+60%29%2C+0.975%29">quantile(BetaDistribution(41, 60), 0.975)</a></li>
</ol>
<p>(1)検算 <a href="https://www.wolframalpha.com/input?i=cdf%28BinomialDistribution%28100%2C+0.502791%29%2C+40%29">cdf(BinomialDistribution(100, 0.502791), 40)</a></p>
<ol start="2" type="1">
<li><a href="https://www.wolframalpha.com/input?i=quantile%28BetaDistribution%2840%2C+61%29%2C+0.025%29">quantile(BetaDistribution(40, 61), 0.025)</a></li>
</ol>
<p>(2)検算 <a href="https://www.wolframalpha.com/input?i=1+-+cdf%28BinomialDistribution%28100%2C+0.303295%29%2C+39%29">1 - cdf(BinomialDistribution(100, 0.303295), 39)</a></p>
<p><a href="https://www.wolframalpha.com/input?i=quantile%28NormalDistribution%280%2C+1%29%2C+0.975%29">quantile(NormalDistribution(0, 1), 0.975)</a> → 1.95996</p>
<ol start="3" type="1">
<li><a href="https://www.wolframalpha.com/input?i=%2840+%2B+1.95996+*+sqrt%2824%29%29%2F100">(40 + 1.95996 * sqrt(24))/100</a></li>
</ol>
<p>(3)検算 <a href="https://www.wolframalpha.com/input?i=cdf%28NormalDistribution%2849.60180%2C+sqrt%2824%29%29%2C+40%29">cdf(NormalDistribution(49.60180, sqrt(24)), 40)</a></p>
<ol start="4" type="1">
<li><a href="https://www.wolframalpha.com/input?i=%2840+-+1.95996+*+sqrt%2824%29%29%2F100">(40 - 1.95996 * sqrt(24))/100</a></li>
</ol>
<p>(4)検算 <a href="https://www.wolframalpha.com/input?i=1+-+cdf%28NormalDistribution%2830.39820%2C+sqrt%2824%29%29%2C+40%29">1 - cdf(NormalDistribution(30.39820, sqrt(24)), 40)</a></p>
</section>
<section id="julia言語による計算2" class="level4">
<h4 class="anchored" data-anchor-id="julia言語による計算2">Julia言語による計算2</h4>
<p><strong>記号法:</strong> <code>cdf(d, x)</code> は分布 <code>d</code> の累積分布函数で <code>ccdf(d, x) = 1 - cdf(d, x)</code>.</p>
<p><code>cdf(Binomial(n, p), k) == ccdf(Beta(k+1, n-k), p)</code> の確認:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>n, p <span class="op">=</span> <span class="fl">8</span>, <span class="fl">0.3</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    [<span class="fu">cdf</span>(<span class="fu">Binomial</span>(n, p), k) for k <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span>n<span class="op">-</span><span class="fl">1</span>]<span class="ch">'</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    [<span class="fu">ccdf</span>(<span class="fu">Beta</span>(k<span class="op">+</span><span class="fl">1</span>, n<span class="op">-</span>k), p) for k <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span>n<span class="op">-</span><span class="fl">1</span>]<span class="ch">'</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>2×8 Matrix{Float64}:
 0.057648  0.255298  0.551774  0.805896  0.942032  0.988708  0.99871  0.999934
 0.057648  0.255298  0.551774  0.805896  0.942032  0.988708  0.99871  0.999934</code></pre>
</div>
</div>
<p><code>ccdf(Binomial(n, p), k-1) == cdf(Beta(k, n-k+1), p)</code> の確認:</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>n, p <span class="op">=</span> <span class="fl">8</span>, <span class="fl">0.3</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    [<span class="fu">ccdf</span>(<span class="fu">Binomial</span>(n, p), k<span class="op">-</span><span class="fl">1</span>) for k <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n]<span class="ch">'</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    [<span class="fu">cdf</span>(<span class="fu">Beta</span>(k, n<span class="op">-</span>k<span class="op">+</span><span class="fl">1</span>), p) for k <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n]<span class="ch">'</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>2×8 Matrix{Float64}:
 0.942352  0.744702  0.448226  0.194104  0.0579676  0.0112922  0.00129033  6.561e-5
 0.942352  0.744702  0.448226  0.194104  0.0579676  0.0112922  0.00129033  6.561e-5</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>n, k <span class="op">=</span> <span class="fl">100</span>, <span class="fl">40</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>α <span class="op">=</span> <span class="fl">0.05</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>0.05</code></pre>
</div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1)</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>p_U <span class="op">=</span> <span class="fu">quantile</span>(<span class="fu">Beta</span>(k<span class="op">+</span><span class="fl">1</span>, n<span class="op">-</span>k), <span class="fl">1</span> <span class="op">-</span> α<span class="op">/</span><span class="fl">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>0.5027908495776652</code></pre>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1)検算</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cdf</span>(<span class="fu">Binomial</span>(n, p_U), k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>0.024999999999999988</code></pre>
</div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (2)</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>p_L <span class="op">=</span> <span class="fu">quantile</span>(<span class="fu">Beta</span>(k, n<span class="op">-</span>k<span class="op">+</span><span class="fl">1</span>), α<span class="op">/</span><span class="fl">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>0.3032947687028774</code></pre>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (2)検算</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ccdf</span>(<span class="fu">Binomial</span>(n, p_L), k<span class="op">-</span><span class="fl">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>0.02499999999999998</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>p̂ <span class="op">=</span> k<span class="op">/</span>n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>0.4</code></pre>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>σ̂² <span class="op">=</span> <span class="fu">n*p̂*</span>(<span class="fl">1</span><span class="op">-</span>p̂)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>24.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>σ̂ <span class="op">=</span> √σ̂²</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<pre><code>4.898979485566356</code></pre>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># z_{α/2}</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="fu">quantile</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">1</span>), <span class="fl">1</span> <span class="op">-</span> α<span class="op">/</span><span class="fl">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>1.9599639845400576</code></pre>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (3)</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>q_U <span class="op">=</span> (k <span class="op">+</span> z<span class="op">*</span>σ̂)<span class="op">/</span>n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>0.4960182335271064</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (3)検算</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_U, σ̂), k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>0.024999999999999776</code></pre>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (4)</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>q_L <span class="op">=</span> (k <span class="op">-</span> z<span class="op">*</span>σ̂)<span class="op">/</span>n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>0.3039817664728936</code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (4)検算</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1</span> <span class="op">-</span> <span class="fu">cdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_L, σ̂), k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>0.0249999999999998</code></pre>
</div>
</div>
</section>
<section id="julia言語による視覚化2" class="level4">
<h4 class="anchored" data-anchor-id="julia言語による視覚化2">Julia言語による視覚化2</h4>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>n, k, α <span class="op">=</span> <span class="fl">100</span>, <span class="fl">40</span>, <span class="fl">0.05</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>p̂ <span class="op">=</span> k<span class="op">/</span>n</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>σ̂² <span class="op">=</span> <span class="fu">n*p̂*</span>(<span class="fl">1</span><span class="op">-</span>p̂)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>σ̂ <span class="op">=</span> √σ̂²</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>p_U <span class="op">=</span> <span class="fu">quantile</span>(<span class="fu">Beta</span>(k<span class="op">+</span><span class="fl">1</span>, n<span class="op">-</span>k), <span class="fl">1</span> <span class="op">-</span> α<span class="op">/</span><span class="fl">2</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>p_L <span class="op">=</span> <span class="fu">quantile</span>(<span class="fu">Beta</span>(k, n<span class="op">-</span>k<span class="op">+</span><span class="fl">1</span>), α<span class="op">/</span><span class="fl">2</span>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> <span class="fu">quantile</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">1</span>), <span class="fl">1</span> <span class="op">-</span> α<span class="op">/</span><span class="fl">2</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>q_U <span class="op">=</span> (k <span class="op">+</span> z<span class="op">*</span>σ̂)<span class="op">/</span>n</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>q_L <span class="op">=</span> (k <span class="op">-</span> z<span class="op">*</span>σ̂)<span class="op">/</span>n;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1)</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p_U), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>p_U]; label<span class="op">=</span><span class="st">"n p_U"</span>, c<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p_U), x), <span class="fl">10</span>, <span class="fl">40.5</span>;</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=</span><span class="fl">1</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(<span class="fl">35</span>, <span class="fl">0.01</span>, <span class="fu">text</span>(<span class="st">"2.5%"</span>, <span class="fl">10</span>, <span class="op">:</span>blue))</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([<span class="fl">40</span>]; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>gray)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"Binomial(n = </span><span class="sc">$</span>n<span class="st">, p_U = </span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> p_U)<span class="st">)"</span>)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(; size<span class="op">=</span>(<span class="fl">600</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-51-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (2)</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p_L), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>p_L]; label<span class="op">=</span><span class="st">"n p_L"</span>, c<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p_L), x), <span class="fl">39.5</span>, <span class="fl">70</span>;</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=</span><span class="fl">2</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(<span class="fl">45</span>, <span class="fl">0.01</span>, <span class="fu">text</span>(<span class="st">"2.5%"</span>, <span class="fl">10</span>, <span class="op">:</span>red))</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([<span class="fl">40</span>]; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>gray)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"Binomial(n = </span><span class="sc">$</span>n<span class="st">, p_L = </span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> p_L)<span class="st">)"</span>)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(; size<span class="op">=</span>(<span class="fl">600</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-52-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1) and (2)</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p_U), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>p_U]; label<span class="op">=</span><span class="st">"n p_U"</span>, c<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p_U), x), <span class="fl">10</span>, <span class="fl">40.5</span>;</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=</span><span class="fl">1</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(<span class="fl">35</span>, <span class="fl">0.01</span>, <span class="fu">text</span>(<span class="st">"2.5%"</span>, <span class="fl">10</span>, <span class="op">:</span>blue))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p_L), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>p_L]; label<span class="op">=</span><span class="st">"n p_L"</span>, c<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p_L), x), <span class="fl">39.5</span>, <span class="fl">70</span>;</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=</span><span class="fl">2</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(<span class="fl">45</span>, <span class="fl">0.01</span>, <span class="fu">text</span>(<span class="st">"2.5%"</span>, <span class="fl">10</span>, <span class="op">:</span>red))</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([<span class="fl">40</span>]; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>gray)</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"[p_L, p_U] = [</span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> p_L)<span class="st">, </span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> p_U)<span class="st">]"</span>)</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(; size<span class="op">=</span>(<span class="fl">600</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-53-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (3)</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_U, σ̂), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>blue, ls<span class="op">=:</span>dash)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>q_U]; label<span class="op">=</span><span class="st">"n q_U"</span>, ls<span class="op">=:</span>dashdot, c<span class="op">=:</span>blue)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_U, σ̂), x), <span class="fl">10</span>, <span class="fl">40</span>;</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=:</span>blue, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(<span class="fl">35</span>, <span class="fl">0.01</span>, <span class="fu">text</span>(<span class="st">"2.5%"</span>, <span class="fl">10</span>, <span class="op">:</span>blue))</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([<span class="fl">40</span>]; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>gray)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"Normal(μ = </span><span class="sc">$</span>(n)<span class="st">×</span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> q_L)<span class="st">, σ = √(</span><span class="sc">$</span>n<span class="st">⋅</span><span class="sc">$</span>p<span class="st">̂(1-</span><span class="sc">$</span>p<span class="st">̂))"</span>)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(; size<span class="op">=</span>(<span class="fl">600</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-54-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (4)</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_L, σ̂), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>red, ls<span class="op">=:</span>dash)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>q_L]; label<span class="op">=</span><span class="st">"n q_L"</span>, ls<span class="op">=:</span>dashdot, c<span class="op">=:</span>red)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_L, σ̂), x), <span class="fl">40</span>, <span class="fl">70</span>;</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=:</span>red, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(<span class="fl">45</span>, <span class="fl">0.01</span>, <span class="fu">text</span>(<span class="st">"2.5%"</span>, <span class="fl">10</span>, <span class="op">:</span>red))</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([<span class="fl">40</span>]; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>gray)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"Normal(μ = </span><span class="sc">$</span>(n)<span class="st">×</span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> q_L)<span class="st">, σ = √(</span><span class="sc">$</span>n<span class="st">⋅</span><span class="sc">$</span>p<span class="st">̂(1-</span><span class="sc">$</span>p<span class="st">̂))"</span>)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(; size<span class="op">=</span>(<span class="fl">600</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-55-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (3) and (4)</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_U, σ̂), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>blue, ls<span class="op">=:</span>dash)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>q_U]; label<span class="op">=</span><span class="st">"n q_U"</span>, ls<span class="op">=:</span>dashdot, c<span class="op">=:</span>blue)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_U, σ̂), x), <span class="fl">10</span>, <span class="fl">40</span>;</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=:</span>blue, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(<span class="fl">35</span>, <span class="fl">0.01</span>, <span class="fu">text</span>(<span class="st">"2.5%"</span>, <span class="fl">10</span>, <span class="op">:</span>blue))</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_L, σ̂), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>red, ls<span class="op">=:</span>dash)</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>q_L]; label<span class="op">=</span><span class="st">"n q_L"</span>, ls<span class="op">=:</span>dashdot, c<span class="op">=:</span>red)</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_L, σ̂), x), <span class="fl">40</span>, <span class="fl">70</span>;</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=:</span>red, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate!</span>(<span class="fl">45</span>, <span class="fl">0.01</span>, <span class="fu">text</span>(<span class="st">"2.5%"</span>, <span class="fl">10</span>, <span class="op">:</span>red))</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([<span class="fl">40</span>]; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>gray)</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"[q_L, q_U] = [</span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> q_L)<span class="st">, </span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> q_U)<span class="st">]"</span>)</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(; size<span class="op">=</span>(<span class="fl">600</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-56-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (1)(2)(3)(4)</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p_U), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>p_U]; label<span class="op">=</span><span class="st">"n p_U"</span>, c<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p_L), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>p_L]; label<span class="op">=</span><span class="st">"n p_L"</span>, c<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_U, σ̂), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>blue, ls<span class="op">=:</span>dash)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>q_U]; label<span class="op">=</span><span class="st">"n q_U"</span>, ls<span class="op">=:</span>dashdot, c<span class="op">=:</span>blue)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>q_L, σ̂), x), <span class="fl">10</span>, <span class="fl">70</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>red, ls<span class="op">=:</span>dash)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([n<span class="op">*</span>q_L]; label<span class="op">=</span><span class="st">"n q_L"</span>, ls<span class="op">=:</span>dashdot, c<span class="op">=:</span>red)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="fu">vline!</span>([<span class="fl">40</span>]; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>gray)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"[p_L, p_U] = [</span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> p_L)<span class="st">, </span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> p_U)<span class="st">]"</span><span class="op">*</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">",  [q_L, q_U] = [</span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> q_L)<span class="st">, </span><span class="sc">$</span>(<span class="pp">@sprintf</span> <span class="st">"%.4f"</span> q_U)<span class="st">]"</span>)</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(; size<span class="op">=</span>(<span class="fl">600</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-57-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>次節で使う視覚化のための函数</strong></p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_bin_and_normal_cdfs</span>(;</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>        n<span class="op">=</span><span class="fl">20</span>, p <span class="op">=</span> <span class="fl">0.4</span>, k <span class="op">=</span> <span class="fl">5</span>, k_normal <span class="op">=</span> k, midp <span class="op">=</span> <span class="cn">false</span>, </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>        xlim <span class="op">=</span> (<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">16</span>), annpos <span class="op">=</span> (<span class="fl">2</span>, <span class="fl">0.05</span>), midpannpos <span class="op">=</span> (<span class="fl">2</span>, <span class="fl">0.07</span>),</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>        xtick <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">20</span>, kwargs<span class="op">...</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    P1 <span class="op">=</span> <span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p), x), xlim<span class="op">...</span>; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=</span><span class="fl">1</span>)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> midp</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p), x), <span class="fu">first</span>(xlim), k;</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=</span><span class="fl">1</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>        prob1 <span class="op">=</span> (<span class="fu">cdf</span>(<span class="fu">Binomial</span>(n, p), k<span class="op">-</span><span class="fl">1</span>) <span class="op">+</span> <span class="fu">cdf</span>(<span class="fu">Binomial</span>(n, p), k))<span class="op">/</span><span class="fl">2</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate!</span>(midpannpos<span class="op">...</span>, <span class="fu">text</span>(<span class="st">"mid-P value"</span>, <span class="fl">9</span>, <span class="op">:</span>blue))</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Binomial</span>(n, p), x), <span class="fu">first</span>(xlim), k<span class="op">+</span><span class="fl">0.5</span>;</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=</span><span class="fl">1</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>        prob1 <span class="op">=</span> <span class="fu">cdf</span>(<span class="fu">Binomial</span>(n, p), k)</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate!</span>(annpos<span class="op">...</span>, <span class="fu">text</span>(<span class="pp">@sprintf</span>(<span class="st">"%0.5f"</span>, prob1), <span class="fl">10</span>, <span class="op">:</span>blue))</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vline!</span>([k]; label<span class="op">=</span><span class="st">"x = </span><span class="sc">$</span>k<span class="st">"</span>, c<span class="op">=:</span>gray)</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title!</span>(<span class="st">"Binomial(n = </span><span class="sc">$</span>n<span class="st">, p = </span><span class="sc">$</span>p<span class="st">)"</span>)</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(; xtick)</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>    P2 <span class="op">=</span> <span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>p, <span class="fu">√</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p))), x), xlim<span class="op">...</span>;</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>blue, ls<span class="op">=:</span>dash)</span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>p, <span class="fu">√</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p))), x), <span class="fu">first</span>(xlim), k_normal;</span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">""</span>, fillrange<span class="op">=</span><span class="fl">0</span>, c<span class="op">=:</span>blue, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>    prob2 <span class="op">=</span> <span class="fu">cdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>p, <span class="fu">√</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p))), k_normal)</span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate!</span>(annpos<span class="op">...</span>, <span class="fu">text</span>(<span class="pp">@sprintf</span>(<span class="st">"%0.5f"</span>, prob2), <span class="fl">10</span>, <span class="op">:</span>blue))</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vline!</span>([k_normal]; label<span class="op">=</span><span class="st">"x = </span><span class="sc">$</span>k_normal<span class="st">"</span>, c<span class="op">=:</span>gray)</span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title!</span>(<span class="st">"Normal(μ = </span><span class="sc">$</span>(n<span class="op">*</span>p)<span class="st">, σ = √</span><span class="sc">$</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p))<span class="st">)"</span>)</span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(; xtick)</span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(P1, P2; size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>))</span>
<span id="cb89-33"><a href="#cb89-33" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>plot_bin_and_normal_cdfs (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pval_exact</span>(k, n, p0) <span class="op">=</span> <span class="fu">cdf</span>(<span class="fu">Binomial</span>(n, p0), k)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pval_normal</span>(k, n, p0) <span class="op">=</span> <span class="fu">cdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>p0, <span class="fu">√</span>(<span class="fu">n*p0*</span>(<span class="fl">1</span><span class="op">-</span>p0))), k)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pval_conti</span>(k, n, p0) <span class="op">=</span> <span class="fu">cdf</span>(<span class="fu">Normal</span>(n<span class="op">*</span>p0, <span class="fu">√</span>(<span class="fu">n*p0*</span>(<span class="fl">1</span><span class="op">-</span>p0))), k<span class="op">+</span><span class="fl">0.5</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pval_midp</span>(k, n, p0) <span class="op">=</span> (<span class="fu">cdf</span>(<span class="fu">Binomial</span>(n, p0), k<span class="op">-</span><span class="fl">1</span>) <span class="op">+</span> <span class="fu">cdf</span>(<span class="fu">Binomial</span>(n, p0), k))<span class="op">/</span><span class="fl">2</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">prob_alphaerror</span>(pvalfunc, n, p0, α)</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    null <span class="op">=</span> <span class="fu">Binomial</span>(n, p0)</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">pdf</span>(null, k) <span class="cf">for</span> k <span class="kw">in</span> <span class="fu">support</span>(null)</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="fu">pvalfunc</span>(k, n, p0) <span class="op">⪅</span> α; init <span class="op">=</span> <span class="fl">0.0</span>)</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">_plot_alphaerrors</span>(n, p0, α, tick)</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>    p_exact  <span class="op">=</span> <span class="fu">prob_alphaerror</span>.(pval_exact, n, p0, α)</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    p_normal <span class="op">=</span> <span class="fu">prob_alphaerror</span>.(pval_normal, n, p0, α)</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>    p_conti  <span class="op">=</span> <span class="fu">prob_alphaerror</span>.(pval_conti, n, p0, α)</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    p_midp   <span class="op">=</span> <span class="fu">prob_alphaerror</span>.(pval_midp, n, p0, α)</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(; legend<span class="op">=:</span>topleft)</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(α, p_exact; label<span class="op">=</span><span class="st">"exact"</span>)</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(α, p_normal; label<span class="op">=</span><span class="st">"normal"</span>, ls<span class="op">=:</span>dash)</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(α, p_conti; label<span class="op">=</span><span class="st">"conti. corr."</span>, ls<span class="op">=:</span>dot, lw<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(α, p_midp; label<span class="op">=</span><span class="st">"mid-P"</span>, ls<span class="op">=:</span>dashdot)</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(α, α; label<span class="op">=</span><span class="st">""</span>, c<span class="op">=:</span>black, ls<span class="op">=:</span>dot)</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>    xtick <span class="op">=</span> ytick <span class="op">=</span> tick</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(; xtick, ytick, xrotation<span class="op">=</span><span class="fl">90</span>)</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>    a, b <span class="op">=</span> <span class="fu">extrema</span>(α)</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> ylim <span class="op">=</span> (a<span class="op">-</span><span class="fl">0.02</span>(b<span class="op">-</span>a), b<span class="op">+</span><span class="fl">0.02</span>(b<span class="op">-</span>a))</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(; xlim, ylim)</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title!</span>(<span class="st">"n = </span><span class="sc">$</span>n<span class="st">, p₀ = </span><span class="sc">$</span>p0<span class="st">"</span>)</span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_alphaerrors</span>(n, p0)</span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>    α <span class="op">=</span> </span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>    P1 <span class="op">=</span> <span class="fu">_plot_alphaerrors</span>(n, p0, <span class="fl">0</span><span class="op">:</span><span class="fl">0.001</span><span class="op">:</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">0.1</span><span class="op">:</span><span class="fl">1</span>)</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>    P2 <span class="op">=</span> <span class="fu">_plot_alphaerrors</span>(n, p0, <span class="fl">0</span><span class="op">:</span><span class="fl">0.0001</span><span class="op">:</span><span class="fl">0.1</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">0.01</span><span class="op">:</span><span class="fl">1</span>)</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(P1, P2; size<span class="op">=</span>(<span class="fl">640</span>, <span class="fl">320</span>), layout<span class="op">=</span>(<span class="fl">1</span>, <span class="fl">2</span>))</span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>plot_alphaerrors (generic function with 1 method)</code></pre>
</div>
</div>
</section>
</section>
<section id="連続性補正とmid-p補正" class="level3">
<h3 class="anchored" data-anchor-id="連続性補正とmid-p補正">連続性補正とmid-P補正</h3>
<p>まずは次の図を見て欲しい.</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bin_and_normal_cdfs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-60-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>この図の左側と右側は, それぞれ, <span class="math inline">\(n=20\)</span>, <span class="math inline">\(p=0.4\)</span>, <span class="math inline">\(k=5\)</span> に関する</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
\operatorname{cdf}(\operatorname{Binomial}(n, p), k) \approx 0.12560,
\\ &amp;
\operatorname{cdf}(\operatorname{Normal}(np, \sqrt{np(1-p)}), k) \approx 0.08545,
\end{aligned}
\]</span></p>
<p>の計算を視覚化したものである. ここで <span class="math inline">\(\operatorname{cdf}\)</span> は累積分布函数 (cumulative distribution function) を意味する.</p>
<p>後者は前者の正規分布近似による計算であるが, 前者の値 <span class="math inline">\(\approx 0.12560\)</span> より小さな値 <span class="math inline">\(\approx 0.08545\)</span> になってしまっている. この近似をより正確にするためにはどうすればよいだろうか?</p>
<p>図を見ればわかるように, 正規分布側で <span class="math inline">\(5\)</span> 以下になる確率ではなく, <span class="math inline">\(5.5\)</span> 以下になる確率を計算すれば良さそうである. 実際に計算してみると次のようになる.</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bin_and_normal_cdfs</span>(; k_normal <span class="op">=</span> <span class="fl">5.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-61-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>正規分布近似の側で <span class="math inline">\(5.5\)</span> 以下になる確率を計算するようにしたら, 二項分布の側で <span class="math inline">\(5\)</span> 以下である確率の値 <span class="math inline">\(\approx 0.12560\)</span> にかなり近い値 <span class="math inline">\(\approx 0.12692\)</span> が得られた.</p>
<p>正規分布による近似の側(より一般的には離散分布の連続分布による近似側)をこのように補正することを <strong>連続性補正</strong> (continuity correction)と呼ぶ.</p>
<p>逆に二項分布の側での値を <span class="math inline">\(5\)</span> 以下になる確率と <span class="math inline">\(4\)</span> 以下になる確率の平均値で求めるようにすると, 正規分布近似側の値に近付く. 離散分布の側でこのように補正することを <strong>mid-P 補正</strong> (mid-P correction)と呼ぶ. 次の図を見よ.</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_bin_and_normal_cdfs</span>(; midp <span class="op">=</span> <span class="cn">true</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-62-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>mid-P補正は近似である連続分布の側に近似されている離散分布側の値を近付ける補正になっている. 近似される側を近似する側に近付ける補正を使うことは無意味だと感じる人もいるかもしれないが必ずしもそうではないことを説明しよう.</p>
<p>二項分布 <span class="math inline">\(\operatorname{Binomial}(n, p_0)\)</span> において, <span class="math inline">\(k\)</span> 以下になる確率を次のように書き, データ <span class="math inline">\(k\)</span> に関する仮説 <span class="math inline">\(p\ge p_0\)</span> の片側検定の正確な <strong>P値</strong> (P-value) と呼ぶことにする:</p>
<p><span class="math display">\[
\operatorname{pval}_{\operatorname{exact}}(k|n,p_0) = \operatorname{cdf}(\operatorname{Binomial}(n, p_0), k).
\]</span></p>
<p>これの正規分布近似版とその連続補正版とmid-P補正版をそれぞれ次のように書くことにする:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
\operatorname{pval}_{\operatorname{normal}}(k|n,p_0) =
\operatorname{cdf}(\operatorname{Normal}(n p_0, \sqrt{n p_0(1 - p_0)}), k),
\\ &amp;
\operatorname{pval}_{\operatorname{conti}}(k|n,p_0) =
\operatorname{cdf}(\operatorname{Normal}(n p_0, \sqrt{n p_0(1 - p_0)}), k+0.5),
\\ &amp;
\operatorname{pval}_{\operatorname{mid-P}}(k|n,p_0) =
\frac{1}{2}(\operatorname{cdf}(\operatorname{Binomial}(n, p_0), k-1) + \operatorname{cdf}(\operatorname{Binomial}(n, p_0), k)).
\end{aligned}
\]</span></p>
<p>確率変数 <span class="math inline">\(K\)</span> が <span class="math inline">\(\operatorname{Binomial}(n, p_0)\)</span> に従うとき, データを <span class="math inline">\(K\)</span> としたときのこれらのP値の値が <span class="math inline">\(0&lt;\alpha&lt;1\)</span> について <span class="math inline">\(\alpha\)</span> 以下になる確率がどうなるかを計算してみよう. その確率は <strong>第一種の過誤の確率</strong> もしくは <strong>アルファエラー</strong> と呼ばれ, <span class="math inline">\(\alpha\)</span> に近いことが期待される値とみなされる(その理由は後で検定論を学べばわかる).</p>
<p>正確なP値については, 第一種の過誤の確率は確実に <span class="math inline">\(\alpha\)</span> 以下になるが, 大部分の場合に <span class="math inline">\(\alpha\)</span> より真に小さな値になり, 場合によってはかなり小さな値になる(この性質を <strong>保守的</strong> (conservative)と形容することがある). それの良い近似である連続補正された正規分布近似版も保守的である. それらに対して, 正規分布近似によるP値とmid-P補正によるP値の第一種の過誤の確率は <span class="math inline">\(\alpha\)</span> 前後の値になり, 平均的には正確なP値よりも <span class="math inline">\(\alpha\)</span> の値に近くなる.</p>
<p>第一種の過誤の確率を確実に <span class="math inline">\(\alpha\)</span> 以下にしたければ正確なP値が優れているが, 第一種の過誤の確率が <span class="math inline">\(\alpha\)</span> に近い方が良いことにすると正規分布近似によるP値とmid-P補正によるP値の方が優れていることになる.</p>
<p>このようにP値のユーザーが何を欲しているかによってどのP値の採用が適切であるかは変わる.</p>
<p>以下のグラフは横軸を <span class="math inline">\(\alpha\)</span> としたときのP値達の第一種の過誤の確率を同時プロットしたものである.</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_alphaerrors</span>(<span class="fl">10</span>, <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-63-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_alphaerrors</span>(<span class="fl">20</span>, <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-64-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_alphaerrors</span>(<span class="fl">40</span>, <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-65-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="問題-二項分布の中心極限定理を使った極限の計算問題" class="level3">
<h3 class="anchored" data-anchor-id="問題-二項分布の中心極限定理を使った極限の計算問題">問題: 二項分布の中心極限定理を使った極限の計算問題</h3>
<p><span class="math inline">\(0 &lt; p &lt; 1\)</span> と <span class="math inline">\(m=0,1,2,\ldots\)</span> について以下の極限を求めよ:</p>
<p><span class="math display">\[
\lim_{n\to\infty}
\sum_{k=0}^n
\left(\frac{k - np}{\sqrt{np(1-p)}}\right)^{2m}
\binom{n}{k}p^k(1-p)^{n-k}.
\]</span></p>
<p><strong>解答例:</strong> 二項分布の中心極限定理より,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
\lim_{n\to\infty}
\sum_{k=0}^n
\left(\frac{k - np}{\sqrt{np(1-p)}}\right)^{2m}
\binom{n}{k}p^k(1-p)^{n-k}
\\ &amp;=
\int_{-\infty}^\infty
\left(\frac{x}{\sqrt{p(1-p)}}\right)^{2m}
\frac{1}{\sqrt{2\pi p(1-p)}}
\exp\left(-\frac{x^2}{2p(1-p)}\right)\,dx
\\ &amp;=
\int_{-\infty}^\infty
z^{2m}\frac{1}{\sqrt{2\pi}}e^{-z^2/2}\,dz =
\frac{2}{\sqrt{2\pi}}\int_0^\infty e^{-z^2/2} z^{2m}\,dz
\\ &amp;=
\frac{1}{\sqrt{2\pi}}\int_0^\infty e^{-y/2} y^{m+1/2-1}\,dy =
\frac{1}{\sqrt{2\pi}} 2^{m+1/2} \Gamma(m+1/2)
\\ &amp;=
\frac{1}{\sqrt{2\pi}} 2^{m+1/2}
\frac{2m-1}{2}\cdots\frac{3}{2}\frac{1}{2}\Gamma(1/2) =
1\cdot 3\cdots (2m-1).
\end{aligned}
\]</span></p>
<p>最初の等号で二項分布の中心極限定理を使い, 2番目の等号で <span class="math inline">\(x = \sqrt{p(1-p)}\;z\)</span> とおき, 4番目の等号で <span class="math inline">\(z = \sqrt{y}\)</span> とおいた. 5番目の等号では <span class="math inline">\(\int_0^\infty e^{-y/\theta}y^{\alpha-1}\,dy = \theta^\alpha\Gamma(\alpha)\)</span> を使った.</p>
<p><strong>解答終</strong></p>
<p>上の問題の結果を数値的に確認してみよう.</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">g</span>(n, p, m, k) <span class="op">=</span> ((k <span class="op">-</span> n<span class="op">*</span>p)<span class="op">/</span><span class="fu">√</span>(<span class="fu">n*p*</span>(<span class="fl">1</span><span class="op">-</span>p)))<span class="op">^</span>(<span class="fl">2</span>m)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="fl">0.4</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="pp">@show</span> p</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> m <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="fl">5</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>()</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> m</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> n <span class="op">=</span> <span class="fl">10</span><span class="op">^</span>(m<span class="op">+</span><span class="fl">1</span>)</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> <span class="fu">prod</span>(<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">2</span>m<span class="op">-</span><span class="fl">1</span>)</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> <span class="fu">sum</span>(<span class="fu">g</span>(n, p, m, k)<span class="fu">*pdf</span>(<span class="fu">Binomial</span>(n, p), k) <span class="cf">for</span> k <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span>n)</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p = 0.4

m = 0
n = 10 ^ (m + 1) = 10
prod(1:2:2m - 1) = 1
sum((g(n, p, m, k) * pdf(Binomial(n, p), k) for k = 0:n)) = 1.000000000000001

m = 1
n = 10 ^ (m + 1) = 100
prod(1:2:2m - 1) = 1
sum((g(n, p, m, k) * pdf(Binomial(n, p), k) for k = 0:n)) = 1.0000000000000095

m = 2
n = 10 ^ (m + 1) = 1000
prod(1:2:2m - 1) = 3
sum((g(n, p, m, k) * pdf(Binomial(n, p), k) for k = 0:n)) = 2.998166666666703

m = 3
n = 10 ^ (m + 1) = 10000
prod(1:2:2m - 1) = 15
sum((g(n, p, m, k) * pdf(Binomial(n, p), k) for k = 0:n)) = 14.997416790272869

m = 4
n = 10 ^ (m + 1) = 100000
prod(1:2:2m - 1) = 105
sum((g(n, p, m, k) * pdf(Binomial(n, p), k) for k = 0:n)) = 104.99661670588064

m = 5
n = 10 ^ (m + 1) = 1000000
prod(1:2:2m - 1) = 945
sum((g(n, p, m, k) * pdf(Binomial(n, p), k) for k = 0:n)) = 944.9952750033706</code></pre>
</div>
</div>
</section>
<section id="二項分布の中心極限定理の証明の方針" class="level3">
<h3 class="anchored" data-anchor-id="二項分布の中心極限定理の証明の方針">二項分布の中心極限定理の証明の方針</h3>
<p>二項分布の中心極限定理を以下の2段階で示す.</p>
<p>記号法に関する準備: <span class="math inline">\(0 &lt; p &lt; 1\)</span> は固定するが, <span class="math inline">\(n, k\)</span> は動かす. <span class="math inline">\(k\)</span> は <span class="math inline">\(n\)</span> ごとに決まっていると仮定する. 混乱を完全に防ぐには <span class="math inline">\(k\)</span> を <span class="math inline">\(k_n\)</span> のように書いた方がよいが, 記号が煩雑になって書くのが面倒になるので, 単に <span class="math inline">\(k\)</span> と書くことにする. <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(0\)</span> に収束する量を <span class="math inline">\(o(1)\)</span> と書く. より一般に <span class="math inline">\(a_n\)</span> で割った結果が <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(0\)</span> に収束する量を <span class="math inline">\(o(a_n)\)</span> と書く. 例えば <span class="math inline">\(o\left(1/\sqrt{n}\right)\)</span> は <span class="math inline">\(\sqrt{n}\)</span> をかけた後であっても <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(0\)</span> に収束する量になる. この記号法のもとで, Stirlingの公式は次のように書ける:</p>
<p><span class="math display">\[
n! = n^n e^{-n} \sqrt{2\pi n}\,(1 + o(1)).
\]</span></p>
<ol type="1">
<li><span class="math inline">\(n\)</span> ごとに決まっている <span class="math inline">\(k\)</span> は <span class="math inline">\(n\to\infty\)</span> で</li>
</ol>
<p><span class="math display">\[
\frac{k}{n} = p + o(1)
\]</span></p>
<p>という条件を満たしていると仮定する. このとき, 二項分布の確率質量函数</p>
<p><span class="math display">\[
P(k|n,p) = \frac{n!}{k!(n-k)!} p^k(1-p)^{n-k} \quad (k=0,1,\ldots,n)
\]</span></p>
<p>における二項係数の中の <span class="math inline">\(n!\)</span>, <span class="math inline">\(k!\)</span>, <span class="math inline">\((n-k)!\)</span> に階乗に関するStirlingの公式による近似を適用すると次の近似式が得られる:</p>
<p><span class="math display">\[
P(k|n,p) = \frac{1}{\sqrt{2\pi np(1-p)}}
\left(\left(\frac{k/n}{p}\right)\left(\frac{1-k/n}{1-p}\right)\right)^{-n}(1 + o(1)).
\]</span></p>
<p>途中の段階としてこの形に整理しておくと計算の見通しが良くなる. (しかもこの形には重要な意味がある. その点については後述する.)</p>
<ol start="2" type="1">
<li>固定された実数 <span class="math inline">\(x\)</span> について, 上の(1)での近似式を示すために使った仮定 <span class="math inline">\(k/n = p + o(1)\)</span> よりも強い条件</li>
</ol>
<p><span class="math display">\[
\frac{k}{n} = p + \frac{x}{\sqrt{n}} + o(n^{-1/2})
\]</span></p>
<p>を仮定すると, 次が得られる:</p>
<p><span class="math display">\[
P(k|n,p) =
\underbrace{
\frac{1}{\sqrt{2\pi p(1-p)}} \exp\left(-\frac{x^2}{2p(1-p)}\right)
}_{\text{pdf of normal distribution}}
\underbrace{\frac{1}{\sqrt{n}}}_{dx/dk}
(1 + o(1)).
\]</span></p>
<p>これより,</p>
<p><span class="math display">\[
K_n \sim \operatorname{Binomial}(n, p), \quad
X_n = \frac{K_n - np}{\sqrt{n}}, \quad
X_\infty \sim \operatorname{Normal}(0, p(1-p))
\]</span></p>
<p>ならば</p>
<p><span class="math display">\[
\lim_{n\to\infty} E[f(X_n)] \to E[f(X_\infty)]
\]</span></p>
<p>となることがわかる.</p>
<p>この結果は, <span class="math inline">\(n\)</span> が大きなとき, <span class="math inline">\(K_n \sim \operatorname{Binomial}(n, p)\)</span> に対する <span class="math inline">\(X_n = (K_n - np)/\sqrt{n}\)</span> が従う分布が <span class="math inline">\(\operatorname{Normal}(0, p(1-p))\)</span> で近似されることを意味している(<span class="math inline">\(p(1-p)\)</span> は分布 <span class="math inline">\(\operatorname{Bernoulli}(p)\)</span> の分散に等しい). この結果を二項分布の中心極限定理と呼ぶ.</p>
</section>
<section id="stirlingの公式を使った二項分布の確率質量函数の近似" class="level3">
<h3 class="anchored" data-anchor-id="stirlingの公式を使った二項分布の確率質量函数の近似">(1) Stirlingの公式を使った二項分布の確率質量函数の近似</h3>
<p><span class="math inline">\(n\)</span> ごとに決まっている <span class="math inline">\(k\)</span> は <span class="math inline">\(n\to\infty\)</span> で</p>
<p><span class="math display">\[
\frac{k}{n} = p + o(1) \quad \left(\!\!\iff 1 - \frac{k}{n} = 1 - p + o(1)\right)
\]</span></p>
<p>という条件を満たしていると仮定する. <span class="math inline">\(0&lt;p&lt;1\)</span> と仮定していたので, <span class="math inline">\(n\to\infty\)</span> のとき <span class="math inline">\(k\to\infty\)</span> だけではなく, <span class="math inline">\(n-k\to\infty\)</span> も成立している. ゆえに <span class="math inline">\(n,k,n-k\)</span> について次のStirlingの公式が成立している:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
n! = n^n e^{-n} \sqrt{2\pi n}\,(1 + o(1)),
\\ &amp;
k! = k^k e^{-k} \sqrt{2\pi k}\,(1 + o(1)),
\\ &amp;
(n-k)! = (n-k)^{n-k} e^{-(n-k)} \sqrt{2\pi (n-k)}\,(1 + o(1)).
\end{aligned}
\]</span></p>
<p>これを代入すると</p>
<p><span class="math display">\[
\begin{aligned}
\frac{n!}{k!(n-k)!} &amp;=
\frac{n^n e^{-n} \sqrt{2\pi n}}{k^k e^{-k} \sqrt{2\pi k}\;(n-k)^{n-k} e^{-(n-k)} \sqrt{2\pi (n-k)}}
(1 + o(1))
\\ &amp;=
\frac{1}{(k/n)^k(1-k/n)^{n-k}\sqrt{2\pi n(k/n)(1-k/n)}}(1 + o(1))
\\ &amp;=
\frac{1}{(k/n)^k(1-k/n)^{n-k}\sqrt{2\pi np(1-p)}}(1 + o(1))
\end{aligned}
\]</span></p>
<p>2つめの等号で分子の <span class="math inline">\(e^{-n}\)</span> と分母の <span class="math inline">\(e^{-k}e^{-(n-k)}\)</span> がキャンセルさせ, 分子分母を <span class="math inline">\(n^k\)</span> と <span class="math inline">\(n^{n-k}\)</span> と <span class="math inline">\(\sqrt{2\pi n}\)</span> で割った. 3つめの等号で <span class="math inline">\(k/n = p + o(1)\)</span>, <span class="math inline">\(1-k/n = 1-p + o(1)\)</span> を使った. これを二項分布の確率質量函数</p>
<p><span class="math display">\[
P(k|n,p) = \frac{n!}{k!(n-k)!} p^k(1-p)^{n-k} \quad (k=0,1,\ldots,n)
\]</span></p>
<p>に適用すると,</p>
<p><span class="math display">\[
\begin{aligned}
P(k|n,p) &amp;=
\frac{1}{\sqrt{2\pi np(1-p)}}
\left(\frac{p}{k/n}\right)^k\left(\frac{1-p}{1-k/n}\right)^{n-k}
(1 + o(1))
\\ &amp;=
\frac{1}{\sqrt{2\pi np(1-p)}}
\left(\left(\frac{k/n}{p}\right)^{k/n}\left(\frac{1-k/n}{1-p}\right)^{1-k/n}\right)^{-n}
(1 + o(1)).
\end{aligned}
\]</span></p>
</section>
<section id="注意-kullback-leibler情報量とsanovの定理との関係" class="level3">
<h3 class="anchored" data-anchor-id="注意-kullback-leibler情報量とsanovの定理との関係">注意: Kullback-Leibler情報量とSanovの定理との関係</h3>
<p>前節でわざわざ最後の形に変形した理由は, 対数を取ると</p>
<p><span class="math display">\[
\log\left(
\left(\left(\frac{k/n}{p}\right)^{k/n}\left(\frac{1-k/n}{1-p}\right)^{1-k/n}\right)^{-n}
\right) = -n\left(\frac{k}{n}\log\frac{k/n}{p} + \left(1-\frac{k}{n}\log\frac{1-k/n}{1-p}\right)\right)
\]</span></p>
<p>となることを分かり易くするためである. これを <span class="math inline">\(-n\)</span> で割った結果は</p>
<p><span class="math display">\[
D(Q||P) = \sum_{i=1}^r Q(i) \log\frac{Q(i)}{P(i)}\quad
\left(P(i), Q(i) &gt; 0,\; \sum_{i=1}^r P(i) = \sum_{i=1}^r Q(i) = 1\right)
\]</span></p>
<p>の特別な場合になっている(<span class="math inline">\(r=2\)</span>, <span class="math inline">\(P(1)=p\)</span>, <span class="math inline">\(P(2)=1-p\)</span>, <span class="math inline">\(Q(1)=k/n\)</span>, <span class="math inline">\(Q(2)=1-k/n\)</span>). この <span class="math inline">\(D(Q||P)\)</span> は <strong>Kullback-Leibler情報量</strong> (KL情報量)と呼ばれ, そして, 上の計算結果は <span class="math inline">\(r=2\)</span> の場合のKL情報量のSanovの証明にもなっている. Sanovの定理の易しい解説が以下の場所にある:</p>
<ul>
<li><a href="https://genkuroki.github.io/documents/20160616KullbackLeibler.pdf">Kullback-Leibler情報量とSanovの定理</a></li>
</ul>
<p>Sanovの定理の内容を要約すると, Kullback-Leibler情報量 <span class="math inline">\(D(Q||P)\)</span> は確率分布 <span class="math inline">\(P\)</span> に従う乱数の繰り返し生成において確率分布 <span class="math inline">\(Q\)</span> がどれだけ出て来難いかを表しているという主張になる. 上の二項分布の場合には, <span class="math inline">\(Q\)</span> に対応する <span class="math inline">\(k/n\)</span> が生じる確率が <span class="math inline">\(\exp(-nD(Q||P)+O(\log n))\)</span> の形をしていることが示されていることになるので(分母の <span class="math inline">\(\sqrt{2\pi np(1-p)}\)</span> は <span class="math inline">\(\exp(O(\log n))\)</span> になる), KL情報量 <span class="math inline">\(D(Q||P)\)</span> が大きいほど <span class="math inline">\(k/n\)</span> が生じる確率は急激に小さくなる.</p>
<p>Sanovの定理は統計学でのモデル選択における情報量規準の考え方の基礎になっている. KL情報量は確率論では <strong>大偏差原理</strong> に出て来る. KL情報量は物理的には統計力学的な相対エントロピーの <span class="math inline">\(-1\)</span> 倍になる. このような分野を超えた広がりについては, <strong>赤池情報量規準</strong> (<strong>AIC</strong>)で有名な赤池弘次氏による1980年の2つの論説も参照せよ:</p>
<ul>
<li>赤池弘次, エントロピーとモデルの尤度(&lt;講座&gt;物理学周辺の確率統計), 日本物理学会誌, 1980年第35巻7号, pp.&nbsp;608-614. <a href="https://www.jstage.jst.go.jp/article/butsuri1946/35/7/35_7_608/_article/-char/ja/">link</a></li>
<li>赤池弘次, 統計的推論のパラダイムの変遷について, 統計数理研究所彙報, 1980年第27巻第1号, pp.&nbsp;5-12. <a href="https://ismrepo.ism.ac.jp/index.php?active_action=repository_view_main_item_detail&amp;page_id=13&amp;block_id=21&amp;item_id=32568&amp;item_no=1">link</a></li>
</ul>
<p>赤池弘次さんは前者のp.612に「筆者によって導入されたこの統計量はAIC(an information criterionの略記*)と呼ばれ」と書いているが, それに対して会誌編集委員会が「一般には Akaike’s information criterionの略と解されている」と脚注を付けている. このことを確認するだけでもダウンロードする価値があるだろう.</p>
<p>上で紹介した計算は二項分布の確率質量函数にStirlingの公式を適用する単純な計算に過ぎないのだが, その先には分野を超えた非常に面白い世界が広がっている.</p>
</section>
<section id="二項分布の確率質量函数から正規分布の密度函数が出て来ること" class="level3">
<h3 class="anchored" data-anchor-id="二項分布の確率質量函数から正規分布の密度函数が出て来ること">(2) 二項分布の確率質量函数から正規分布の密度函数が出て来ること</h3>
<p><span class="math inline">\(n\)</span> ごとに決まっている <span class="math inline">\(k\)</span> は <span class="math inline">\(n\to\infty\)</span> で</p>
<p><span class="math display">\[
\frac{k}{n} = p + o(1)
\]</span></p>
<p>という条件を満たしているならば</p>
<p><span class="math display">\[
P(k|n,p) =
\frac{1}{\sqrt{2\pi np(1-p)}}
\left(\left(\frac{k/n}{p}\right)^{k/n}\left(\frac{1-k/n}{1-p}\right)^{1-k/n}\right)^{-n}
(1 + o(1))
\]</span></p>
<p>となることを上で示した. 以下では <span class="math inline">\(k/n = p + o(1)\)</span> よりも強い条件</p>
<p><span class="math display">\[
\frac{k - np}{\sqrt{n}} = x + \varepsilon_n, \quad
\lim_{n\to\infty}\varepsilon_n = 0
\]</span></p>
<p>を仮定する. このとき,</p>
<p><span class="math display">\[
\frac{k}{n} = p + \frac{x+\varepsilon_n}{\sqrt{n}}, \quad
1-\frac{k}{n} = 1 - p - \frac{x+\varepsilon_n}{\sqrt{n}}.
\]</span></p>
<p>以上の仮定のもとで, <span class="math inline">\(\log(1+t)=t-t^2/2+t^3/3-\cdots\)</span> を使うと,</p>
<p><span class="math display">\[
\begin{aligned}
\log\left(\frac{k/n}{p}\right)^{k/n} &amp;=
\frac{k}{n}\log\frac{k/n}{p} =
\left(p + \frac{x+\varepsilon_n}{\sqrt{n}}\right)
\log\left(1 + \frac{x+\varepsilon_n}{\sqrt{n}\;p}\right)
\\ &amp;=
\left(p + \frac{x+\varepsilon_n}{\sqrt{n}}\right)
\left(\frac{x+\varepsilon_n}{\sqrt{n}\;p} - \frac{x^2}{2np^2} + o(1/n)\right)
\\ &amp;=
\frac{x+\varepsilon_n}{\sqrt{n}} - \frac{x^2}{2np} + \frac{x^2}{np^2} + o(1/n)
\\ &amp;=
\frac{x+\varepsilon_n}{\sqrt{n}} + \frac{x^2}{2np} + o(1/n),
\\
\log\left(1-\frac{k/n}{1-p}\right)^{1-k/n} &amp;=
\left(1-\frac{k}{n}\right)\log\frac{k/n-1}{p} =
\left(1 - p - \frac{x+\varepsilon_n}{\sqrt{n}}\right)
\log\left(1 - \frac{x+\varepsilon_n}{\sqrt{n}\,(1-p)}\right)
\\ &amp;=
\left(1 - p - \frac{x+\varepsilon_n}{\sqrt{n}}\right)
\left(-\frac{x+\varepsilon_n}{\sqrt{n}\,(1-p)} - \frac{x^2}{2n(1-p)^2} + o(1/n)\right)
\\ &amp;= -
\frac{x+\varepsilon_n}{\sqrt{n}} - \frac{x^2}{2n(1-p)} + \frac{x^2}{n(1-p)^2} + o(1/n)
\\ &amp;= -
\frac{x+\varepsilon_n}{\sqrt{n}} + \frac{x^2}{2n(1-p)} + o(1/n).
\end{aligned}
\]</span></p>
<p>ゆえに,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
\log\left(\left(\frac{k/n}{p}\right)^{k/n}\left(\frac{1-k/n}{1-p}\right)^{1-k/n}\right)^{-n}
\\ &amp;=
-n\left(
\log\left(\frac{k/n}{p}\right)^{k/n} +
\log\left(1-\frac{k/n}{1-p}\right)^{1-k/n}
\right)
\\ &amp;= -
\frac{x^2}{2p} - \frac{x^2}{2(1-p)} + o(1) = -
\frac{x^2}{2p(1-p)} + o(1).
\end{aligned}
\]</span></p>
<p>したがって,</p>
<p><span class="math display">\[
P(k|n,p) =
\frac{1}{\sqrt{2\pi p(1-p)}}
\exp\left(-\frac{x^2}{2p(1-p)}\right)
\frac{1}{\sqrt{n}}
\;(1 + o(1)).
\]</span></p>
<p>この公式の <span class="math inline">\(1/\sqrt{n}\)</span> より前の部分は平均 <span class="math inline">\(0\)</span>, 分散 <span class="math inline">\(p(1-p)\)</span> の正規分布の確率密度函数であり, <span class="math inline">\(1/\sqrt{n}\)</span> の因子は <span class="math inline">\(k = np + \sqrt{n}\,(x + \varepsilon_n)\)</span> から形式的に得られる <span class="math inline">\(dk = \sqrt{n}\;dx\)</span> の <span class="math inline">\(\sqrt{n}\)</span> の因子とキャンセルすると考えると自然に見える.</p>
<p>これより, <span class="math inline">\(K_n \sim \operatorname{Binomial}(n, p)\)</span>, X_(0, p(1-p)) のとき,</p>
<p><span class="math display">\[
X_n = \frac{K_n - np}{\sqrt{n}}, \quad
x_n(k) = \frac{k - np}{\sqrt{n}}, \quad
\varDelta x_n = \frac{1}{\sqrt{n}}
\]</span></p>
<p>とおくと, 有界な連続函数 <span class="math inline">\(f(x)\)</span> について, <span class="math inline">\(n\to\infty\)</span> のとき</p>
<p><span class="math display">\[
\begin{aligned}
E[f(X_n)] &amp;=
\sum_{k=0}^n f(x_n(k)) P(k|n,p)
\\ &amp;=
\sum_{k=0}^n f(x_n(k))
\frac{1}{\sqrt{2\pi p(1-p)}}
\exp\left(-\frac{x_n(k)^2}{2p(1-p)}\right)
\varDelta x_n \;(1 + o(1))
\\ &amp;=
\int_{-\infty}^\infty f(x)
\frac{1}{\sqrt{2\pi p(1-p)}}
\exp\left(-\frac{x^2}{2p(1-p)}\right)\,dx =
E[f(X_\infty)].
\end{aligned}
\]</span></p>
<p>以上の議論は厳密には少しギャップがあるのだが, 二項分布に関して中心極限定理が成立する理由の本質は十分に分かる内容になっている.</p>
</section>
</section>
<section id="中心極限定理" class="level2">
<h2 class="anchored" data-anchor-id="中心極限定理">中心極限定理</h2>
<p><strong>中心極限定理</strong> (central limit theorem)は「中心に収束する極限定理」というような意味ではなく、<strong>「確率論における中心的な極限定理」</strong> という意味である.</p>
<p><strong>注意:</strong> 特性函数, モーメント母函数, キュムラント母函数, 歪度(わいど), 尖度(せんど)などについては「標本分布について」のノートに詳しい解説がある.</p>
<section id="中心極限定理のラフな説明" class="level3">
<h3 class="anchored" data-anchor-id="中心極限定理のラフな説明">中心極限定理のラフな説明</h3>
<p><span class="math inline">\(X_1,\ldots,X_n\)</span> は各々が期待値 <span class="math inline">\(\mu\)</span>, 分散 <span class="math inline">\(\sigma^2\)</span> を持つ分布に従う <span class="math inline">\(n\)</span> 個の独立同分布確率変数達であるとし, <span class="math inline">\(n\)</span> は十分に大きいと仮定する.</p>
<p>中心極限定理は以下のように同値な言い方が色々ある:</p>
<ol type="1">
<li>それらの和 <span class="math inline">\(X_1+\cdots+X_n\)</span> が従う分布は期待値 <span class="math inline">\(n\mu\)</span>, 分散 <span class="math inline">\(n\sigma^2\)</span> の正規分布で近似される:</li>
</ol>
<p><span class="math display">\[
\sum_{i=1}^n X_i
\sim \operatorname{Normal}\left(n\mu, \sqrt{n}\,\sigma\right)\quad\text{approximately}.
\]</span></p>
<ol start="2" type="1">
<li>それらの加法平均 <span class="math inline">\(\bar{X}_n = (X_1+\cdots+X_n)/n\)</span> が従う分布は期待値 <span class="math inline">\(\mu\)</span>, 分散 <span class="math inline">\(\sigma^2/n\)</span> の正規分布で近似される:</li>
</ol>
<p><span class="math display">\[
\bar{X}_n = \frac{1}{n}\sum_{i=1}^n X_i
\sim \operatorname{Normal}\left(\mu, \sigma/\sqrt{n}\right)\quad\text{approximately}.
\]</span></p>
<ol start="3" type="1">
<li><span class="math inline">\(\sqrt{n}\,(\bar{X}_n - \mu)\)</span> が従う分布は期待値 <span class="math inline">\(0\)</span>, 分散 <span class="math inline">\(\sigma^2\)</span> の正規分布で近似される:</li>
</ol>
<p><span class="math display">\[
\sqrt{n}\,(\bar{X}_n - \mu) =
\frac{1}{\sqrt{n}}\sum_{i=1}^n (X_i - \mu)
\sim \operatorname{Normal}(0, \sigma)\quad\text{approximately}.
\]</span></p>
<ol start="4" type="1">
<li>次の <span class="math inline">\(Z_n\)</span> が従う分布は標準正規分布で近似される:</li>
</ol>
<p><span class="math display">\[
Z_n = \frac{\sqrt{n}\,(\bar{X}_n - \mu)}{\sigma} =
\frac{1}{\sqrt{n}}\sum_{i=1}^n \frac{X_i - \mu}{\sigma}
\sim \operatorname{Normal}(0, 1)\quad\text{approximately}.
\]</span></p>
<p>これらはどれも便利であり, 今後, 自由に使われることになるだろう.</p>
<p><strong>注意・警告:</strong> 統計学に中心極限定理を応用する場合には, <span class="math inline">\(n\to\infty\)</span> とできる数学的に理想的な状況における中心極限定理ではなく, 有限の固定された <span class="math inline">\(n\)</span> における近似として中心極限定理は使われる. だから, 場合ごとにその近似の誤差が問題になる. この問題は目的ごとに異なる許容される誤差との兼ね合いの問題になるので, きれいな一般論で解決できる話ではなく, 中心極限定理のユーザー自身が自分自身の目的に合わせて誤差が大きくなるリスクをどこまで許容するかを決定する必要がある. そのためには, 中心極限定理による近似の精度がどのような場合に悪くなりそうかについて前もって理解しておく必要がある.</p>
<p><strong>補足:</strong> 分布 <span class="math inline">\(D_n\)</span> が分布 <span class="math inline">\(D_\infty\)</span> で近似されるとは, 分布 <span class="math inline">\(D_n\)</span> に従う確率変数 <span class="math inline">\(X_n\)</span> と分布 <span class="math inline">\(D_\infty\)</span> に従う確率変数 <span class="math inline">\(X_\infty\)</span> と適切なクラスに含まれる任意の函数 <span class="math inline">\(f(x)\)</span> について</p>
<p><span class="math display">\[
\lim_{n\to\infty} E[f(X_n)] = E[f(X_\infty)]
\]</span></p>
<p>が成立することだと, 大雑把に定義しておく. (函数 <span class="math inline">\(f(x)\)</span> としてどのような函数を許すかについて詳細な説明をするためにはさらなる数学的道具立てが必要でかる, 雑に扱っても害はほとんどない場合にもなっているので, このノートで説明しない. 所謂「分布収束」「法収束」の話になる.) 統計学で必要な確率論の計算は期待値を取る操作経由で可能なのでこのような定義にしておいても困ることはない.</p>
<p><strong>補足の補足:</strong> 数学的詳細を理解できそうもないと感じる人であっても, 中心極限定理の良いユーザーになることは可能である. そのためには, 正規分布で近似したい分布のグラフとそれを近似すると期待される正規分布のグラフを重ねて描く作業を十分に沢山行えばよい. 数学的詳細を理解可能な人であっても, そういう視覚化による理解をサボってしまうと, 有限の <span class="math inline">\(n\)</span> でどのように正規分布による近似の精度が悪くなるかについての感覚が身に付かなくなってしまう. 数学的詳細を理解していなくても, 中心極限定理の利用でどのようなリスクが発生するかを具体例を沢山見ることによって把握していれば, その人は十分に良い中心極限定理ユーザーになれるだろう.</p>
</section>
<section id="中心極限定理の特性函数を使った証明" class="level3">
<h3 class="anchored" data-anchor-id="中心極限定理の特性函数を使った証明">中心極限定理の特性函数を使った証明</h3>
<p><strong>中心極限定理:</strong> <span class="math inline">\(X_1, X_2, X_3, \ldots\)</span> が独立同分布な確率変数の列であるとき, <span class="math inline">\(\mu=E[X_k]\)</span> が定義されていて, <span class="math inline">\(\sigma^2 = \operatorname{var}(X_k) = E[(X_k - \mu)^2] &lt; \infty\)</span> でかつ, <span class="math inline">\(E[|X_k - \mu|^3] &lt; \infty\)</span> となっていると仮定する. このとき,</p>
<p><span class="math display">\[
\bar{X}_n = \frac{1}{n}\sum_{k=1}^n X_k, \quad
Z_n = \frac{\sqrt{n}\,(\bar{X}_n - \mu)}{\sigma}
\]</span></p>
<p>とおくと, <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(Z_n\)</span> の分布は標準正規分布に近付く.</p>
<p><strong>証明:</strong> <span class="math inline">\(X_k\)</span> の標準化を <span class="math inline">\(Y_k = (X_k - \mu)/\sigma\)</span> と書くことにする. <span class="math inline">\(Y_1, Y_2, \ldots\)</span> も独立同分布になり, <span class="math inline">\(E[Y_k] = 0, \quad E[Y_k^2] = 1\)</span> が成立している. ゆえに <span class="math inline">\(Y_k\)</span> の特性函数 <span class="math inline">\(\varphi(t)\)</span> は <span class="math inline">\(k\)</span> によらず,</p>
<p><span class="math display">\[
\varphi(t) =
E[e^{itY_k}] =
1 + iE[Y_k]t - E[Y_k^2]\frac{t^2}{2} + O(t^3) =
1 - \frac{t^2}{2} + O(t^3)
\]</span></p>
<p>という形になる. そして,</p>
<p><span class="math display">\[
\frac{1}{\sqrt{n}}\sum_{k=1}^n Y_k =
\frac{\sqrt{n}}{\sigma}\frac{1}{n}\sum_{k=1}^n (X_k - \mu) =
\frac{\sqrt{n}}{\sigma}(\bar{X}_n - \mu) = Z_n
\]</span></p>
<p>なので, <span class="math inline">\(Z_n\)</span> の特性函数は, <span class="math inline">\(n\to\infty\)</span> で</p>
<p><span class="math display">\[
\begin{aligned}
\varphi_{Z_n}(t) &amp;=
E\left[\exp\left(it \frac{1}{\sqrt{n}}\sum_{k=1}^n Y_k\right)\right] =
E\left[\prod_{k=1}^n\exp\left(i\frac{t}{\sqrt{n}}Y_k\right)\right]
\\ &amp;=
\prod_{k=1}^n E\left[\exp\left(i\frac{t}{\sqrt{n}}Y_k\right)\right] =
\varphi\left(\frac{t}{\sqrt{n}}\right)^n =
\left(1 - \frac{t^2}{2n} + O(n^{-3/2})\right)^n \to
e^{-t^2/2}.
\end{aligned}
\]</span></p>
<p>と標準正規分布の特性函数 <span class="math inline">\(e^{-t^2/2}\)</span> に収束する. (3つめの等号で <span class="math inline">\(Y_1,\ldots,Y_n\)</span> の独立性を使った.)</p>
<p>ゆえに <span class="math inline">\(Z_n\)</span> の分布は <span class="math inline">\(n\to\infty\)</span> で標準正規分布に近付く.</p>
<p><strong>証明終</strong></p>
<p><strong>注意:</strong> <span class="math inline">\(f(x)\)</span> のFourier変換を</p>
<p><span class="math display">\[
\hat{f}(t) = \int_{-\infty}^\infty f(x) e^{-itx}\,dx
\]</span></p>
<p>と定義するとき, 逆Fourier変換によって,</p>
<p><span class="math display">\[
f(x) = \frac{1}{2\pi} \int_{-\infty}^\infty \hat{f}(t) e^{itx}\,dt
\]</span></p>
<p>が成立しているので, 確率変数 <span class="math inline">\(X\)</span> について <span class="math inline">\(f(X)\)</span> の期待値は, <span class="math inline">\(X\)</span> の特性函数 <span class="math inline">\(\varphi_X(t) = E[e^{itX}]\)</span> を使って,</p>
<p><span class="math display">\[
E[f(X)] = \frac{1}{2\pi} \int_{-\infty}^\infty \hat{f}(x) \varphi_X(t) \,dt
\]</span></p>
<p>と書ける(積分と期待値を取る操作を交換できる). このことから, 確率変数 <span class="math inline">\(X\)</span> の特性函数と確率変数 <span class="math inline">\(Y\)</span> の特性函数が近ければ, <span class="math inline">\(f(X)\)</span> と <span class="math inline">\(f(Y)\)</span> の期待値も近くなる. このことから, 分布の近似は特性函数の近似で扱えることがわかる.</p>
</section>
<section id="中心極限定理の収束の速さと歪度" class="level3">
<h3 class="anchored" data-anchor-id="中心極限定理の収束の速さと歪度">中心極限定理の収束の速さと歪度</h3>
<p>前節の証明より, 独立同分布確率変数列 <span class="math inline">\(X_1,X_2,\ldots\)</span> に対して,</p>
<p><span class="math display">\[
\mu = E[X_k], \quad
\sigma = \sqrt{E[(X-\mu)^2]}, \quad
Y_k = \frac{X_k - \mu}{\sigma}, \quad
\varphi(t) = E[e^{itY_k}]
\]</span></p>
<p>とおいたときの, <span class="math inline">\(n\to\infty\)</span> での <span class="math inline">\(\varphi(t/\sqrt{n})^n \to e^{-t^2/2}\)</span> という収束の速さを調べれば, 中心極限定理による正規分布への収束の速さがわかる.</p>
<p><span class="math display">\[
\bar\mu_3 = E[Y_k^3] = E\left[\left(\frac{X_k - \mu}{\sigma}\right)^3\right]
\]</span></p>
<p>とおくと,</p>
<p><span class="math display">\[
\varphi\left(\frac{t}{\sqrt{n}}\right) = E[e^{itY_k}] =
1 - \frac{t^2}{2n} - i\bar\mu_3\frac{t^3}{6n\sqrt{n}} + O(n^{-2})
\]</span></p>
<p>なので,</p>
<p><span class="math display">\[
\log\varphi\left(\frac{t}{\sqrt{n}}\right)^n =
n\log\left(1 - \frac{t^2}{2n} - i\bar\mu_3\frac{t^3}{6n\sqrt{n}} + O(n^{-2})\right) =
-\frac{t^2}{2} - i\bar\mu_3\frac{t^3}{6\sqrt{n}} + O(n^{-1}).
\]</span></p>
<p>これは <span class="math inline">\(n\to\infty\)</span> での <span class="math inline">\(\log\varphi\left(t/\sqrt{n}\right)^n \to -t^2/2\)</span> の収束の速さは, <span class="math inline">\(Y_k=(X_k-\mu)/\sigma\)</span> の3次のモーメント <span class="math inline">\(\bar\mu_3\)</span> の絶対値の大きさで大体決まっていることがわかる. <span class="math inline">\(\bar\mu_3\)</span> の絶対値が小さいほど収束が速く, 大きいほど収束が遅い.</p>
<p><span class="math inline">\(\bar\mu_3\)</span> は <span class="math inline">\(X_k\)</span> の分布の期待値 <span class="math inline">\(\mu\)</span> を中心とする非対称性の <span class="math inline">\(\sigma\)</span> によって適切に正規化した尺度になっている. <span class="math inline">\(\bar\mu_3\)</span> は <span class="math inline">\(Y_k=(X_k-\mu)/\sigma\)</span> の3次のキュムラントにも一致している:</p>
<p><span class="math display">\[
K_{Y_k}(t) = \log E[e^{tY_k}] =
\log\left(1 + \frac{t^2}{2} + \bar\mu_3\frac{t^3}{3!} + O(t^4)\right) =
\frac{t^2}{2} + \bar\mu_3 \frac{t^3}{3!} + O(t^4).
\]</span></p>
<p>ここでの <span class="math inline">\(t^3/3!\)</span> の係数 <span class="math inline">\(\bar\kappa_3 = \bar\mu_3\)</span> は <span class="math inline">\(X_k\)</span> の <strong>歪度</strong> (skewness) と呼ばれるのであった.</p>
</section>
<section id="中心極限定理のキュムラント母函数を使った証明" class="level3">
<h3 class="anchored" data-anchor-id="中心極限定理のキュムラント母函数を使った証明">中心極限定理のキュムラント母函数を使った証明</h3>
<p><strong>中心極限定理:</strong> <span class="math inline">\(X_1, X_2, X_3, \ldots\)</span> が独立同分布な確率変数の列であるとき, <span class="math inline">\(\mu=E[X_k]\)</span> が定義されていて, <span class="math inline">\(\sigma^2 = \operatorname{var}(X_k) = E[(X_k - \mu)^2] &lt; \infty\)</span> でかつ, <span class="math inline">\(E[|X_k - \mu|^3] &lt; \infty\)</span> となっており, さらに各 <span class="math inline">\(X_k\)</span> のキュムラント母函数がうまく定義されているとする. このとき,</p>
<p><span class="math display">\[
\bar{X}_n = \frac{1}{n}\sum_{k=1}^n X_k, \quad
Z_n = \frac{\sqrt{n}\,(\bar{X}_n - \mu)}{\sigma}
\]</span></p>
<p>とおくと, <span class="math inline">\(n\to\infty\)</span> で <span class="math inline">\(Z_n\)</span> の分布は標準正規分布に近付く.</p>
<p><strong>証明:</strong> <span class="math inline">\(X_k\)</span> の標準化を <span class="math inline">\(Y_k = (X_k - \mu)/\sigma\)</span> と書くことにする. <span class="math inline">\(Y_1, Y_2, \ldots\)</span> も独立同分布になり, <span class="math inline">\(E[Y_k] = 0, \quad E[Y_k^2] = 1\)</span> が成立している. ゆえに <span class="math inline">\(Y_k\)</span> のキュムラント母函数 <span class="math inline">\(K(t)\)</span> は <span class="math inline">\(k\)</span> によらず,</p>
<p><span class="math display">\[
K(t) = K_{Y_k}(t) = \frac{t^2}{2} + O(t^3)
\]</span></p>
<p>という形になる. そして,</p>
<p><span class="math display">\[
\frac{1}{\sqrt{n}}\sum_{k=1}^n Y_k =
\frac{\sqrt{n}}{\sigma}\frac{1}{n}\sum_{k=1}^n (X_k - \mu) =
\frac{\sqrt{n}}{\sigma}(\bar{X}_n - \mu) = Z_n
\]</span></p>
<p>なので, <span class="math inline">\(Z_n\)</span> のキュムラント母函数は, <span class="math inline">\(n\to\infty\)</span> で</p>
<p><span class="math display">\[
\begin{aligned}
K_{Z_n}(t) &amp;=
K_{Y_1/\sqrt{n}+\cdots+Y_n/\sqrt{n}}(t) =
K_{Y_1}\left(\frac{t}{\sqrt{n}}\right) + \cdots + K_{Y_1}\left(\frac{t}{\sqrt{n}}\right) \\ &amp;=
n K\left(\frac{t}{\sqrt{n}}\right) =
n\left(\frac{t^2}{2n} + O(n^{-3/2})\right) =
\frac{t^2}{2} + O(n^{-1/2})) \to
\frac{t^2}{2}
\end{aligned}
\]</span></p>
<p>と標準正規分布のキュムラント母函数 <span class="math inline">\(t^2/2\)</span> に収束する.</p>
<p>ゆえに <span class="math inline">\(Z_n\)</span> の分布は <span class="math inline">\(n\to\infty\)</span> で標準正規分布に近付く.</p>
<p><strong>証明終</strong></p>
<p><strong>注意:</strong> このようにキュムラント母函数を使うと証明が非常にシンプルになる.</p>
</section>
<section id="中心極限定理の収束の速さと歪度と尖度" class="level3">
<h3 class="anchored" data-anchor-id="中心極限定理の収束の速さと歪度と尖度">中心極限定理の収束の速さと歪度と尖度</h3>
<p>前節の証明より, 独立同分布確率変数列 <span class="math inline">\(X_1,X_2,\ldots\)</span> に対して,</p>
<p><span class="math display">\[
\mu = E[X_k], \quad
\sigma = \sqrt{E[(X-\mu)^2]}, \quad
K(t) = K_{(X_k - \mu)/\sigma}(t) = \log E\left[\left(\frac{X_k-\mu}{\sigma}\right)\right]
\]</span></p>
<p>とおいたときの, <span class="math inline">\(n\to\infty\)</span> での <span class="math inline">\(n K(t/\sqrt{n}) \to t^2/2\)</span> という収束の速さを調べれば, 中心極限定理による正規分布への収束の速さがわかる. <span class="math inline">\(X_k\)</span> の歪度(わいど) <span class="math inline">\(\bar\kappa_3\)</span> と尖度(せんど) <span class="math inline">\(\bar\kappa_4\)</span> は</p>
<p><span class="math display">\[
\bar\kappa_3 = E\left[\left(\frac{X_k - \mu}{\sigma}\right)^3\right], \quad
\bar\kappa_4 = E\left[\left(\frac{X_k - \mu}{\sigma}\right)^4\right] - 3
\]</span></p>
<p>と表され, <span class="math inline">\(X_k\)</span> の標準化のキュムラント母函数 <span class="math inline">\(K(t)\)</span> の展開の係数になっているのであった:</p>
<p><span class="math display">\[
K(t) = \frac{t^2}{2} + \bar\kappa_3\frac{t^3}{3!} + \bar\kappa_4\frac{t^4}{4!} + O(t^5).
\]</span></p>
<p>このとき,</p>
<p><span class="math display">\[
n K\left(\frac{t}{\sqrt{n}}\right) =
n\left(
\frac{t^2}{2n} + \bar\kappa_3\frac{t^3}{3!\,n^{3/2}} + \bar\kappa_4\frac{t^4}{4!\,n^2} + O(n^{-5/2})
\right) =
\frac{t^2}{2} + \bar\kappa_3\frac{t^3}{3!\,\sqrt{n}} + \bar\kappa_4\frac{t^4}{4!\,n} + O(n^{-3/2})
\]</span></p>
<p>これが <span class="math inline">\(t^2/2\)</span> に収束する速さは <span class="math inline">\(\bar\kappa_3 \ne 0\)</span> ならば <span class="math inline">\(O(n^{-1/2})\)</span> のオーダーになり, 歪度 <span class="math inline">\(\bar\kappa_3\)</span> の絶対値が大きいほど遅くなる. そして, <span class="math inline">\(\bar\kappa_3 = 0\)</span> ならば <span class="math inline">\(O(n^{-1})\)</span> のオーダーでの収束になり, 尖度 <span class="math inline">\(\bar\kappa_4\)</span> の絶対値が大きいほど収束は遅くなる.</p>
</section>
<section id="中心極限定理のtaylorの定理のみを使う証明" class="level3">
<h3 class="anchored" data-anchor-id="中心極限定理のtaylorの定理のみを使う証明">中心極限定理のTaylorの定理のみを使う証明</h3>
<p>以上では中心極限定理を特性函数やキュムラント母函数を使って証明する方法を(論理的には大雑把に)紹介した.</p>
<p>その方法は本質的にFourier解析に依存している.</p>
<p>実はFourier解析に依存せずに, 本質的にTaylorの定理(Taylor展開の剰余項版)しか使わない初等的な証明も存在する.</p>
<p>しかし, 読者の中にはTaylorの定理も証明をよく知らない人もいるかもしれないので, 以下では丁寧にTaylorの定理の証明の概略から説明して行くことにする.</p>
<section id="多重積分の書き方" class="level4">
<h4 class="anchored" data-anchor-id="多重積分の書き方">多重積分の書き方</h4>
<p>以下では多重積分での括弧を略して書くために, 次の式の右辺を左辺のように書くことにする:</p>
<p><span class="math display">\[
\int_a^b dx\,f(x) = \int_a^b f(x)\,dx.
\]</span></p>
<p>このように書くと, 次の右辺のように括弧が沢山必要になる多重積分の式を左辺のようにシンプルに書くことができる:</p>
<p><span class="math display">\[
\int_a^x dx_1\int_a^{x_1}dx_2\int_a^{x_2}dx_3\,g(x_3) =
\int_a^x\left(\int_a^{x_1}\left(\int_a^{x_2}g(x_3)\,dx_3\right)dx_2\right)dx_1
\]</span></p>
<p>しかも, この式の右辺の書き方だと, 積分変数の <span class="math inline">\(x_i\)</span> 達の指定が式の最後の方でされているので, <span class="math inline">\(\int_a^{x_i}\)</span> の部分の解釈を確定させるためには式を最後の方まで全部見る必要が生じてしまう. 左辺の書き方だとそのような問題が生じない.</p>
</section>
<section id="積分剰余項型のtaylorの定理" class="level4">
<h4 class="anchored" data-anchor-id="積分剰余項型のtaylorの定理">積分剰余項型のTaylorの定理</h4>
<p>以下では次の結果を示そう:</p>
<p><span class="math display">\[
R_4(x, a) = \int_a^x dx_1\int_a^{x_1}dx_2\int_a^{x_2}dx_3\int_a^{x_3}dx_4\, f^{(4)}(x_4)
\]</span></p>
<p>とおくと,</p>
<p><span class="math display">\[
\begin{aligned}
f(x) &amp;= f(a) + f(a)(x-a) + f''(a)\frac{(x-a)^2}{2} + f'''(a)\frac{(x-a)^3}{3!} + R_4(x,a).
\end{aligned}
\]</span></p>
<p>これを示すためには4階の導函数 <span class="math inline">\(f^{(4)}(x)\)</span> を4回不定積分すればよい. すなわち, 「微分して不定積分するときに適切に積分定数を決めてやればもとの函数に戻る」という結果</p>
<p><span class="math display">\[
g(x) = g(a) + \int_a^x dx'\,g'(x')
\]</span></p>
<p>を4回使うと,</p>
<p><span class="math display">\[
\begin{aligned}
f'''(x_3) &amp;= f'''(a) + \int_a^{x_3}dx_4\,f^{(4)}(x_4),
\\
f''(x_2) &amp;= f''(a) + \int_a^{x_2}dx_3\,f'''(x_3)
\\ &amp;=
f''(a) + f'''(a)(x_2 - a) + \int_a^{x_2}dx_3\int_a^{x_3}dx_4\,f^{(4)}(x_4)
\\
f'(x_1) &amp;= f'(a) + \int_a^{x_1}dx_2\,f''(x_2)
\\ &amp;=
f'(a) + f''(a)(x_1 - a) + f'''(a)\frac{(x_1 - a)^2}{2}
\\ &amp;+
\int_a^{x_1}dx_2\int_a^{x_2}dx_3\int_a^{x_3}dx_4\,f^{(4)}(x_4)
\\
f(x) &amp;= f(a) + \int_a^{x}dx_1\,f'(x_1)
\\ &amp;=
f(a) + f'(a)(x - a) + f''(a)\frac{(x - a)^2}{2} + f'''(a)\frac{(x - a)^3}{3!}
\\ &amp;+
\underbrace{
\int_a^{x}dx_1\int_a^{x_1}dx_2\int_a^{x_2}dx_3\int_a^{x_3}dx_4\,f^{(4)}(x_4)
}_{=R_4(x,a)}.
\end{aligned}
\]</span></p>
<p>不定積分を繰り返す過程で,</p>
<p><span class="math display">\[
\int_a^x dx'\,\frac{(x' - a)^k}{k!} =
\frac{(x - a)^{k+1}}{(k+1)!}
\]</span></p>
<p>となることから, 次の形の式が得られた:</p>
<p><span class="math display">\[
f(a) + f'(a)(x - a) + f''(a)\frac{(x - a)^2}{2} + f'''(a)\frac{(x - a)^3}{3!}
\]</span></p>
<p>以上とまったく同様にして次を示すことができる:</p>
<p><span class="math display">\[
R_n(x, a) = \int_a^x dx_1\int_a^{x_1}dx_2\cdots\int_a^{x_{n-1}}dx_n\, f^{(n)}(x_n)
\]</span></p>
<p>とおくと,</p>
<p><span class="math display">\[
f(x) = \sum_{k=0}^{n-1} f^{(k)}(a)\frac{(x-a)^k}{k!} + R_n(x,a).
\]</span></p>
<p>この結果を <strong>積分剰余項型のTaylorの定理</strong> と呼ぶことにする.</p>
<p>もしかしたら, 大学1年生のときの講義で剰余項の形が別のTaylorの定理について複雑な証明を聴いた人が多いかもしれないが, Taylorの定理の本質は「沢山微分して沢山積分すればもとの函数に戻る」ということに過ぎず, 直観的にはほとんど明らかな結果に過ぎない. 明らかな結果について「わけがわからないがとにかく成立する定理」だと認識してしまうことは数学を理解するときに避けるべきことである.</p>
</section>
<section id="積分剰余項の別の表示" class="level4">
<h4 class="anchored" data-anchor-id="積分剰余項の別の表示">積分剰余項の別の表示</h4>
<p>剰余項 <span class="math inline">\(R_n(x,t)\)</span> は次の式で定義されると考えてよい:</p>
<p><span class="math display">\[
R_n(x,t) = f(x) - \sum_{k=0}^{n-1} f^{(k)}(t)\frac{(x-t)^k}{k!}.
\]</span></p>
<p>このとき, <span class="math inline">\(R_n(x,x)=0\)</span> でかつ, 両辺を <span class="math inline">\(t\)</span> で偏微分すると,</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial}{\partial t}R_n(x,t) &amp;=
\sum_{k=1}^{n-1} f^{(k)}(t)\frac{(x-t)^{k-1}}{(k-1)!} -
\sum_{k=0}^{n-1} f^{(k+1)}(t)\frac{(x-t)^k}{k!}
\\ &amp;=
\sum_{k=1}^{n-1} f^{(k)}(t)\frac{(x-t)^{k-1}}{(k-1)!} -
\sum_{k=1}^{n} f^{(k)}(t)\frac{(x-t)^{k-1}}{(k-1)!}
\\ &amp;= -
f^{(n)}(t)\frac{(x-t)^{n-1}}{(n-1)!}.
\end{aligned}
\]</span></p>
<p>この偏導函数を <span class="math inline">\(t\)</span> について <span class="math inline">\(x\)</span> から <span class="math inline">\(a\)</span> まで積分することによって(<span class="math inline">\(a\)</span> から <span class="math inline">\(x\)</span> まで積分して <span class="math inline">\(-1\)</span> 倍することと同じ), 次が得られる:</p>
<p><span class="math display">\[
R_n(x,a) = \int_a^x f^{(n)}(t)\frac{(x-t)^{n-1}}{(n-1)!}\,dt.
\]</span></p>
<p>以上によっても積分剰余項型のTaylorの定理がシンプルに証明されたことになる.</p>
<p>Taylorの定理の証明は易しい!</p>
<p><strong>注意:</strong> <span class="math inline">\(h = x - a\)</span>, <span class="math inline">\(t = a + sh\)</span> とおくと, <span class="math inline">\(R_n(x,a)\)</span> は次のようにも表される:</p>
<p><span class="math display">\[
R_n(a+h, a) = h^n\int_0^1 f^{(n)}(a + sh)\frac{(1-s)^{n-1}}{(n-1)!}\,ds.
\]</span></p>
<p>すなわち,</p>
<p><span class="math display">\[
f(a+h) =
\sum_{k=0}^{n-1} f^{(k)}(a)\frac{h^k}{k!} +
h^n\int_0^1 f^{(n)}(a + sh)\frac{(1-s)^{n-1}}{(n-1)!}\,ds.
\]</span></p>
<p>後でTaylorの定理をこの形で使うことになる.</p>
<p><strong>注意:</strong> 上で求めた積分剰余項の公式と前節で求めた公式の関係. 前節では</p>
<p><span class="math display">\[
R_n(x, a) = \int_a^x dx_1\int_a^{x_1}dx_2\cdots\int_a^{x_{n-1}}dx_n\, f^{(n)}(x_n)
\]</span></p>
<p>を示した. 簡単のため <span class="math inline">\(a\le x\)</span> と仮定する(<span class="math inline">\(a \ge x\)</span> の場合も同様である). そのとき, すぐ上の式の右辺の積分の範囲は</p>
<p><span class="math display">\[
a \le x_n \le x_{n-1}\le x_{n-2}\le\cdots\le x_2 \le x_1 \le x
\]</span></p>
<p>なので, <span class="math inline">\(x_n\)</span> による積分を一番外側に出すと次のように書き直される:</p>
<p><span class="math display">\[
R_n(x, a) =
\int_a^x f^{(n)}(x_n)
\left(
\int_{x_n}^x\,dx_1\int_{x_n}^{x_1}dx_2\cdots\int_{x_n}^{x_{n-2}}dx_{n-1}
\right)\,dx_n.
\]</span></p>
<p><span class="math inline">\(\int_{x_n}^x\,dx_1\int_{x_n}^{x_1}dx_2\cdots\int_{x_n}^{x_{n-2}}dx_{n-1}\)</span> の部分は <span class="math inline">\(1\)</span> の <span class="math inline">\(n-1\)</span> 回の不定積分なので <span class="math inline">\((x-x_n)^{n-1}/(n-1)!\)</span> に等しい:</p>
<p><span class="math display">\[
\int_{x_n}^x\,dx_1\int_{x_n}^{x_1}dx_2\cdots\int_{x_n}^{x_{n-2}}dx_{n-1} =
\frac{(x-x_n)^{n-1}}{(n-1)!}.
\]</span></p>
<p>これより, 前節で求めた積分剰余項の公式から上で求めた公式が得られることがわかった.</p>
</section>
<section id="微分剰余項型のtaylorの定理" class="level4">
<h4 class="anchored" data-anchor-id="微分剰余項型のtaylorの定理">微分剰余項型のTaylorの定理</h4>
<p><span class="math inline">\(f(t)\)</span> は <span class="math inline">\(C^n\)</span> 級であると仮定する.</p>
<p>簡単のため <span class="math inline">\(a\le x\)</span> と仮定する(<span class="math inline">\(a\ge x\)</span> の場合も同様である). <span class="math inline">\(a\)</span> 以上 <span class="math inline">\(x\)</span> 以下の <span class="math inline">\(t\)</span> についての <span class="math inline">\(f^{(n)}(t)\)</span> の最小値と最大値をそれぞれ <span class="math inline">\(f^{(n)}(\alpha)\)</span>, <span class="math inline">\(f^{(n)}(\beta)\)</span> (<span class="math inline">\(a\le\alpha,\beta\le x\)</span>) と書くと,</p>
<p><span class="math display">\[
f^{(n)}(\alpha)\frac{(x-a)^n}{n!} \le
R_n(x,a) = \int_a^x f^{(n)}(t)\frac{(x-t)^{n-1}}{(n-1)!}\,dt
\le f^{(n)}(\beta)\frac{(x-a)^n}{n!}.
\]</span></p>
<p>ゆえに, 中間値の定理より, <span class="math inline">\(\alpha\)</span> と <span class="math inline">\(\beta\)</span> のあいだのある実数 <span class="math inline">\(\xi\)</span> が存在して,</p>
<p><span class="math display">\[
f^{(n)}(\xi)\frac{(x-a)^n}{n!} = R_n(x, a).
\]</span></p>
<p>これで積分を使わずに微分だけを使った剰余項の表示が得られた.</p>
</section>
<section id="taylorの定理を使った中心極限定理の証明" class="level4">
<h4 class="anchored" data-anchor-id="taylorの定理を使った中心極限定理の証明">Taylorの定理を使った中心極限定理の証明</h4>
<p><span class="math inline">\(X_1,X_2,X_3,\ldots\)</span> は同分布独立確率変数列であるとし, それらの共通の期待値 <span class="math inline">\(\mu=E[X_i]\)</span> は <span class="math inline">\(0\)</span> であるとし, 共通の分散 <span class="math inline">\(\sigma^2=E[(X_i-\mu)^2]\)</span> は <span class="math inline">\(1\)</span> であるとし, <span class="math inline">\(E[|X_i|^m]&lt;\infty\)</span> (<span class="math inline">\(m=3,4,5\)</span>)であると仮定し, <span class="math inline">\(X_i\)</span> の歪度と尖度を次のように書くことにする:</p>
<p><span class="math display">\[
\bar\kappa_3 = E[X_i^3], \quad \bar\kappa_4 = E[X_i^4] - 3.
\]</span></p>
<p>このとき, <span class="math inline">\(Z\)</span> を標準正規分布に従う確率変数であるとし,</p>
<p><span class="math display">\[
Z_n = \frac{1}{\sqrt{n}} \sum_{i=1}^n X_i.
\]</span></p>
<p>とおくと, 有限区間の外で <span class="math inline">\(0\)</span> になる <span class="math inline">\(C^5\)</span> 級函数 <span class="math inline">\(f(z)\)</span> に対して, <span class="math inline">\(m=3,4,5\)</span> に関する <span class="math inline">\(|f^{(m)}(z)|\)</span> の最大値を <span class="math inline">\(M_m\)</span> と書くと, <span class="math inline">\(n\to\infty\)</span> において次が成立している:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
|E[f(Z_n)] - E[f(Z)]|
\\ &amp;\le
\frac{M_3}{3!\,\sqrt{n}}|\bar\kappa_3| +
\frac{M_4}{4!\,n}|\bar\kappa_4| +
\frac{M_5}{5!\,n\sqrt{n}}(E[|X_i|^5] + E[|Z|^5]).
\end{aligned}
\]</span></p>
<p>特に次が成立している:</p>
<p><span class="math display">\[
\lim_{n\to\infty} E[f(Z_n)] = E[f(Z)].
\]</span></p>
<p><strong>注意:</strong> 必要ならば <span class="math inline">\(X_i\)</span> を <span class="math inline">\((X_i-\mu)/\sigma\)</span> で置き換えることによって, 上のように仮定しても一般性が失われないことに注意せよ.</p>
<p><strong>証明:</strong></p>
<p><strong>Step 1.</strong> <span class="math inline">\(Y_1,Y_2,Y_3,\ldots\)</span> は <span class="math inline">\(X_1,X_2,X_3,\ldots\)</span> とは別の独立同分布確率変数列であるとし, <span class="math inline">\(X_i,Y_i\)</span> の全体は独立でかつ <span class="math inline">\(E[Y_i]=0\)</span>, <span class="math inline">\(E[Y_i^2]=1\)</span>, <span class="math inline">\(E[|Y_i|^3]&lt;\infty\)</span> を満たしていると仮定する.</p>
<p><span class="math inline">\(W_n\)</span>, <span class="math inline">\(Z_n^{(k)}\)</span>, <span class="math inline">\(A_n^{(k)}\)</span> を次のように定める:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
W_n = \frac{1}{\sqrt{n}} \sum_{i=1}^n Y_i,
\\ &amp;
Z_n^{(k)} = \frac{1}{\sqrt{n}}(X_1+\cdots+X_k+Y_{k+1}+\cdots+Y_n),
\\ &amp;
A_n^{(k)} = \frac{1}{\sqrt{n}}(X_1+\cdots+X_{k-1}+Y_{k+1}+\cdots+Y_n).
\end{aligned}
\]</span></p>
<p>このとき,</p>
<p><span class="math display">\[
Z_n = Z_n^{(n)}, \quad
W_n = Z_n^{(0)}, \quad
Z_n^{(k)} = A_n^{(k)} + \frac{X_k}{\sqrt{n}}, \quad
Z_n^{(k-1)} = A_n^{(k)} + \frac{Y_k}{\sqrt{n}}.
\]</span></p>
<p>以下では, 大雑把に言うと, <span class="math inline">\(Z_n^{(k)}\)</span> の分布と <span class="math inline">\(Z_n^{(k-1)}\)</span> の分布の違いは小さいことを示す.</p>
<p>まず, <span class="math inline">\(G(a,h)\)</span> を次のように定める:</p>
<p><span class="math display">\[
G(a, h) = \int_0^1 f^{(5)}(a + sh)\frac{(1-s)^4}{4!}\,ds.
\]</span></p>
<p><span class="math inline">\(m=3,4,5\)</span> に対する <span class="math inline">\(|f^{(m)}(z)|\)</span> の最大値を <span class="math inline">\(M_m\)</span> と書くと,</p>
<p><span class="math display">\[
|G(a,h)| \le M_5 \int_0^1 \frac{(1-s)^4}{4!}\,ds = \frac{M_5}{5!}.
\]</span></p>
<p><span class="math inline">\(f(z)\)</span> にTaylorの定理を適用すると,</p>
<p><span class="math display">\[
f(a+h) =
f(a) + h f'(a) + \frac{h^2}{2}f''(a) +
\frac{h^3}{3!}f'''(a) + \frac{h^4}{4!}f^{(4)}(a) +
h^3 G(a, h).
\]</span></p>
<p>これを <span class="math inline">\(a = A_n^{(k)}\)</span>, <span class="math inline">\(h = X_k/\sqrt{n}, Y_k/\sqrt{n}\)</span> に適用すると,</p>
<p><span class="math display">\[
\begin{aligned}
f(Z_n^{(k)}) &amp;=
f(A_n^{(k)}) +
\frac{X_k}{\sqrt{n}} f'(A_n^{(k)}) + \frac{X_k^2}{2n}f''(A_n^{(k)})
\\ &amp;+
\frac{X_k^3}{3!\,n\sqrt{n}}f'''(A_n^{(k)}) + \frac{X_k^4}{4!\,n^2}f^{(4)}(A_n^{(k)}) +
\frac{X_k^5}{n^2\sqrt{n}} G\left(A_n^{(k)}, \frac{X_k}{\sqrt{n}}\right),
\\
f(Z_n^{(k-1)}) &amp;=
f(A_n^{(k)}) +
\frac{Y_k}{\sqrt{n}} f'(A_n^{(k)}) + \frac{Y_k^2}{2n}f''(A_n^{(k)})
\\ &amp;+
\frac{Y_k^3}{3!\,n\sqrt{n}}f'''(A_n^{(k)}) + \frac{Y_k^4}{4!\,n^2}f^{(4)}(A_n^{(k)}) +
\frac{Y_k^5}{n^2\sqrt{n}} G\left(A_n^{(k)}, \frac{Y_k}{\sqrt{n}}\right).
\end{aligned}
\]</span></p>
<p><span class="math inline">\(A_n^{(k)}, X_k, Y_k\)</span> は独立で, <span class="math inline">\(E[X_k]=E[Y_k]=0\)</span>, <span class="math inline">\(E[X_k^2]=E[Y_k^2]=1\)</span> であることより,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
E[f(Z_n^{(k)})] - E[f(Z_n^{(k-1)})]
\\ &amp;=
\frac{E[f'''(A_n^{(k)})]}{3!\,n\sqrt{n}}(E[X_k^3] - E[Y_k^3]) +
\frac{E[f^{(4)}(A_n^{(k)})]}{4!\,n^2}(E[X_k^4] - E[Y_k^4]) +
\frac{1}{n^2\sqrt{n}}
\left(
E\left[X_k^5 G\left(A_n^{(k)}, \frac{Y_k}{\sqrt{n}}\right)\right] +
E\left[Y_k^5 G\left(A_n^{(k)}, \frac{Y_k}{\sqrt{n}}\right)\right]
\right)
\end{aligned}
\]</span></p>
<p><span class="math inline">\(m=3,4,5\)</span> に対する <span class="math inline">\(|f^{(m)}(z)|\)</span> の最大値を <span class="math inline">\(M_m\)</span> と書くことにしてあったので,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
\left|E[f(Z_n^{(k)})] - E[f(Z_n^{(k-1)})]\right|
\\ &amp;\le
\frac{M_3}{3!\,n\sqrt{n}}|E[X_k^3] - E[Y_k^3]| +
\frac{M_4}{4!\,n^2}|E[X_k^4] - E[Y_k^4]|
\\ &amp;+
\frac{M_5}{5!\,n^2\sqrt{n}}(E[|X_k|^5] + E[|Y_k|^5]).
\end{aligned}
\]</span></p>
<p><strong>Step 2.</strong> <span class="math inline">\(X_k, Y_k\)</span> の分布が <span class="math inline">\(k\)</span> によらないことに注意しながら, これを <span class="math inline">\(k=1,2,\ldots,n\)</span> について足し上げることによって次が得られる:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
\left|E[f(Z_n)] - E[f(W_n)]\right|
\\ &amp;\le
\frac{M_3}{3!\,\sqrt{n}}|E[X_1^3] - E[Y_1^3]| +
\frac{M_4}{4!\,n}|E[X_1^4] - E[Y_1^4]|
\\ &amp;+
\frac{M_5}{5!\,n\sqrt{n}}(E[|X_1|^5] + E[|Y_1|^5]).
\end{aligned}
\]</span></p>
<p><strong>Step 3.</strong> <span class="math inline">\(Y_1,Y_2,Y_3,\ldots\)</span> の各々が標準正規分布に従っている場合. そのとき, <span class="math inline">\(\sum_{i=1}^n Y_i\)</span> は平均 <span class="math inline">\(0\)</span>, 分散 <span class="math inline">\(n\)</span> の正規分布に従うので, <span class="math inline">\(W_n = (1/\sqrt{n})\sum_{i=1}^n Y_i\)</span> は標準正規分布に従う. ゆえに <span class="math inline">\(E[f(W_n)]=E[f(Z)]\)</span>. さらにこのとき, <span class="math inline">\(E[Y_1^3]=0\)</span>, <span class="math inline">\(E[Y_1^4]=3\)</span> となっていることにも注意せよ. ゆえに, この場合に Step 2 の結果を適用すると次が得られる:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
|E[f(Z_n)] - E[f(Z)]|
\\ &amp;\le
\frac{M_3}{3!\,\sqrt{n}}|\bar\kappa_3| +
\frac{M_4}{4!\,n}|\bar\kappa_4| +
\frac{M_5}{5!\,n\sqrt{n}}(E[|X_i|^5] + E[|Z|^5]).
\end{aligned}
\]</span></p>
<p>これが示したい不等式であった.</p>
<p><strong>証明終</strong></p>
<p><strong>注意:</strong> <span class="math inline">\(Z\)</span> を標準正規分布に従う確率変数とするとき,</p>
<p><span class="math display">\[
E[|Z|^m] =
\frac{\Gamma((m+1)/2)}{\sqrt{2\pi}} =
\begin{cases}
1\cdot 3\cdots (2k-1)    &amp; (m = 2k \in 2{\mathbb Z}_{\ge 0}+1) \\
2^{k+1} k! \big/ \sqrt{2\pi} &amp; (m = 2k+1 \in 2{\mathbb Z}_{\ge 0}) \\
\end{cases}
\]</span></p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>[(<span class="fl">2</span><span class="fu">quadgk</span>(z <span class="op">-&gt;</span> z<span class="op">^</span>(<span class="fl">2</span>k)<span class="fu">*pdf</span>(<span class="fu">Normal</span>(), z), <span class="fl">0</span>, <span class="cn">Inf</span>)[<span class="fl">1</span>],</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>        <span class="fl">2</span><span class="op">^</span>(k<span class="op">+</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>)<span class="fu">*gamma</span>(k<span class="op">+</span><span class="fl">1</span><span class="op">/</span><span class="fl">2</span>)<span class="op">/</span><span class="fu">√</span>(<span class="fl">2</span>π), <span class="fu">prod</span>(<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">:</span><span class="fl">2</span>k<span class="op">-</span><span class="fl">1</span>)) for k <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>5-element Vector{Tuple{Float64, Float64, Int64}}:
 (0.9999999999999998, 1.0000000000000002, 1)
 (1.0000000000000009, 1.0000000000000002, 1)
 (3.000000000000005, 3.0000000000000004, 3)
 (15.00000000000029, 15.000000000000004, 15)
 (105.00000000000988, 105.00000000000001, 105)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>[(<span class="fl">2</span><span class="fu">√</span>(<span class="fl">2</span>π)<span class="fu">*quadgk</span>(z <span class="op">-&gt;</span> z<span class="op">^</span>(<span class="fl">2</span>k<span class="op">+</span><span class="fl">1</span>)<span class="fu">*pdf</span>(<span class="fu">Normal</span>(), z), <span class="fl">0</span>, <span class="cn">Inf</span>)[<span class="fl">1</span>],</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>        <span class="fl">2</span><span class="op">^</span>(k<span class="op">+</span><span class="fl">1</span>)<span class="fu">*gamma</span>(k<span class="op">+</span><span class="fl">1</span>), <span class="fl">2</span><span class="op">^</span>(k<span class="op">+</span><span class="fl">1</span>)<span class="fu">*factorial</span>(k)) for k <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>5-element Vector{Tuple{Float64, Float64, Int64}}:
 (1.9999999999999993, 2.0, 2)
 (4.0, 4.0, 4)
 (16.0000000000001, 16.0, 16)
 (96.00000000000463, 96.0, 96)
 (767.9999999999999, 768.0, 768)</code></pre>
</div>
</div>
</section>
<section id="中心極限定理の収束の速さと歪度と尖度再" class="level4">
<h4 class="anchored" data-anchor-id="中心極限定理の収束の速さと歪度と尖度再">中心極限定理の収束の速さと歪度と尖度(再)</h4>
<p>前節で示した不等式</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
|E[f(Z_n)] - E[f(Z)]|
\\ &amp;\le
\frac{M_3}{3!\,\sqrt{n}}|\bar\kappa_3| +
\frac{M_4}{4!\,n}|\bar\kappa_4| +
\frac{M_5}{5!\,n\sqrt{n}}(E[|X_i|^5] + E[|Z|^5]).
\end{aligned}
\]</span></p>
<p>より, 再び, <span class="math inline">\(X_i\)</span> 達に共通の歪度 <span class="math inline">\(\bar\kappa_3\)</span> と尖度 <span class="math inline">\(\bar\kappa_4\)</span> の大きさが中心極限定理の収束の速さにどのように関係しているかがわかる.</p>
<p><span class="math inline">\(\bar\kappa_3 = 0\)</span> ならば中心極限定理の収束の速さのオーダーは <span class="math inline">\(O(1/\sqrt{n})\)</span> から <span class="math inline">\(O(1/n)\)</span> に速くなる. <span class="math inline">\(\bar\kappa_3 = 0\)</span> の場合には <span class="math inline">\(\bar\kappa_4\)</span> が <span class="math inline">\(0\)</span> に近いと中心極限定理の収束はさらに速くなる.</p>
</section>
</section>
<section id="問題-中心極限定理の収束の様子のグラフ" class="level3">
<h3 class="anchored" data-anchor-id="問題-中心極限定理の収束の様子のグラフ">問題: 中心極限定理の収束の様子のグラフ</h3>
<p>中心極限定理による正規分布への収束の様子をコンピュータでグラフを描いて確認せよ. 収束が速い場合(<span class="math inline">\(n=10\)</span> ですでに正規分布に十分に近い場合)と遅い場合の両方の例を作れ.</p>
<p><strong>注意:</strong> 特に収束が遅い場合の様子を確認することが重要である. 中心極限定理は統計学において空気のごとく使用されるが, 数学的には収束が遅い場合があるので, 現実の分析で中心極限定理を使うことには注意を要する. しかし, 単に注意を要することを知っているだけでは役に立たない. 中心極限定理による収束が遅い場合について具体的な例を知っていれば, 危険を察知し易くなるだろう.</p>
<p>解答例は以下の通り.</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心極限定理による収束が速い場合1</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="co"># distを左右対称な分布でかつ「おとなしめなもの」とする</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> <span class="fu">Uniform</span>(<span class="fl">0</span>, <span class="fl">1</span>)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@show</span> <span class="fu">skewness</span>(dist) <span class="fu">kurtosis</span>(dist)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dist, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>; label<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"Uniform(0, 1)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 0.0
kurtosis(dist) = -1.2</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="68">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-69-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 分布distの独立同分布確率変数達(n個)の実現値(要するに乱数)を大量に(L個)生成</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="fl">10</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>L <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fl">6</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>Xs <span class="op">=</span> <span class="fu">rand</span>(dist, n, L) <span class="co"># Xs の s は X = (X_1, … , X_n) 達意味(複数という意味)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<pre><code>10×1000000 Matrix{Float64}:
 0.69636   0.594044    0.101207   0.585568  …  0.412965  0.769407  0.561924   0.549297
 0.455583  0.00625082  0.200664   0.617224     0.548981  0.753585  0.0714934  0.697381
 0.532193  0.0568614   0.754076   0.792645     0.86085   0.353983  0.456076   0.128428
 0.160711  0.894835    0.0814139  0.763581     0.131017  0.250157  0.135882   0.00415439
 0.402455  0.413405    0.985484   0.487877     0.806694  0.312485  0.217576   0.0966394
 0.767177  0.419651    0.0636221  0.633681  …  0.2683    0.920362  0.598985   0.916346
 0.722073  0.437216    0.555092   0.177624     0.27461   0.732253  0.616252   0.374544
 0.74838   0.302891    0.360538   0.154133     0.231352  0.708622  0.317037   0.0463222
 0.834451  0.997749    0.379788   0.54921      0.341319  0.514005  0.775241   0.568892
 0.185785  0.432522    0.529699   0.535293     0.431498  0.869273  0.667761   0.941884</code></pre>
</div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Z_n = √n(X̄_n - μ)/σ を大量に計算</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>μ <span class="op">=</span> <span class="fu">mean</span>(dist)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>σ <span class="op">=</span> <span class="fu">std</span>(dist)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>Zns <span class="op">=</span> [<span class="fu">√n*</span>(<span class="fu">mean</span>(X) <span class="op">-</span> μ)<span class="op">/</span>σ for X <span class="kw">in</span> <span class="fu">eachcol</span>(Xs)] <span class="co"># Zns はZ_n達という意味</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a><span class="fu">first</span>(Zns, <span class="fl">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>5-element Vector{Float64}:
  0.5533833927412413
 -0.48700635565736644
 -1.082755053207289
  0.3251668007347908
  0.39629489491877934</code></pre>
</div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Z_n達のヒストグラムと標準正規分布の密度函数を比較</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(Zns; norm<span class="op">=</span><span class="cn">true</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, bin<span class="op">=</span><span class="fl">100</span>, label<span class="op">=</span><span class="st">"Zₙ"</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot!</span>(<span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">1</span>); label<span class="op">=</span><span class="st">"Normal(0,1)"</span>, lw<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="fu">title!</span>(<span class="st">"n = </span><span class="sc">$</span>n<span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-72-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 以上の手続きを函数化</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># さらに</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   * メモリアロケーションの節約と並列化による最適化</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   * 離散分布の場合にも対応</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   * 歪度と尖度を混合モデルの場合にも表示</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_central_limit_theorem</span>(dist, n;</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>        L<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span>,</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>        μ <span class="op">=</span> <span class="fu">mean</span>(dist),</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>        σ <span class="op">=</span> <span class="fu">std</span>(dist),</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>        a <span class="op">=</span> <span class="fu">max</span>(<span class="fu">minimum</span>(dist), μ <span class="op">-</span> <span class="fl">5</span>σ),</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>        b <span class="op">=</span> <span class="fu">min</span>(<span class="fu">maximum</span>(dist), μ <span class="op">+</span> <span class="fl">5</span>σ),</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>        disttitle <span class="op">=</span> <span class="fu">distname</span>(dist),</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>        bin <span class="op">=</span> <span class="fl">100</span>,</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>        kwargs<span class="op">...</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"skewness(dist) = "</span>, <span class="fu">myskewness</span>(dist))</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"kurtosis(dist) = "</span>, <span class="fu">mykurtosis</span>(dist))</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 分布distをプロット</span></span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dist isa DiscreteUnivariateDistribution</span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>        P1 <span class="op">=</span> <span class="fu">bar</span>(<span class="fu">round</span>(<span class="dt">Int</span>, a)<span class="op">:</span><span class="fu">round</span>(<span class="dt">Int</span>, b), x <span class="op">-&gt;</span> <span class="fu">pdf</span>(dist, x), ; alpha<span class="op">=</span><span class="fl">0.3</span>, label<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>        P1 <span class="op">=</span> <span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">pdf</span>(dist, x), a, b; label<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title!</span>(disttitle)</span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 分布distの独立同分布確率変数達(n個)の実現値(要するに乱数)を大量に(L個)生成し,</span></span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Z_n = √n(X̄_n - μ)/σ を大量に計算することを並列化で実行</span></span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># このような計算には並列化が非常に有効である</span></span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>    Zns <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, L)</span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> [<span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, n) for _ <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="bu">Threads</span>.<span class="fu">nthreads</span>()]</span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Threads</span>.<span class="pp">@threads</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>L <span class="co"># Threads.@threads マクロで並列化</span></span>
<span id="cb112-34"><a href="#cb112-34" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="fu">rand!</span>(dist, tmp[<span class="bu">Threads</span>.<span class="fu">threadid</span>()]) <span class="co"># rand!を使ってアロケーションを節約</span></span>
<span id="cb112-35"><a href="#cb112-35" aria-hidden="true" tabindex="-1"></a>        Zns[i] <span class="op">=</span> <span class="fu">√n*</span>(<span class="fu">mean</span>(X) <span class="op">-</span> μ)<span class="op">/</span>σ</span>
<span id="cb112-36"><a href="#cb112-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb112-37"><a href="#cb112-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-38"><a href="#cb112-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Z達のヒストグラムと標準正規分布の密度函数を比較</span></span>
<span id="cb112-39"><a href="#cb112-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dist isa DiscreteUnivariateDistribution</span>
<span id="cb112-40"><a href="#cb112-40" aria-hidden="true" tabindex="-1"></a>        summin <span class="op">=</span> <span class="fu">max</span>(<span class="fu">n*minimum</span>(dist), <span class="fu">round</span>(n<span class="op">*</span>μ <span class="op">-</span> <span class="fl">6</span>√n<span class="op">*</span>σ))</span>
<span id="cb112-41"><a href="#cb112-41" aria-hidden="true" tabindex="-1"></a>        summax <span class="op">=</span> <span class="fu">min</span>(<span class="fu">n*maximum</span>(dist), <span class="fu">round</span>(n<span class="op">*</span>μ <span class="op">+</span> <span class="fl">6</span>√n<span class="op">*</span>σ))</span>
<span id="cb112-42"><a href="#cb112-42" aria-hidden="true" tabindex="-1"></a>        sumran <span class="op">=</span> summin<span class="op">-</span><span class="fl">0.5</span><span class="op">:</span>summax<span class="op">+</span><span class="fl">0.5</span></span>
<span id="cb112-43"><a href="#cb112-43" aria-hidden="true" tabindex="-1"></a>        bin <span class="op">=</span> @. <span class="fu">√n*</span>(sumran<span class="op">/</span>n <span class="op">-</span> μ)<span class="op">/</span>σ</span>
<span id="cb112-44"><a href="#cb112-44" aria-hidden="true" tabindex="-1"></a>        P2 <span class="op">=</span> <span class="fu">histogram</span>(Zns; norm<span class="op">=</span><span class="cn">true</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, bin, label<span class="op">=</span><span class="st">"Zₙ"</span>)</span>
<span id="cb112-45"><a href="#cb112-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb112-46"><a href="#cb112-46" aria-hidden="true" tabindex="-1"></a>        P2 <span class="op">=</span> <span class="fu">histogram</span>(Zns; norm<span class="op">=</span><span class="cn">true</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, bin, label<span class="op">=</span><span class="st">"Zₙ"</span>)</span>
<span id="cb112-47"><a href="#cb112-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb112-48"><a href="#cb112-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(<span class="fu">Normal</span>(<span class="fl">0</span>,<span class="fl">1</span>); label<span class="op">=</span><span class="st">"Normal(0,1)"</span>, lw<span class="op">=</span><span class="fl">2</span>)</span>
<span id="cb112-49"><a href="#cb112-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title!</span>(<span class="st">"n = </span><span class="sc">$</span>n<span class="st">"</span>)</span>
<span id="cb112-50"><a href="#cb112-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-51"><a href="#cb112-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(P1, P2; size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>), kwargs<span class="op">...</span>)</span>
<span id="cb112-52"><a href="#cb112-52" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="72">
<pre><code>plot_central_limit_theorem (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心極限定理による収束が速い場合1の再現</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Uniform</span>(<span class="fl">0</span>, <span class="fl">1</span>), <span class="fl">10</span>; a<span class="op">=-</span><span class="fl">0.5</span>, b<span class="op">=</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 0.0
kurtosis(dist) = -1.2</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="73">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-74-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心極限定理による収束が速い場合2</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Beta</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>), <span class="fl">10</span>; a<span class="op">=</span><span class="fl">0.01</span>, b<span class="op">=</span><span class="fl">0.99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 0.0
kurtosis(dist) = -1.5</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="74">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-75-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心極限定理による収束が速い場合3</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Bernoulli</span>(<span class="fl">0.5</span>), <span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 0.0
kurtosis(dist) = -2.0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="75">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-76-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心極限定理による収束が速い場合4</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Laplace</span>(), <span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 0.0
kurtosis(dist) = 3.0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="76">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-77-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 左右非対称な分布の場合1</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Gamma</span>(<span class="fl">3</span>, <span class="fl">1</span>), <span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 1.1547005383792517
kurtosis(dist) = 2.0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="77">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-78-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 左右非対称な分布の場合2</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Bernoulli</span>(<span class="fl">0.25</span>), <span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 1.1547005383792517
kurtosis(dist) = -0.666666666666667</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="78">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-79-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 左右非対称な分布の場合3</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Poisson</span>(<span class="fl">1</span>), <span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 1.0
kurtosis(dist) = 1.0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="79">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-80-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心極限定理による収束が遅い場合1</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 左右の非対称性が大きな分布を試してみる</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 指数分布は左右の非対称性が大きな分布になっている</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Exponential</span>(), <span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 2.0
kurtosis(dist) = 6.0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="80">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-81-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Exponential</span>(), <span class="fl">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 2.0
kurtosis(dist) = 6.0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="81">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-82-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Exponential</span>(), <span class="fl">160</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 2.0
kurtosis(dist) = 6.0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="82">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-83-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心極限定理による収束が遅い場合2</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 自由度1のχ²分は左右の非対称性が指数分布よりも大きな分布になっている</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Chisq</span>(<span class="fl">1</span>), <span class="fl">10</span>; a<span class="op">=</span><span class="fl">0.05</span>, b<span class="op">=</span><span class="fl">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 2.8284271247461903
kurtosis(dist) = 12.0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="83">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-84-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Chisq</span>(<span class="fl">1</span>), <span class="fl">40</span>; a<span class="op">=</span><span class="fl">0.05</span>, b<span class="op">=</span><span class="fl">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 2.8284271247461903
kurtosis(dist) = 12.0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="84">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-85-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">Chisq</span>(<span class="fl">1</span>), <span class="fl">160</span>; a<span class="op">=</span><span class="fl">0.05</span>, b<span class="op">=</span><span class="fl">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 2.8284271247461903
kurtosis(dist) = 12.0</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="85">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-86-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>以下で使う, 分布 <code>MixtureModel([Normal(0, 1), Normal(20, 1)], [0.95, 0.05])</code> の確率密度函数は次の形になる:</p>
<p><span class="math display">\[
p(x) = 0.95\,\frac{e^{-x^2/2}}{\sqrt{2\pi}} + 0.05\,\frac{e^{-(x-20)^2/2}}{\sqrt{2\pi}}.
\]</span></p>
<p>これは標準正規分布に割合が <span class="math inline">\(5\%\)</span> の極端な外れ値を付け加えた分布になっている. 何らかの原因で分布に極端な外れ値が混ざっている場合には中心極限定理を使うときに注意を要する.</p>
<p>このように確率密度函数が複数の正規分布の確率密度函数の一次結合になっている分布は <strong>混合正規分布</strong> (mixture normal distribution)と呼ばれている.</p>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心極限定理による収束が遅い場合3</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 以下のような分布distも左右の非対称性が大きな分布に分類される</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>dist <span class="op">=</span> <span class="fu">MixtureModel</span>([<span class="fu">Normal</span>(<span class="fl">0</span>, <span class="fl">1</span>), <span class="fu">Normal</span>(<span class="fl">20</span>, <span class="fl">1</span>)], [<span class="fl">0.95</span>, <span class="fl">0.05</span>])</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>disttitle <span class="op">=</span> <span class="st">"MixtureModel([Normal(0, 1), Normal(20, 1)], [0.95, 0.05])"</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>titlefontsize <span class="op">=</span> <span class="fl">9</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>a, b <span class="op">=</span> <span class="op">-</span><span class="fl">4</span>, <span class="fl">24</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(dist, <span class="fl">10</span>; a, b, disttitle, titlefontsize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 3.8236762415246486
kurtosis(dist) = 13.584999999990963</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="86">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-87-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(dist, <span class="fl">40</span>; a, b, disttitle, titlefontsize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 3.8236762415246486
kurtosis(dist) = 13.584999999990963</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="87">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-88-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(dist, <span class="fl">160</span>; a, b, disttitle, titlefontsize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 3.8236762415246486
kurtosis(dist) = 13.584999999990963</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="88">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-89-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 中心極限定理による収束が遅い場合4</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 対数正規分布は左右の非対称性が非常に大きな分布である</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 右側の裾が太く, 外れ値が出やすい</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">LogNormal</span>(), <span class="fl">10</span>; bin<span class="op">=</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 6.184877138632554
kurtosis(dist) = 110.9363921763115</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="89">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-90-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">LogNormal</span>(), <span class="fl">40</span>; bin<span class="op">=</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 6.184877138632554
kurtosis(dist) = 110.9363921763115</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="90">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-91-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_central_limit_theorem</span>(<span class="fu">LogNormal</span>(), <span class="fl">160</span>; bin<span class="op">=</span><span class="fu">range</span>(<span class="op">-</span><span class="fl">3</span>, <span class="fl">9</span>, <span class="fl">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>skewness(dist) = 6.184877138632554
kurtosis(dist) = 110.9363921763115</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="91">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-92-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="デルタ法" class="level2">
<h2 class="anchored" data-anchor-id="デルタ法">デルタ法</h2>
<section id="次のデルタ法と2次のデルタ法" class="level3">
<h3 class="anchored" data-anchor-id="次のデルタ法と2次のデルタ法">1次のデルタ法と2次のデルタ法</h3>
<p><span class="math inline">\(X\)</span> は平均 <span class="math inline">\(\mu\)</span>, 分散 <span class="math inline">\(\sigma^2\)</span> を持つ確率変数であるとし, 滑らかな函数 <span class="math inline">\(f(x)\)</span> にそれを代入して得られる確率変数 <span class="math inline">\(Y=f(X)\)</span> について考える.</p>
<p><span class="math inline">\(x\)</span> が <span class="math inline">\(\mu\)</span> に十分近ければ, <span class="math inline">\(y = f(x)\)</span> はその <span class="math inline">\(x = \mu\)</span> での接線</p>
<p><span class="math display">\[
y = f(\mu) + f'(\mu)(x - \mu)
\]</span></p>
<p>で近似される. <span class="math inline">\(\sigma\)</span> が十分小さければ <span class="math inline">\(X\)</span> の分布の大部分は <span class="math inline">\(\mu\)</span> の近くに集まり, 確率変数 <span class="math inline">\(Y = f(X)\)</span> は確率変数</p>
<p><span class="math display">\[
Y_1 = f(\mu) + f'(\mu)(X - \mu)
\]</span></p>
<p>で近似される. ゆえに</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
E[Y] \approx E[Y_1] = f(\mu) + f'(\mu)E[X - \mu] = f(\mu),
\\ &amp;
\operatorname{var}(Y) \approx \operatorname{var}(Y_1) = f'(\mu)^2\sigma^2
\end{aligned}
\]</span></p>
<p>という近似が使える. これを <strong>1次のデルタ法</strong> と呼ぶことにする.</p>
<p>接線よりも精密に2次までの項を加えた</p>
<p><span class="math display">\[
y = f(\mu) + f'(\mu)(x - \mu) + \frac{f''(\mu)}{2}(x - \mu)^2
\]</span></p>
<p>は <span class="math inline">\(y = f(x)\)</span> のさらに良い近似になっている. ゆえに, 確率変数 <span class="math inline">\(Y=f(X)\)</span> は, 上の <span class="math inline">\(Y_1\)</span> よりも,</p>
<p><span class="math display">\[
Y_2 = f(\mu) + f'(\mu)(X - \mu) + \frac{f''(\mu)}{2}(X - \mu)^2
\]</span></p>
<p>でより良く近似される. この近似を使えば, <span class="math inline">\(E[Y]\approx E[Y_1] = f(\mu)\)</span> よりも精度が高い</p>
<p><span class="math display">\[
E[Y] \approx E[Y_2] = f(\mu) + \frac{f''(\mu)}{2}E[(x - \mu)^2] =
f(\mu) + \frac{f''(\mu)\sigma^2}{2}
\]</span></p>
<p>という近似が得られる. これを <strong>2次のデルタ法</strong> と呼ぶことにする.</p>
</section>
<section id="おまけ-2次のデルタ法使用時の近似分散と歪度と尖度に関する不等式" class="level3">
<h3 class="anchored" data-anchor-id="おまけ-2次のデルタ法使用時の近似分散と歪度と尖度に関する不等式">おまけ: 2次のデルタ法使用時の近似分散と歪度と尖度に関する不等式</h3>
<p>確率変数 <span class="math inline">\(X\)</span> の期待値を <span class="math inline">\(\mu\)</span>, 分散を <span class="math inline">\(\sigma^2\)</span>, 歪度を <span class="math inline">\(\bar\kappa_3=E[((X-\mu)/\sigma)^3]\)</span>, 尖度を <span class="math inline">\(\bar\kappa_4=E[((X-\mu)/\sigma)^4]-3\)</span> と表し, 任意の実数 <span class="math inline">\(a,b,c\)</span> に対して,</p>
<p><span class="math display">\[
Y_2 = a + b(X-\mu) + c(X-\mu)^2
\]</span></p>
<p>とおく. このとき, <span class="math inline">\(E[Y_2]=a+c\sigma^2\)</span> となることは易しい. <span class="math inline">\(Y_2\)</span> の分散は以下のようにして求められる:</p>
<p><span class="math display">\[
\begin{aligned}
\operatorname{var}(Y_2) &amp;=
E[(Y_2 - (a+c\sigma^2))^2] =
E[(-c\sigma^2 + b(X-\mu) + c(X-\mu)^2)^2]
\\ &amp;=
E[c^2\sigma^4 -2bc\sigma^2(X-\mu) + (b^2 - 2c^2\sigma^2)(X-\mu)^2 +
2bc(X-\mu)^3 + c^2(X-\mu)^4]
\\ &amp;=
c^2\sigma^4 + (b^2 - 2c^2\sigma^2)\sigma^2 + 2bc\sigma^3\bar\kappa_3 + c^2\sigma^4(\bar\kappa_4 + 3)
\\ &amp;=
b^2\sigma^2 + 2bc\sigma^3\bar\kappa_3 + c^2\sigma^4(\bar\kappa_4 + 2)
\\ &amp;=
\begin{bmatrix} b\sigma &amp; c\sigma^2 \end{bmatrix}
\begin{bmatrix}
1     &amp; \bar\kappa_3 \\
\bar\kappa_3 &amp; \bar\kappa_4 + 2 \\
\end{bmatrix}
\begin{bmatrix}
b\sigma \\
c\sigma^2 \\
\end{bmatrix}.
\end{aligned}
\]</span></p>
<p>これが任意の実数 <span class="math inline">\(b,c\)</span> について <span class="math inline">\(0\)</span> 以上になることから, この結果に現れた <span class="math inline">\(2\times 2\)</span> 行列の行列式は <span class="math inline">\(0\)</span> 以上になることがわかるので, 次の不等式が得られる:</p>
<p><span class="math display">\[
\bar\kappa_4 + 2 \ge \bar\kappa_3^2.
\]</span></p>
<p>「標本分布について」のノートで標本平均と不偏分散の分散共分散行列の非負性を用いて示した「歪度と尖度に関する不等式」が再び証明された.</p>
<p><strong>注意:</strong> 以上の証明は本質的に <span class="math inline">\(X-\mu\)</span> と <span class="math inline">\((X-\mu)^2\)</span> の分散共分散行列が半正定値になることを使う証明と本質的に同じである.</p>
</section>
<section id="問題-2次のデルタ法の不偏分散の平方根の期待値の近似への応用" class="level3">
<h3 class="anchored" data-anchor-id="問題-2次のデルタ法の不偏分散の平方根の期待値の近似への応用">問題: 2次のデルタ法の不偏分散の平方根の期待値の近似への応用</h3>
<p><span class="math inline">\(X_1,X_2,\ldots,X_n\)</span> を独立同分布な確率変数達であるとし, それらの標本平均と不偏分散を</p>
<p><span class="math display">\[
\bar{X} = \frac{1}{n}\sum_{i=1}^n X_i, \quad
S^2 = \frac{1}{n-1}\sum_{i=1}^n(X_i - \bar{X})^2
\]</span></p>
<p>と書き, <span class="math inline">\(X_i\)</span> 達共通の期待値を <span class="math inline">\(\mu\)</span>, 共通の分散を <span class="math inline">\(\sigma^2\)</span> と書き, 共通の尖度を <span class="math inline">\(\bar\kappa_4 = E[((X_i-\mu)/\sigma)^4]-3\)</span> と書く. このとき, <span class="math inline">\(S^2\)</span> の期待値と分散は</p>
<p><span class="math display">\[
E[S^2] = \sigma^2, \quad
\operatorname{var}(S^2) = \sigma^4\left(\frac{\bar\kappa_4}{n} + \frac{2}{n-1}\right)
\]</span></p>
<p>となるのであった. これに2次のデルタ法を適用すると, <span class="math inline">\(S = \sqrt{S^2}\)</span> の期待値の <span class="math inline">\(\sigma\)</span> からのずれが近似的に</p>
<p><span class="math display">\[
E[S] \approx
\sigma - \frac{\operatorname{var}(S^2)}{8\sigma^3} =
\sigma\left(1 - \frac{1}{8}\left(\frac{\bar\kappa_4}{n} + \frac{2}{n-1}\right)\right)
\]</span></p>
<p>のように表されることを確認せよ.</p>
<p><strong>解答例:</strong> <span class="math inline">\(f(x) = \sqrt{x}\)</span> とおくと,</p>
<p><span class="math display">\[
f'(x) = \frac{1}{2}x^{-1/2}, \quad
f''(x) = -\frac{1}{4}x^{-3/2}, \quad
f(\sigma^2) = \sigma,  \quad
f''(\sigma^2) = -\frac{1}{4\sigma^3}
\]</span></p>
<p>なので, <span class="math inline">\(X = S^2\)</span> に2次のデルタ法を適用すると,</p>
<p><span class="math display">\[
\begin{aligned}
E[S] &amp;\approx
f(\sigma^2) + \frac{f''(\sigma^2)\operatorname{var}(S^2)}{2}
\\ &amp;=
\sigma - \frac{\operatorname{var}(S^2)}{8\sigma^3} =
\sigma\left(1 - \frac{1}{8}\left(\frac{\bar\kappa_4}{n} + \frac{2}{n-1}\right)\right).
\end{aligned}
\]</span></p>
<p><strong>解答終</strong></p>
<p><strong>注意:</strong> 不偏分散 <span class="math inline">\(S^2\)</span> は分散 <span class="math inline">\(\sigma^2\)</span> の不偏推定量だが, その平方根 <span class="math inline">\(S=\sqrt{S^2}\)</span> は標準偏差 <span class="math inline">\(\sigma\)</span> の不偏推定量にならないことが上の問題からわかる. <span class="math inline">\(\operatorname{var}(S^2) \ge 0\)</span> なので <span class="math inline">\(E[S]\)</span> の値は <span class="math inline">\(\sigma\)</span> よりも少し小さくなる.</p>
<p><strong>注意:</strong> これを理由に <span class="math inline">\(S=\sqrt{S^2}\)</span> は標準偏差の推定量として不適切であると考えては <strong>いけない</strong>. 推定量が不偏であること自体に特別に優先度が高い価値があるわけではない. 推定法に不偏性の条件を課すと誤差が増えてしまう場合がある.</p>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">check_deltamethod_for_S</span>(dist, n; L<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">7</span>)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>    σ <span class="op">=</span> <span class="fu">std</span>(dist)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>    ku <span class="op">=</span> <span class="fu">mykurtosis</span>(dist)</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> dist</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"kurtosis = "</span>, ku)</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@show</span> n</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, L)</span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> [<span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="cn">undef</span>, n) for _ <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="bu">Threads</span>.<span class="fu">nthreads</span>()]</span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Threads</span>.<span class="pp">@threads</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>L</span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="fu">rand!</span>(dist, tmp[<span class="bu">Threads</span>.<span class="fu">threadid</span>()])</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>        S[i] <span class="op">=</span> <span class="fu">std</span>(X)</span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"approximation = "</span>, <span class="fu">σ*</span>(<span class="fl">1</span> <span class="op">-</span> (<span class="fl">1</span><span class="op">/</span><span class="fl">8</span>)<span class="fu">*</span>(ku<span class="op">/</span>n <span class="op">+</span> <span class="fl">2</span><span class="op">/</span>(n<span class="op">-</span><span class="fl">1</span>))))</span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"mean(S) =       "</span>, <span class="fu">mean</span>(S))</span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(<span class="st">"σ =             "</span>, σ)</span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>check_deltamethod_for_S (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_deltamethod_for_S</span>(<span class="fu">Normal</span>(<span class="fl">2</span>, <span class="fl">3</span>), <span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dist = Normal{Float64}(μ=2.0, σ=3.0)
kurtosis = 0.0
n = 10
approximation = 2.9166666666666665
mean(S) =       2.9177985648486846
σ =             3.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_deltamethod_for_S</span>(<span class="fu">Uniform</span>(), <span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dist = Uniform{Float64}(a=0.0, b=1.0)
kurtosis = -1.2
n = 10
approximation = 0.28498650787499025
mean(S) =       0.284745125565968
σ =             0.28867513459481287</code></pre>
</div>
</div>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_deltamethod_for_S</span>(<span class="fu">Gamma</span>(<span class="fl">4</span>, <span class="fl">3</span>), <span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dist = Gamma{Float64}(α=4.0, θ=3.0)
kurtosis = 1.5
n = 10
approximation = 5.720833333333333
mean(S) =       5.756825778469068
σ =             6.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_deltamethod_for_S</span>(<span class="fu">Bernoulli</span>(<span class="fl">0.4</span>), <span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dist = Bernoulli{Float64}(p=0.4)
kurtosis = -1.833333333333333
n = 10
approximation = 0.4875165001955964
mean(S) =       0.4859261267812284
σ =             0.4898979485566356</code></pre>
</div>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_deltamethod_for_S</span>(<span class="fu">LogNormal</span>(), <span class="fl">10</span>; L<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dist = LogNormal{Float64}(μ=0.0, σ=1.0)
kurtosis = 110.9363921763115
n = 10
approximation = -0.895778896909659
mean(S) =       1.7189602620260134
σ =             2.1611974158950877</code></pre>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_deltamethod_for_S</span>(<span class="fu">LogNormal</span>(), <span class="fl">100</span>; L<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dist = LogNormal{Float64}(μ=0.0, σ=1.0)
kurtosis = 110.9363921763115
n = 100
approximation = 1.856045541537819
mean(S) =       2.045021159750118
σ =             2.1611974158950877</code></pre>
</div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_deltamethod_for_S</span>(<span class="fu">LogNormal</span>(), <span class="fl">1000</span>; L<span class="op">=</span><span class="fl">10</span><span class="op">^</span><span class="fl">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dist = LogNormal{Float64}(μ=0.0, σ=1.0)
kurtosis = 110.9363921763115
n = 1000
approximation = 2.1306871451883986
mean(S) =       2.1401746972758264
σ =             2.1611974158950877</code></pre>
</div>
</div>
</section>
<section id="問題-1次のデルタ法の正規分布近似への応用" class="level3">
<h3 class="anchored" data-anchor-id="問題-1次のデルタ法の正規分布近似への応用">問題: 1次のデルタ法の正規分布近似への応用</h3>
<p>確率変数 <span class="math inline">\(X\)</span> が近似的に正規分布 <span class="math inline">\(\operatorname{Normal}(\mu,\sigma)\)</span> に従っているとき, 滑らかな函数 <span class="math inline">\(f(x)\)</span> に対して, <span class="math inline">\(\sigma\)</span> が十分に小さければ, 確率変数 <span class="math inline">\(Y = f(X)\)</span> は近似的に正規分布 <span class="math inline">\(\operatorname{Normal}(f(\mu), |f'(\mu)|\sigma)\)</span> に従うことを示せ.</p>
<p><strong>解答例:</strong> <span class="math inline">\(x\)</span> が <span class="math inline">\(\mu\)</span> に十分近ければ <span class="math inline">\(y = f(x)\)</span> は <span class="math inline">\(x=\mu\)</span> における接線 <span class="math inline">\(y = f(\mu) + f'(\mu)(x - \mu)\)</span> で近似される. <span class="math inline">\(\sigma\)</span> が十分に小さければ確率変数 <span class="math inline">\(X\)</span> の分布の大部分は <span class="math inline">\(\mu\)</span> の十分近くに留まる. 以上の状況のもとで, 確率変数 <span class="math inline">\(Y = f(X)\)</span> は確率変数 <span class="math inline">\(Y_1 = f(\mu) + f'(\mu)(X - \mu)\)</span> で近似される. <span class="math inline">\(X\)</span> が正規分布 <span class="math inline">\(\operatorname{Normal}(\mu,\sigma)\)</span> に近似的に従っていると仮定しているので, そのアフィン変換である <span class="math inline">\(Y_1\)</span> も近似的に正規分布に従い, その期待値と分散は</p>
<p><span class="math display">\[
E[Y_1] = f(\mu) + f'(\mu)E[X-\mu] \approx f(\mu), \quad
\operatorname{var}(Y_1) = f'(\mu)^2\operatorname{var}(X) \approx f'(\mu)^2\sigma^2
\]</span></p>
<p>となる. 以上をまとめると, <span class="math inline">\(Y\)</span> が近似的に正規分布 <span class="math inline">\(\operatorname{Normal}(f(\mu), |f'(\mu)|\sigma)\)</span> に従うことがわかる.</p>
<p><strong>解答終</strong></p>
<p><strong>注意:</strong> デルタ法を使うと, 正規分布で近似される確率変数から正規分布に近似的に従う別の確率変数を作れる. 中心極限定理による正規分布近似はデルタ法を使えば大幅に拡張される. 以上では一変数函数 <span class="math inline">\(f(x)\)</span> に正規分布に近似的に従う確率変数 <span class="math inline">\(X\)</span> を代入する場合のみを扱ったが, 多変数函数に複数の正規分布に近似的に従う確率変数達を代入する場合も同じように一次近似で考えればよい.</p>
</section>
<section id="問題-1次のデルタ法による分布の逆数の近似" class="level3">
<h3 class="anchored" data-anchor-id="問題-1次のデルタ法による分布の逆数の近似">問題: 1次のデルタ法による分布の逆数の近似</h3>
<p>正値の確率変数 <span class="math inline">\(X\)</span> は正規分布 <span class="math inline">\(\operatorname{Normal}(\mu, \sigma)\)</span> に近似的に従っていると仮定し, <span class="math inline">\(\sigma/\mu\)</span> は十分に小さいと仮定する. このとき, <span class="math inline">\(Y = 1/X\)</span> が正規分布 <span class="math inline">\(\operatorname{Normal}(1/\mu, \sigma/\mu^2)\)</span> に近似的に従うことを示せ.</p>
<p><strong>解答例:</strong> <span class="math inline">\(f(x)=1/x\)</span> とおくと,</p>
<p><span class="math display">\[
f(x) = \frac{1/\mu}{1 + (x/\mu - 1)} =
\frac{1}{\mu}\left(1 - \left(\frac{x}{\mu}-1\right) + \left(\frac{x}{\mu}-1\right)^2 - \cdots\right)
\]</span></p>
<p>なので, <span class="math inline">\(y = f(x)\)</span> は <span class="math inline">\(x/\mu\)</span> が <span class="math inline">\(1\)</span> に近ければ, その <span class="math inline">\(x=\mu\)</span> での接線</p>
<p><span class="math display">\[
y =
\frac{1}{\mu}\left(1 - \left(\frac{x}{\mu}-1\right)\right) =
\frac{1}{\mu} - \frac{x - \mu}{\mu^2}
\]</span></p>
<p>で近似される. <span class="math inline">\(\sigma/\mu\)</span> が十分に小さければ <span class="math inline">\(X/\mu\)</span> の分布の大部分は <span class="math inline">\(1\)</span> の近くに留まる. ゆえに <span class="math inline">\(Y=1/X\)</span> の分布は <span class="math inline">\(Y_1 = 1/\mu - (X-\mu)/\mu^2\)</span> の分布で近似される. このことから, <span class="math inline">\(Y=1/X\)</span> が平均 <span class="math inline">\(1/\mu\)</span>, 分散 <span class="math inline">\(\sigma^2/\mu^4\)</span> の正規分布に近似的に従うことがわかる.</p>
<p><strong>解答終</strong></p>
</section>
<section id="例-自由度が大きなχ²分布の逆数の近似" class="level3">
<h3 class="anchored" data-anchor-id="例-自由度が大きなχ²分布の逆数の近似">例: 自由度が大きなχ²分布の逆数の近似</h3>
<p>例えば, <span class="math inline">\(X \sim \operatorname{Chisq}(\nu)\)</span> のとき, <span class="math inline">\(E[X]=\nu\)</span>, <span class="math inline">\(\operatorname{var}(X)=2\nu\)</span> であり, <span class="math inline">\(\nu\)</span> が大きなとき <span class="math inline">\(X\)</span> は近似的に平均 <span class="math inline">\(\mu=\nu\)</span>, 分散 <span class="math inline">\(\sigma^2=2\nu\)</span> の正規分布に近似的に従い, <span class="math inline">\(\nu\)</span> が大きなとき <span class="math inline">\(\sigma/\mu = \sqrt{2/\nu}\)</span> の値は小さくなる. ゆえに上の問題の結果より, <span class="math inline">\(1/X\)</span> は平均 <span class="math inline">\(1/\mu = 1/\nu\)</span>, 分散 <span class="math inline">\(\sigma^2/\mu^4 = 2/\nu^3\)</span> の正規分布に近似的に従う.</p>
<p><strong>注意:</strong> <span class="math inline">\(X\sim\operatorname{Chisq}(\nu) = \operatorname{Gamma}(\nu/2, 2)\)</span> のとき, <span class="math inline">\(1/X\sim\operatorname{InverseGamma}(\nu/2, 1/2)\)</span> なので,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
E[1/X] = \frac{1/2}{\nu/2-1} = \frac{1}{\nu-2} \approx \frac{1}{\nu},
\\ &amp;
\operatorname{var}(1/X) = \frac{(1/2)^2}{(\nu/2-1)^2(\nu/2-2)} =
\frac{2}{(\nu-2)^2(\nu-4)} \approx \frac{2}{\nu^3}.
\end{aligned}
\]</span></p>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">InverseChisq</span>(ν) <span class="op">=</span> <span class="fu">InverseGamma</span>(ν<span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_invchisq</span>(ν)</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> (<span class="fu">max</span>(<span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span>ν <span class="op">-</span> <span class="fl">4</span><span class="fu">√</span>(<span class="fl">2</span><span class="op">/</span>ν<span class="op">^</span><span class="fl">3</span>)), <span class="fl">1</span><span class="op">/</span>ν <span class="op">+</span> <span class="fl">6</span><span class="fu">√</span>(<span class="fl">2</span><span class="op">/</span>ν<span class="op">^</span><span class="fl">3</span>))</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(<span class="fu">InverseChisq</span>(ν), xlim<span class="op">...</span>; label<span class="op">=</span><span class="st">"InverseChisq(ν=</span><span class="sc">$</span><span class="st">ν)")</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a><span class="st">    </span>plot<span class="st">!(Normal(1/ν, √(2/ν^3)); label="</span><span class="fu">Normal</span>(<span class="fl">1</span><span class="op">/</span>ν, <span class="fu">√</span>(<span class="fl">2</span><span class="op">/</span>ν³))<span class="st">", ls=:dash)</span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(; legend<span class="op">=:</span>outertop)</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>plot_invchisq (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">plot_invchisq</span>.((<span class="fl">10</span>, <span class="fl">40</span>))<span class="op">...</span>; size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>), layout<span class="op">=</span>(<span class="fl">1</span>, <span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-102-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">plot_invchisq</span>.((<span class="fl">160</span>, <span class="fl">640</span>))<span class="op">...</span>; size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>), layout<span class="op">=</span>(<span class="fl">1</span>, <span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="102">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-103-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="問題-デルタ法による分布の対数の近似" class="level3">
<h3 class="anchored" data-anchor-id="問題-デルタ法による分布の対数の近似">問題: デルタ法による分布の対数の近似</h3>
<p>正値の確率変数 <span class="math inline">\(X\)</span> は正規分布 <span class="math inline">\(\operatorname{Normal}(\mu, \sigma)\)</span> に近似的に従っていると仮定し, <span class="math inline">\(\sigma/\mu\)</span> は十分に小さいと仮定する. このとき, <span class="math inline">\(Y = \log X\)</span> が正規分布 <span class="math inline">\(\operatorname{Normal}(\log \mu, \sigma/\mu)\)</span> に近似的に従うことを示せ.</p>
<p><strong>解答例:</strong> <span class="math inline">\(f(x)=\log x\)</span> とおくと,</p>
<p><span class="math display">\[
f(x) = \log\nu\left(1 + \left(\frac{x}{\mu}-1\right)\right) =
\log\mu + \left(\frac{x}{\mu}-1\right) - \frac{1}{2}\left(\frac{x}{\mu}-1\right)^2 + \cdots
\]</span></p>
<p>なので, <span class="math inline">\(y = f(x)\)</span> は <span class="math inline">\(x/\mu\)</span> が <span class="math inline">\(1\)</span> に近ければ, その <span class="math inline">\(x=\mu\)</span> での接線</p>
<p><span class="math display">\[
y = \log\mu + \left(\frac{x}{\mu}-1\right) =
\log\mu + \frac{x-\mu}{\mu}
\]</span></p>
<p>で近似される. <span class="math inline">\(\sigma/\mu\)</span> が十分に小さければ <span class="math inline">\(X/\mu\)</span> の分布の大部分は <span class="math inline">\(1\)</span> の近くに留まる. ゆえに <span class="math inline">\(Y=\log X\)</span> の分布は <span class="math inline">\(Y_1 = \log\mu + (X-\mu)/\mu\)</span> の分布で近似される. このことから, <span class="math inline">\(Y=\log X\)</span> が平均 <span class="math inline">\(\log\mu\)</span>, 分散 <span class="math inline">\(\sigma^2/\mu^2\)</span> の正規分布に近似的に従うことがわかる.</p>
<p><strong>解答終</strong></p>
<p><strong>注意:</strong> 正値の確率変数の分布は対数を取ることによって左右の非対称性が緩和されて, 正規分布近似がより正確になる場合がある(次の節の例を見よ). 分布の非対称性を補正して正規分布近似をより正確にする工夫は色々研究されている.</p>
</section>
<section id="例-自由度が大きなχ²分布の対数の近似" class="level3">
<h3 class="anchored" data-anchor-id="例-自由度が大きなχ²分布の対数の近似">例: 自由度が大きなχ²分布の対数の近似</h3>
<p>例えば, <span class="math inline">\(X \sim \operatorname{Chisq}(\nu)\)</span> のとき, <span class="math inline">\(E[X]=\nu\)</span>, <span class="math inline">\(\operatorname{var}(X)=2\nu\)</span> であり, <span class="math inline">\(\nu\)</span> が大きなとき <span class="math inline">\(X\)</span> は近似的に平均 <span class="math inline">\(\mu=\nu\)</span>, 分散 <span class="math inline">\(\sigma^2=2\nu\)</span> の正規分布に近似的に従い, <span class="math inline">\(\nu\)</span> が大きなとき <span class="math inline">\(\sigma/\mu = \sqrt{2/\nu}\)</span> の値は小さくなる. ゆえに上の問題の結果より, <span class="math inline">\(\log X\)</span> は平均 <span class="math inline">\(\log\mu = \log\nu\)</span>, 分散 <span class="math inline">\(\sigma^2/\mu^2 = 2/\nu\)</span> の正規分布に近似的に従う.</p>
<p>この場合には余り大きくない自由度 <span class="math inline">\(\nu\)</span> におけるχ²分布の左右の非対称性が対数を取ることによって緩和され, 正規分布による近似の精度が高まる.</p>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf_logchisq</span>(ν, y) <span class="op">=</span> <span class="fu">pdf</span>(<span class="fu">Chisq</span>(ν), <span class="fu">exp</span>(y))<span class="fu">*exp</span>(y)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_logchisq</span>(ν)</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> (<span class="fu">max</span>(<span class="fl">0</span>, ν <span class="op">-</span> <span class="fl">4</span><span class="fu">√</span>(<span class="fl">2</span>ν)), ν <span class="op">+</span> <span class="fl">4</span><span class="fu">√</span>(<span class="fl">2</span>ν))</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>    P0 <span class="op">=</span> <span class="fu">plot</span>(<span class="fu">Chisq</span>(ν), xlim<span class="op">...</span>; label<span class="op">=</span><span class="st">"Chisq(ν=</span><span class="sc">$</span><span class="st">ν)")</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a><span class="st">    </span>plot<span class="st">!(Normal(ν, √(2ν)); label="</span><span class="fu">Normal</span>(ν, <span class="fu">√</span>(<span class="fl">2</span>ν))<span class="st">", ls=:dash)</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(; legend<span class="op">=:</span>outertop)</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> (<span class="fu">log</span>(ν) <span class="op">-</span> <span class="fl">5</span><span class="fu">√</span>(<span class="fl">2</span><span class="op">/</span>ν), <span class="fu">log</span>(ν) <span class="op">+</span> <span class="fl">4</span><span class="fu">√</span>(<span class="fl">2</span><span class="op">/</span>ν))</span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>    P1 <span class="op">=</span> <span class="fu">plot</span>(y <span class="op">-&gt;</span> <span class="fu">pdf</span>(<span class="fu">Chisq</span>(ν), <span class="fu">exp</span>(y))<span class="fu">*exp</span>(y), xlim<span class="op">...</span>; label<span class="op">=</span><span class="st">"LogChisq(ν=</span><span class="sc">$</span><span class="st">ν)")</span></span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a><span class="st">    </span>plot<span class="st">!(Normal(log(ν), √(2/ν)); label="</span><span class="fu">Normal</span>(log ν, <span class="fu">√</span>(<span class="fl">2</span><span class="op">/</span>ν))<span class="st">", ls=:dash)</span></span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(; legend<span class="op">=:</span>outertop)</span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(P0, P1; size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>))</span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>plot_logchisq (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_logchisq</span>(<span class="fl">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-105-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_logchisq</span>(<span class="fl">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="105">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-106-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_logchisq</span>(<span class="fl">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="106">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-107-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_logchisq</span>(<span class="fl">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="107">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-108-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="問題-ベータ分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="問題-ベータ分布の正規分布近似">問題: ベータ分布の正規分布近似</h3>
<p>確率変数達 <span class="math inline">\(X,Y\)</span> は独立であり, <span class="math inline">\(X\sim\operatorname{Gamma}(\alpha,1)\)</span>, <span class="math inline">\(Y\sim\operatorname{Gamma}(\beta,1)\)</span> を満たしていると仮定する. このとき <span class="math inline">\(T = X/(X+Y)\)</span> とおくと, <span class="math inline">\(T\sim \operatorname{Beta}(\alpha,\beta)\)</span> となるのであった. <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span> が大きなとき, <span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span> の分布はそれぞれ <span class="math inline">\(\operatorname{Normal}(\alpha, \sqrt{\alpha})\)</span>, <span class="math inline">\(\operatorname{Normal}(\beta, \sqrt{\beta})\)</span> に近似的に従う. 2変数函数 <span class="math inline">\(f(x,y)=x/(x+y)\)</span> に1次のデルタ法を適用して, <span class="math inline">\(\alpha,\beta\)</span> が大きなとき, <span class="math inline">\(T=X/(X+Y)\sim \operatorname{Beta}(\alpha,\beta)\)</span> が</p>
<p><span class="math display">\[
\operatorname{Normal}\left(\frac{\alpha}{\alpha+\beta}, \sqrt{\frac{\alpha\beta}{(\alpha+\beta)^3}}\right)
\]</span></p>
<p>に近似的に従うことを示せ.</p>
<p><strong>注意:</strong> <span class="math inline">\(T\sim \operatorname{Beta}(\alpha,\beta)\)</span> の正確な期待値と分散は次のようになる:</p>
<p><span class="math display">\[
E[T] = \frac{\alpha}{\alpha+\beta}, \quad
\operatorname{var}(T) = \frac{\alpha\beta}{(\alpha+\beta)^2(\alpha+\beta+1)}.
\]</span></p>
<p><strong>解答例:</strong> <span class="math inline">\(f(x,y) = x/(x+y) = 1 - y/(x+y)\)</span> を偏微分すると,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
f_x(x,y) = \frac{y}{(x+y)^2}, \quad
f_y(x,y) = \frac{-x}{(x+y)^2},
\\ &amp;
f_{xx}(x,y) = \frac{-2y}{(x+y)^3}, \quad
f_{xy}(x,y) = \frac{x-y}{(x+y)^3}, \quad
f_{yy}(x,y) = \frac{2x}{(x+y)^3}
\end{aligned}
\]</span></p>
<p>なので,</p>
<p><span class="math display">\[
\begin{aligned}
T &amp;= \frac{X}{X+Y} = f(X,Y)
\\ &amp;=
f(\alpha, \beta) + f_x(\alpha,\beta)(X-\alpha) + f_y(\alpha,\beta)(Y-\beta)
\\ &amp;+
\frac{1}{2}\left(
f_{xx}(\alpha,\beta)(X-\alpha)^2 +
2f_{xy}(\alpha,\beta)(X-\alpha)(Y-\beta) +
f_{yy}(\alpha,\beta)(Y-\beta)^2
\right) + \cdots
\\ &amp;=
\frac{\alpha}{\alpha+\beta} +
\frac{\beta}{(\alpha+\beta)^2}(X-\alpha) +
\frac{-\alpha}{(\alpha+\beta)^2}(Y-\beta)
\\ &amp;+
\frac{-\beta}{(\alpha+\beta)^3}(X-\alpha)^2 +
\frac{\alpha-\beta}{(\alpha+\beta)^3}(X-\alpha)(Y-\beta) +
\frac{\alpha}{(\alpha+\beta)^3}(Y-\beta)^2
+ \cdots
\\ &amp;=
\frac{\alpha}{\alpha+\beta} +
\frac{\beta}{\alpha+\beta}\frac{X-\alpha}{\alpha+\beta} +
\frac{-\alpha}{\alpha+\beta}\frac{Y-\beta}{\alpha+\beta}
\\ &amp;+
\frac{-\beta}{\alpha+\beta}\left(\frac{X-\alpha}{\alpha+\beta}\right)^2 +
\frac{\alpha-\beta}{\alpha+\beta}
\frac{X-\alpha}{\alpha+\beta}\frac{Y-\beta}{\alpha+\beta} +
\frac{\alpha}{\alpha+\beta}\left(\frac{Y-\beta}{\alpha+\beta}\right)^2
+ \cdots.
\end{aligned}
\]</span></p>
<p>ゆえに, <span class="math inline">\(\alpha, \beta\)</span> の両方が大きいならば(より正確に言えば <span class="math inline">\(\alpha=N\mu\)</span>, <span class="math inline">\(\beta=N(1-\mu\)</span>, <span class="math inline">\(0&lt;\mu&lt;1\)</span> で <span class="math inline">\(N\)</span> が大きいならば),</p>
<p><span class="math display">\[
\frac{\operatorname{std}(X)}{\alpha+\beta} = \frac{\sqrt{\alpha}}{\alpha+\beta}, \quad
\frac{\operatorname{std}(Y)}{\alpha+\beta} = \frac{\sqrt{\beta}}{\alpha+\beta}
\]</span></p>
<p>がどちらも小さくなり, 1次近似</p>
<p><span class="math display">\[
T \approx
\frac{\alpha}{\alpha+\beta} +
\frac{\beta}{(\alpha+\beta)^2}(X-\alpha) +
\frac{-\alpha}{(\alpha+\beta)^2}(Y-\beta)
\]</span></p>
<p>が有効になり,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
E[T] \approx \frac{\alpha}{\alpha+\beta},
\\ &amp;
\operatorname{var}(T) \approx
\frac{\beta^4 \operatorname{var}(X)}{(\alpha+\beta)^4} +
\frac{\alpha^2 \operatorname{var}(Y)}{(\alpha+\beta)^4} =
\frac{\beta^2\alpha + \alpha^2\beta}{(\alpha+\beta)^4} =
\frac{\alpha\beta}{(\alpha+\beta)^3}.
\end{aligned}
\]</span></p>
<p>さらにそのとき, <span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span> の分布は正規分布で近似されるので, <span class="math inline">\(T\)</span> の分布も正規分布で近似される.</p>
<p><strong>解答終</strong></p>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@vars</span> x y</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>expr <span class="op">=</span> x<span class="op">/</span>(x<span class="op">+</span>y)</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>    expr</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(expr, x).<span class="fu">simplify</span>()</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(expr, y).<span class="fu">simplify</span>()</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>    ;;</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(expr, x, x).<span class="fu">simplify</span>()</span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(expr, x, y).<span class="fu">simplify</span>()</span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diff</span>(expr, y, y).<span class="fu">simplify</span>()</span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="108">
<pre><code>3×2 Matrix{Sym}:
    x/(x + y)     -2*y/(x + y)^3
  y/(x + y)^2  (x - y)/(x + y)^3
 -x/(x + y)^2      2*x/(x + y)^3</code></pre>
</div>
</div>
<p><strong>注意:</strong> <span class="math inline">\(X_1,X_2,\ldots,X_n\)</span> が独立同分布な確率変数達で <span class="math inline">\(X_i\sim\operatorname{Gamma}(\alpha/n, \theta)\)</span> のとき, それらの和もガンマ分布に <span class="math inline">\(X_1+X_2+\cdots+X_n \sim \operatorname{Gamma}(\alpha, \theta)\)</span> と従う. この事実と中心極限定理から, <span class="math inline">\(\alpha\)</span> が大きなときのガンマ分布 <span class="math inline">\(\operatorname{Gamma}(\alpha,\theta)\)</span> が正規分布 <span class="math inline">\(\operatorname{Normal}(\alpha, \sqrt{\alpha\theta^2})\)</span> で近似されることが導かれる.</p>
<p>ゆえに, 上の問題の結果は, パラメータの値が大きなときのベータ分布が正規分布で近似されることが, ガンマ分布に関する中心極限定理の帰結になっていることを示していることになる.</p>
<p>ベータ分布の確率密度函数の形から直接的に正規分布近似を導くことも易しい(次の節の問題を見よ).</p>
<p><strong>注意終</strong></p>
<div class="cell" data-execution_count="109">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_gammanormal</span>(α, θ)</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>    m, s <span class="op">=</span> α<span class="op">*</span>θ, <span class="fu">√</span>(α<span class="op">*</span>θ<span class="op">^</span><span class="fl">2</span>)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> (m <span class="op">-</span> <span class="fl">4</span>s, m <span class="op">+</span> <span class="fl">4</span>s)</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(<span class="fu">Gamma</span>(α, θ), xlim<span class="op">...</span>; label<span class="op">=</span><span class="st">"Gamma(α,θ)"</span>)</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(<span class="fu">Normal</span>(m, s); label<span class="op">=</span><span class="st">"normal approx"</span>, ls<span class="op">=:</span>dash)</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plot!(; legend=:outertop)</span></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title!</span>(<span class="st">"α = </span><span class="sc">$</span><span class="st">α, θ = </span><span class="sc">$</span><span class="st">θ")</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>end</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="109">
<pre><code>plot_gammanormal (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="110">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">plot_gammanormal</span>(<span class="fl">5</span>, <span class="fl">20</span>), <span class="fu">plot_gammanormal</span>(<span class="fl">20</span>, <span class="fl">5</span>); size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="110">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-111-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="111">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">plot_gammanormal</span>(<span class="fl">80</span>, <span class="fl">1.25</span>), <span class="fu">plot_gammanormal</span>(<span class="fl">320</span>, <span class="fl">0.3125</span>); size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="111">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-112-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="112">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_betanormal</span>(α, β)</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>    m, s <span class="op">=</span> α<span class="op">/</span>(α<span class="op">+</span>β), <span class="fu">√</span>(α<span class="op">*</span>β<span class="op">/</span>(α<span class="op">+</span>β)<span class="op">^</span><span class="fl">3</span>)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> (m <span class="op">-</span> <span class="fl">4</span>s, m <span class="op">+</span> <span class="fl">4</span>s)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(<span class="fu">Beta</span>(α, β), xlim<span class="op">...</span>; label<span class="op">=</span><span class="st">"Beta(α,β)"</span>)</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(<span class="fu">Normal</span>(m, s); label<span class="op">=</span><span class="st">"normal approx"</span>, ls<span class="op">=:</span>dash)</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#plot!(; legend=:outertop)</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">title!</span>(<span class="st">"α = </span><span class="sc">$</span><span class="st">α, β = </span><span class="sc">$</span><span class="st">β")</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>end</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="112">
<pre><code>plot_betanormal (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="113">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>[<span class="fl">3</span>, <span class="fl">7</span>] <span class="op">.*</span> (<span class="fl">4</span> <span class="op">.^</span> (<span class="fl">0</span><span class="op">:</span><span class="fl">3</span>))<span class="ch">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="113">
<pre><code>2×4 Matrix{Int64}:
 3  12   48  192
 7  28  112  448</code></pre>
</div>
</div>
<div class="cell" data-execution_count="114">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">plot_betanormal</span>(<span class="fl">3</span>, <span class="fl">7</span>), <span class="fu">plot_betanormal</span>(<span class="fl">12</span>, <span class="fl">28</span>); size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="114">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-115-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">plot_betanormal</span>(<span class="fl">48</span>, <span class="fl">112</span>), <span class="fu">plot_betanormal</span>(<span class="fl">192</span>, <span class="fl">448</span>); size<span class="op">=</span>(<span class="fl">800</span>, <span class="fl">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="115">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-116-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="問題-ベータ分布の正規分布近似の直接的証明" class="level3">
<h3 class="anchored" data-anchor-id="問題-ベータ分布の正規分布近似の直接的証明">問題: ベータ分布の正規分布近似の直接的証明</h3>
<p><span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span> が大きなときにベータ分布 <span class="math inline">\(\operatorname{Beta}(\alpha, \beta)\)</span> が正規分布で近似されることを, その確率密度函数の具体形を使って直接証明せよ.</p>
<p><strong>解答例:</strong> <span class="math inline">\(0&lt;\mu&lt;1\)</span> と仮定し,</p>
<p><span class="math display">\[
\alpha = N\mu, \quad
\beta = N(1-\mu), \quad
t = \mu + \frac{x}{\sqrt{N}}
\]</span></p>
<p>とおいて, <span class="math inline">\(N\)</span> を大きくすると, Stirlingの公式より,</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
\frac{1}{B(\alpha,\beta)} =
\frac{\Gamma(\alpha+\beta)}{\Gamma(\alpha)\Gamma(\beta)} =
\frac{\Gamma(N)}{\Gamma(N\mu)\Gamma(N(1-\mu))}
\\ &amp;\sim
\frac{N\mu\;N(1-\mu)}{N}
\frac
{N^N e^{-N} \sqrt{2\pi N}}
{
(N\mu)^{N\mu} e^{-N\mu} \sqrt{2\pi N\mu}\;
(N(1-\mu))^{N(1-\mu)} e^{-N(1-\mu)} \sqrt{2\pi N(1-\mu)}
}
\\ &amp;=
\frac
{N\mu(1-\mu)}
{
\mu^{N\mu}\sqrt{2\pi N\mu}\;
(1-\mu)^{N(1-\mu)} \sqrt{1-\mu}
}
\\ &amp;=
\frac{1}{\sqrt{2\pi\mu(1-\mu)}}
\frac{\sqrt{N}}{\mu^{N\mu-1} (1-\mu)^{N(1-\mu)-1}}.
\end{aligned}
\]</span></p>
<p>そして</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
N\mu\log\left(1+\frac{x}{\sqrt{N}\,\mu}\right)
\\ &amp;=
N\mu\left(\frac{x}{\sqrt{N}\,\mu} - \frac{x^2}{2N\mu^2} + O(N^{-3/2})\right)
\\ &amp;=
\sqrt{N}\,x - \frac{x^2}{2\mu} + O(N^{-1/2}),
\\ &amp;
N(1-\mu)\log\left(1-\frac{x}{\sqrt{N}(1-\mu)}\right)
\\ &amp;=
N(1-\mu)\left(-\frac{x}{\sqrt{N}(1-\mu)} - \frac{x^2}{2N(1-\mu)^2} + O(N^{-3/2})\right)
\\ &amp;= -
\sqrt{N}\,x - \frac{x^2}{2(1-\mu)} + O(N^{-1/2}),
\\ &amp;
\frac{x^2}{2\mu} + \frac{x^2}{2(1-\mu)} = \frac{x^2}{2\mu(1-\mu)}
\end{aligned}
\]</span></p>
<p>より, 以下が成立することがわかる:</p>
<p><span class="math display">\[
\begin{aligned}
&amp;
t^{\alpha-1}(1-t)^{\beta-1}\,dt
\\ &amp;=
\left(\mu + \frac{x}{\sqrt{N}}\right)^{N\mu-1}
\left(1 - \mu - \frac{x}{\sqrt{N}}\right)^{N(1-\mu)-1}
\frac{dx}{\sqrt{N}}
\\ &amp;=
\mu^{N\mu-1} (1-\mu)^{N(1-\mu)-1}
\left(1+\frac{x}{\sqrt{N}\,\mu}\right)^{N\mu-1}
\left(1-\frac{x}{\sqrt{N}(1-\mu)}\right) ^{N(1-\mu)-1}
\frac{dx}{\sqrt{N}}
\\ &amp;=
\frac{\mu^{N\mu-1} (1-\mu)^{N(1-\mu)-1}}{\sqrt{N}}
\exp\left(-\frac{x^2}{2\mu(1-\mu)}\right) (1 + O(n^{-1/2}))
\,dx.
\end{aligned}
\]</span></p>
<p>以上の結果より,</p>
<p><span class="math display">\[
\begin{aligned}
\frac{t^{\alpha-1}(1-t)^{\beta-1}\,dt}{B(\alpha,\beta)}\,dt =
\frac{1}{\sqrt{2\pi\mu(1-\mu)}}
\exp\left(-\frac{x^2}{2\mu(1-\mu)}\right) (1 + O(n^{-1/2}))
\,dx.
\end{aligned}
\]</span></p>
<p>この公式はベータ分布が上で導入した <span class="math inline">\(x\)</span> 座標では平均 <span class="math inline">\(0\)</span>, 分散 <span class="math inline">\(\mu(1-\mu)\)</span> の正規分布で近似されることを意味している.</p>
<p><strong>解答終</strong></p>
<p><strong>注意:</strong> <span class="math inline">\(\alpha = N\mu\)</span>, <span class="math inline">\(\beta = N(1-\mu)\)</span>, <span class="math inline">\(T\sim\operatorname{Beta}(\alpha,\beta)\)</span> のとき,</p>
<p><span class="math display">\[
E[T] = \frac{\alpha}{\alpha+\beta} = \mu, \quad
\operatorname{var}(T) =
\frac{\alpha\beta}{(\alpha+\beta)^2(\alpha+\beta+1)} =
\frac{\mu(1-\mu)}{N+1}
\]</span></p>
<p>なので, <span class="math inline">\(X = \sqrt{N}(T - \mu)\)</span> とおくと, <span class="math inline">\(N\to\infty\)</span> のとき,</p>
<p><span class="math display">\[
E[X] = 0, \quad
\operatorname{var}(X) = N\operatorname{var}(T) = \frac{N}{N+1}\mu(1-\mu) \to \mu(1-\mu).
\]</span></p>
<p>この <span class="math inline">\(\mu(1-\mu)\)</span> が上の解答例の中で登場した正規分布の分散である.</p>
</section>
</section>
<section id="各種の確率分布の正規分布近似" class="level2">
<h2 class="anchored" data-anchor-id="各種の確率分布の正規分布近似">各種の確率分布の正規分布近似</h2>
<p>以下に挙げるもの以外にも正規分布で近似される確率分布はたくさんある. 各自, 研究してノートにまとめておくとよいだろう. 具体的な数値例をコンピュータで作っておくと, どのようなときにどれだけ近似がうまく行くかについての「土地勘」が得られる.</p>
<div class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_normalapprox</span>(dist; title<span class="op">=</span><span class="fu">distname</span>(dist), kwargs<span class="op">...</span>)</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>    μ, σ <span class="op">=</span> <span class="fu">mean</span>(dist), <span class="fu">std</span>(dist)</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>    normal <span class="op">=</span> <span class="fu">Normal</span>(μ, σ)</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>    xlim <span class="op">=</span> (μ <span class="op">-</span> <span class="fl">4.5</span>σ, μ <span class="op">+</span> <span class="fl">4.5</span>σ)</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(x <span class="op">-&gt;</span> <span class="fu">mypdf</span>(dist, x), xlim<span class="op">...</span>; label<span class="op">=</span><span class="st">""</span>)</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(normal, xlim<span class="op">...</span>; label<span class="op">=</span><span class="st">"normal approx"</span>, ls<span class="op">=:</span>dash)</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot!</span>(; title, kwargs<span class="op">...</span>)</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="116">
<pre><code>plot_normalapprox (generic function with 1 method)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2022-05-13: Distributions.jl で BetaNegativeBinomial(k, α, β)</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="co"># がまだ実装されていないので自前で必要最小限の実装を行う.</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> O</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">SpecialFunctions</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> BetaNegativeBinomial{T} <span class="op">&lt;:</span><span class="dt"> DiscreteUnivariateDistribution</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a>    k<span class="op">::</span><span class="dt">T</span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a>    α<span class="op">::</span><span class="dt">T</span></span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a>    β<span class="op">::</span><span class="dt">T</span></span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb192-14"><a href="#cb192-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-15"><a href="#cb192-15" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">logpdf_betanegbin</span>(x, k, α, β)</span>
<span id="cb192-16"><a href="#cb192-16" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> <span class="fu">round</span>(x)</span>
<span id="cb192-17"><a href="#cb192-17" aria-hidden="true" tabindex="-1"></a>    m <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="op">-</span><span class="cn">Inf</span></span>
<span id="cb192-18"><a href="#cb192-18" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">loggamma</span>(k<span class="op">+</span>m) <span class="op">-</span> <span class="fu">loggamma</span>(m<span class="op">+</span><span class="fl">1</span>) <span class="op">-</span> <span class="fu">loggamma</span>(k) <span class="op">+</span> <span class="fu">logbeta</span>(α<span class="op">+</span>k, β<span class="op">+</span>m) <span class="op">-</span> <span class="fu">logbeta</span>(α, β))</span>
<span id="cb192-19"><a href="#cb192-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb192-20"><a href="#cb192-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-21"><a href="#cb192-21" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> Distributions.<span class="fu">logpdf</span>(dist<span class="op">::</span><span class="dt">BetaNegativeBinomial</span>, x)</span>
<span id="cb192-22"><a href="#cb192-22" aria-hidden="true" tabindex="-1"></a>    (; k, α, β) <span class="op">=</span> dist</span>
<span id="cb192-23"><a href="#cb192-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logpdf_betanegbin</span>(x, k, α, β)</span>
<span id="cb192-24"><a href="#cb192-24" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb192-25"><a href="#cb192-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-26"><a href="#cb192-26" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> Distributions.<span class="fu">mean</span>(dist<span class="op">::</span><span class="dt">BetaNegativeBinomial</span>)</span>
<span id="cb192-27"><a href="#cb192-27" aria-hidden="true" tabindex="-1"></a>    (; k, α, β) <span class="op">=</span> dist</span>
<span id="cb192-28"><a href="#cb192-28" aria-hidden="true" tabindex="-1"></a>    k<span class="op">*</span>β<span class="op">/</span>(α <span class="op">-</span> <span class="fl">1</span>)</span>
<span id="cb192-29"><a href="#cb192-29" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb192-30"><a href="#cb192-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-31"><a href="#cb192-31" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> Distributions.<span class="fu">var</span>(dist<span class="op">::</span><span class="dt">BetaNegativeBinomial</span>)</span>
<span id="cb192-32"><a href="#cb192-32" aria-hidden="true" tabindex="-1"></a>    (; k, α, β) <span class="op">=</span> dist</span>
<span id="cb192-33"><a href="#cb192-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">k*</span>(α<span class="op">+</span>k<span class="op">-</span><span class="fl">1</span>)<span class="fu">*β*</span>(α<span class="op">+</span>β<span class="op">-</span><span class="fl">1</span>)<span class="op">/</span>((α<span class="op">-</span><span class="fl">1</span>)<span class="op">^</span><span class="fl">2</span><span class="fu">*</span>(α<span class="op">-</span><span class="fl">2</span>))</span>
<span id="cb192-34"><a href="#cb192-34" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb192-35"><a href="#cb192-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-36"><a href="#cb192-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="117">
<pre><code>Main.O</code></pre>
</div>
</div>
<section id="二項分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="二項分布の正規分布近似">二項分布の正規分布近似</h3>
<p><span class="math inline">\(0 &lt; p &lt; 1\)</span> でありかつ,</p>
<p><span class="math display">\[
(X_1,\ldots,X_n)\sim \operatorname{Bernoulli}(p)^n = \operatorname{Binomial}(1, p)^n
\]</span></p>
<p>であるとき,</p>
<p><span class="math display">\[
K_n = X_1 + \cdots + X_n \sim \operatorname{Binomial}(n, p)
\]</span></p>
<p>であり, 中心極限定理によって独立同分布な確率変数達の和の分布が正規分布で近似されることより, <span class="math inline">\(n\)</span> が大きなとき, <span class="math inline">\(K_n\)</span> の分布は正規分布で近似される.</p>
<div class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">Binomial</span>(<span class="fl">50</span>, <span class="fl">0.2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="118">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-119-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="負の二項分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="負の二項分布の正規分布近似">負の二項分布の正規分布近似</h3>
<p><span class="math inline">\(0 &lt; p &lt; 1\)</span> でありかつ,</p>
<p><span class="math display">\[
(Y_1,\ldots,Y_k)\sim \operatorname{Geometric}(p) = \operatorname{NegativeBinomial}(1, p)^k
\]</span></p>
<p>であるとき,</p>
<p><span class="math display">\[
N_k = Y_1 + \cdots + Y_k \sim \operatorname{NegativeBinomial}(k, p)
\]</span></p>
<p>であり, 中心極限定理によって独立同分布な確率変数達の和の分布が正規分布で近似されることより, <span class="math inline">\(k\)</span> が大きなとき, <span class="math inline">\(N_k\)</span> の分布は正規分布で近似される.</p>
<div class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">NegativeBinomial</span>(<span class="fl">50</span>, <span class="fl">0.7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="119">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-120-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="poisson分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="poisson分布の正規分布近似">Poisson分布の正規分布近似</h3>
<p><span class="math inline">\(\lambda &gt; 0\)</span> でありかつ,</p>
<p><span class="math display">\[
(X_1, \ldots, X_n) \sim \operatorname{Poisson}(\lambda/n)^n
\]</span></p>
<p>であるとき,</p>
<p><span class="math display">\[
K = X_1 + \cdots + X_n \sim \operatorname{Poisson}(\lambda)
\]</span></p>
<p>であり, 中心極限定理によって独立同分布な確率変数達の和の分布が正規分布で近似されることより, <span class="math inline">\(\lambda\)</span> が大きなとき, <span class="math inline">\(K\)</span> の分布は正規分布で近似される.</p>
<div class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">Poisson</span>(<span class="fl">30</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="120">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-121-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="ガンマ分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="ガンマ分布の正規分布近似">ガンマ分布の正規分布近似</h3>
<p><span class="math inline">\(\alpha &gt; 0\)</span>, <span class="math inline">\(\theta &gt; 0\)</span> でありかつ,</p>
<p><span class="math display">\[
(Y_1,\ldots,Y_n) \sim \operatorname{Gamma}(\alpha/n, \theta)
\]</span></p>
<p>であるとき,</p>
<p><span class="math display">\[
T = Y_1 + \cdots + Y_n \sim \operatorname{Gamma}(\alpha, \theta)
\]</span></p>
<p>であり, 中心極限定理によって独立同分布な確率変数達の和の分布が正規分布で近似されることより, <span class="math inline">\(\alpha\)</span> が大きなとき, <span class="math inline">\(T\)</span> の分布は正規分布で近似される.</p>
<div class="cell" data-execution_count="121">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">Gamma</span>(<span class="fl">50</span>, <span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="121">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-122-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="χ²分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="χ²分布の正規分布近似">χ²分布の正規分布近似</h3>
<p><span class="math inline">\(\nu &gt; 0\)</span> でありかつ,</p>
<p><span class="math display">\[
(Y_1,\ldots,Y_n) \sim \operatorname{Chisq}(\nu/n) = \operatorname{Gamma}(\nu/(2n), 2)
\]</span></p>
<p>であるとき,</p>
<p><span class="math display">\[
Y = Y_1 + \cdots + Y_n \sim \operatorname{Chisq}(\nu) = \operatorname{Gamma}(\nu/2, 2)
\]</span></p>
<p>であり, 中心極限定理によって独立同分布な確率変数達の和の分布が正規分布で近似されることより, <span class="math inline">\(\nu\)</span> が大きなとき, <span class="math inline">\(Y\)</span> の分布は正規分布で近似される.</p>
<div class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">Chisq</span>(<span class="fl">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="122">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-123-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="逆ガンマ分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="逆ガンマ分布の正規分布近似">逆ガンマ分布の正規分布近似</h3>
<p><span class="math inline">\(\alpha &gt; 0\)</span> が大きなとき, 逆ガンマ分布 <span class="math inline">\(\operatorname{InverseGamma}(\alpha, \theta)\)</span> は正規分布で近似される.</p>
<div class="cell" data-execution_count="123">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">InverseGamma</span>(<span class="fl">100</span>, <span class="fl">100</span>); title<span class="op">=</span><span class="st">"InverseGamma(100, 100)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="123">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-124-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="ベータ分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="ベータ分布の正規分布近似">ベータ分布の正規分布近似</h3>
<p>すでに上で示したように, <span class="math inline">\(\alpha,\beta&gt;0\)</span> が大きなとき, ベータ分布 <span class="math inline">\(\operatorname{Beta}(\alpha,\beta)\)</span> は正規分布で近似される.</p>
<div class="cell" data-execution_count="124">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">Beta</span>(<span class="fl">15</span>, <span class="fl">35</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="124">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-125-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="t-分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="t-分布の正規分布近似"><span class="math inline">\(t\)</span> 分布の正規分布近似</h3>
<p>「Gauss積分, ガンマ函数, ベータ函数」のノートですでに示したように, <span class="math inline">\(\nu&gt;0\)</span> が大きなとき, <span class="math inline">\(t\)</span> 分布 <span class="math inline">\(\operatorname{TDist}(\nu)\)</span> は標準正規分布で近似される.</p>
<div class="cell" data-execution_count="125">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">TDist</span>(<span class="fl">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="125">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-126-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="ベータプライム分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="ベータプライム分布の正規分布近似">ベータプライム分布の正規分布近似</h3>
<p><span class="math inline">\(\alpha, \beta &gt; 0\)</span> が大きなとき, ベータプライム分布 <span class="math inline">\(\operatorname{BetaPrime}(\alpha, \beta)\)</span> は正規分布で近似される. (証明に興味がある人は自分で証明してみよ. ベータプライム分布は <span class="math inline">\(F\)</span> 分布のスケール変換に等しい.)</p>
<div class="cell" data-execution_count="126">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">BetaPrime</span>(<span class="fl">100</span>, <span class="fl">200</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="126">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-127-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="f-分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="f-分布の正規分布近似"><span class="math inline">\(F\)</span> 分布の正規分布近似</h3>
<p><span class="math inline">\(\nu_1,\nu_2&gt;0\)</span> が大きなとき, <span class="math inline">\(F\)</span> 分布 <span class="math inline">\(\operatorname{FDist}(\nu_1, \nu_2) = (\nu_2/\nu_1)\operatorname{BetaPrime}(\nu_1/2, \nu_2/2)\)</span> は正規分布で近似される.</p>
<div class="cell" data-execution_count="127">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">FDist</span>(<span class="fl">200</span>, <span class="fl">400</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="127">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-128-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="超幾何分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="超幾何分布の正規分布近似">超幾何分布の正規分布近似</h3>
<p><span class="math inline">\(s,f,n\)</span> が大きなとき, 超幾何分布 <span class="math inline">\(\operatorname{Hypergeometric}(s, f, n)\)</span> は正規分布で近似される.</p>
<div class="cell" data-execution_count="128">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">Hypergeometric</span>(<span class="fl">40</span>, <span class="fl">60</span>, <span class="fl">80</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="128">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-129-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="ベータ二項分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="ベータ二項分布の正規分布近似">ベータ二項分布の正規分布近似</h3>
<p><span class="math inline">\(n, \alpha, \beta\)</span> が大きなとき, ベータ二項分布 <span class="math inline">\(\operatorname{BetaBinomial}(n, \alpha, \beta)\)</span> は正規分布で近似される.</p>
<div class="cell" data-execution_count="129">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(<span class="fu">BetaBinomial</span>(<span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">70</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="129">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-130-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="ベータ負の二項分布の正規分布近似" class="level3">
<h3 class="anchored" data-anchor-id="ベータ負の二項分布の正規分布近似">ベータ負の二項分布の正規分布近似</h3>
<p><span class="math inline">\(k, \alpha, \beta\)</span> が大きなとき, ベータ二項分布 <span class="math inline">\(\operatorname{BetaNegativeBinomial}(k, \alpha, \beta)\)</span> は正規分布で近似される.</p>
<div class="cell" data-execution_count="130">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normalapprox</span>(O.<span class="fu">BetaNegativeBinomial</span>(<span class="fl">100</span>, <span class="fl">300</span>, <span class="fl">100</span>);</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"BetaNegativeBinomial(100, 200, 400)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="130">
<p><img src="05%20Central%20limit%20theorem_files\figure-html/cell-131-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>